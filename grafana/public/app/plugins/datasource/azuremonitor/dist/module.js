/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","@grafana/runtime","react","@grafana/ui","lodash","@emotion/css","prismjs","rxjs"],((e,t,r,o,s,n,a,i)=>(()=>{"use strict";var c={513:e=>{e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var o,s,n;if(Array.isArray(t)){if((o=t.length)!=r.length)return!1;for(s=o;0!=s--;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((o=(n=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(s=o;0!=s--;)if(!Object.prototype.hasOwnProperty.call(r,n[s]))return!1;for(s=o;0!=s--;){var a=n[s];if(!e(t[a],r[a]))return!1}return!0}return t!=t&&r!=r}},874:(e,t,r)=>{var o=r(300),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};function c(e){return o.isMemo(e)?a:i[e.$$typeof]||s}i[o.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i[o.Memo]=a;var u=Object.defineProperty,l=Object.getOwnPropertyNames,p=Object.getOwnPropertySymbols,m=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,r,o){if("string"!=typeof r){if(f){var s=d(r);s&&s!==f&&e(t,s,o)}var a=l(r);p&&(a=a.concat(p(r)));for(var i=c(t),b=c(r),y=0;y<a.length;++y){var v=a[y];if(!(n[v]||o&&o[v]||b&&b[v]||i&&i[v])){var g=m(r,v);try{u(t,v,g)}catch(e){}}}}return t}},520:(e,t)=>{var r="function"==typeof Symbol&&Symbol.for,o=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,n=r?Symbol.for("react.fragment"):60107,a=r?Symbol.for("react.strict_mode"):60108,i=r?Symbol.for("react.profiler"):60114,c=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,l=r?Symbol.for("react.async_mode"):60111,p=r?Symbol.for("react.concurrent_mode"):60111,m=r?Symbol.for("react.forward_ref"):60112,d=r?Symbol.for("react.suspense"):60113,f=r?Symbol.for("react.suspense_list"):60120,b=r?Symbol.for("react.memo"):60115,y=r?Symbol.for("react.lazy"):60116,v=r?Symbol.for("react.block"):60121,g=r?Symbol.for("react.fundamental"):60117,h=r?Symbol.for("react.responder"):60118,w=r?Symbol.for("react.scope"):60119;function O(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case l:case p:case n:case i:case a:case d:return e;default:switch(e=e&&e.$$typeof){case u:case m:case y:case b:case c:return e;default:return t}}case s:return t}}}function S(e){return O(e)===p}t.AsyncMode=l,t.ConcurrentMode=p,t.ContextConsumer=u,t.ContextProvider=c,t.Element=o,t.ForwardRef=m,t.Fragment=n,t.Lazy=y,t.Memo=b,t.Portal=s,t.Profiler=i,t.StrictMode=a,t.Suspense=d,t.isAsyncMode=function(e){return S(e)||O(e)===l},t.isConcurrentMode=S,t.isContextConsumer=function(e){return O(e)===u},t.isContextProvider=function(e){return O(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return O(e)===m},t.isFragment=function(e){return O(e)===n},t.isLazy=function(e){return O(e)===y},t.isMemo=function(e){return O(e)===b},t.isPortal=function(e){return O(e)===s},t.isProfiler=function(e){return O(e)===i},t.isStrictMode=function(e){return O(e)===a},t.isSuspense=function(e){return O(e)===d},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===n||e===p||e===i||e===a||e===d||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===b||e.$$typeof===c||e.$$typeof===u||e.$$typeof===m||e.$$typeof===g||e.$$typeof===h||e.$$typeof===w||e.$$typeof===v)},t.typeOf=O},300:(e,t,r)=>{e.exports=r(520)},89:e=>{e.exports=n},781:t=>{t.exports=e},531:e=>{e.exports=t},7:e=>{e.exports=o},241:e=>{e.exports=s},146:e=>{e.exports=a},959:e=>{e.exports=r},269:e=>{e.exports=i}},u={};function l(e){var t=u[e];if(void 0!==t)return t.exports;var r=u[e]={exports:{}};return c[e](r,r.exports,l),r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var p={};return(()=>{l.r(p),l.d(p,{plugin:()=>ya});var e=l(781),t=l(531),r=l(959),o=l.n(r),s=l(89),n=l(7),a=Object.defineProperty,i=Object.defineProperties,c=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,f=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,b=(e,t)=>{for(var r in t||(t={}))m.call(t,r)&&f(e,r,t[r]);if(u)for(var r of u(t))d.call(t,r)&&f(e,r,t[r]);return e};const y=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:a})=>{const u=(0,n.useTheme2)(),l={container:(0,s.css)({p:{margin:0},"p + p":{marginTop:u.spacing(2)}}),text:(0,s.css)((p=b({},u.typography.body),m={color:u.colors.text.secondary,a:(0,s.css)({color:u.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})},i(p,c(m))))};var p,m;return o().createElement("div",{className:(0,s.cx)(l.container,a)},o().createElement("p",{className:l.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",o().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&o().createElement("p",{className:l.text},o().createElement("i",null,"Fields marked with * are required")))};var v=Object.defineProperty,g=Object.defineProperties,h=Object.getOwnPropertyDescriptors,w=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,k=(e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,z=(e,t)=>{for(var r in t||(t={}))O.call(t,r)&&k(e,r,t[r]);if(w)for(var r of w(t))S.call(t,r)&&k(e,r,t[r]);return e};const E=({children:e,title:t,description:a,isCollapsible:i=!1,isInitiallyOpen:c=!0,kind:u="section",className:l})=>{const{colors:p,typography:m,spacing:d}=(0,n.useTheme2)(),[f,b]=(0,r.useState)(!i||c),y=f?"angle-up":"angle-down",v="sub-section"===u,w=`${f?"Collapse":"Expand"} section ${t}`,O={header:(0,s.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,s.css)({margin:0}),subtitle:(0,s.css)({margin:0,fontWeight:m.fontWeightRegular}),descriptionText:(0,s.css)((S=z({marginTop:d(v?.25:.5),marginBottom:0},m.bodySmall),k={color:p.text.secondary},g(S,h(k)))),content:(0,s.css)({marginTop:d(2)})};var S,k;return o().createElement("div",{className:l},o().createElement("div",{className:O.header},"section"===u?o().createElement("h3",{className:O.title},t):o().createElement("h6",{className:O.subtitle},t),i&&o().createElement(n.IconButton,{name:y,onClick:()=>b(!f),type:"button",size:"xl","aria-label":w})),a&&o().createElement("p",{className:O.descriptionText},a),f&&o().createElement("div",{className:O.content},e))};var P=Object.defineProperty,j=Object.defineProperties,A=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,I=(e,t,r)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const D=e=>{var t,r=e,{children:s}=r,n=((e,t)=>{var r={};for(var o in e)T.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&N)for(var o of N(e))t.indexOf(o)<0&&C.call(e,o)&&(r[o]=e[o]);return r})(r,["children"]);return o().createElement(E,(t=((e,t)=>{for(var r in t||(t={}))T.call(t,r)&&I(e,r,t[r]);if(N)for(var r of N(t))C.call(t,r)&&I(e,r,t[r]);return e})({},n),j(t,A({kind:"section"}))),s)};var M=l(241),_=l.n(M);class G{static createISO8601Duration(e,t){return(0,M.includes)(["hour","minute","h","m"],t)?`PT${e}${t[0].toUpperCase()}`:`P${e}${t[0].toUpperCase()}`}static createISO8601DurationFromInterval(e){const t=+e.slice(0,e.length-1),r=e[e.length-1];if(e.indexOf("ms")>-1)return G.createISO8601Duration(1,"m");if("s"===e[e.length-1]){let e=60*t%60;return e<1&&(e=1),G.createISO8601Duration(e,"m")}return G.createISO8601Duration(t,r)}static findClosestTimeGrain(t,r){const o=(0,M.filter)(r,(e=>"auto"!==e));let s=o[0];const n=e.rangeUtil.intervalToMs(t);for(let t=0;t<o.length;t++)n>e.rangeUtil.intervalToMs(o[t])&&(s=t+1<o.length?o[t+1]:o[t]);return s}static createTimeGrainFromISO8601Duration(e){let t=1;"PT"===e.substring(0,2)&&(t=2);const r=e.substring(t,e.length-1),o=e.substring(e.length-1);return r+" "+G.timeUnitToText(+r,o)}static timeUnitToText(e,t){let r="";return"S"===t&&(r="second"),"M"===t&&(r="minute"),"H"===t&&(r="hour"),"D"===t&&(r="day"),e>1?r+"s":r}static createKbnUnitFromISO8601Duration(e){if("auto"===e)return"auto";let t=1;"PT"===e.substring(0,2)&&(t=2);const r=e.substring(t,e.length-1),o=e.substring(e.length-1);return r+G.timeUnitToKbn(+r,o)}static timeUnitToKbn(e,t){return"S"===t?"s":"M"===t?"m":"H"===t?"h":"D"===t?"d":""}}class R{static parseResponseValues(e,t,r){const o=[];if(!e)return o;for(let s=0;s<e.value.length;s++)if(!(0,M.find)(o,["value",(0,M.get)(e.value[s],r)])){const n=(0,M.get)(e.value[s],r),a=(0,M.get)(e.value[s],t,n);o.push({text:a,value:n})}return o}static parseResourceNames(e,t){const r=[];if(!e)return r;for(let o=0;o<e.value.length;o++)"string"!=typeof e.value[o].type||t&&e.value[o].type.toLocaleLowerCase()!==t.toLocaleLowerCase()||r.push({text:e.value[o].name,value:e.value[o].name});return r}static parseMetadata(e,t){const r=["None","Average","Minimum","Maximum","Total","Count"],o=null==e?void 0:e.value.find((e=>e.name.value===t));return o?{primaryAggType:o.primaryAggregationType,supportedAggTypes:o.supportedAggregationTypes||r,supportedTimeGrains:[{label:"Auto",value:"auto"},...R.parseTimeGrains(null!==(s=o.metricAvailabilities)&&void 0!==s?s:[])],dimensions:R.parseDimensions(null!==(n=o.dimensions)&&void 0!==n?n:[])}:{primaryAggType:"",supportedAggTypes:r,supportedTimeGrains:[],dimensions:[]};var s,n}static parseTimeGrains(e){const t=[];return e?(e.forEach((e=>{e.timeGrain&&t.push({label:G.createTimeGrainFromISO8601Duration(e.timeGrain),value:e.timeGrain})})),t):t}static parseDimensions(e){return e.map((e=>({label:e.localizedValue||e.value,value:e.value})))}static parseSubscriptions(e){const t=[];if(!e)return t;const r="subscriptionId";for(let o=0;o<e.value.length;o++)(0,M.find)(t,["value",(0,M.get)(e.value[o],r)])||t.push({text:`${(0,M.get)(e.value[o],"displayName")}`,value:(0,M.get)(e.value[o],r)});return t}static parseSubscriptionsForSelect(e){const t=[];if(!e)return t;const r="subscriptionId";for(let o=0;o<e.data.value.length;o++)(0,M.find)(t,["value",(0,M.get)(e.data.value[o],r)])||t.push({label:`${(0,M.get)(e.data.value[o],"displayName")} - ${(0,M.get)(e.data.value[o],r)}`,value:(0,M.get)(e.data.value[o],r)});return t}static parseLocations(e){const t=[];if(!e)return t;for(const r of e.value)t.push({name:r.name,displayName:r.displayName,supportsLogs:void 0});return t}}const q=(e,t=[])=>{if(0===t.length)return[];const r=t.reduce(((e,t)=>(e.add(t),e)),new Set);return e.filter((e=>r.has(e.value)))},x=e=>({value:e.value,label:e.text}),L=(e,t,r)=>{const o=[...e,t],s=e.map((e=>e.value.toLowerCase())).concat(t.options.map((e=>e.value)));return r&&!s.includes(r.toLowerCase())&&o.push({label:r,value:r}),o},F="azuremonitor";function V(e,t){return"string"==typeof e?t.multi||t.includeAll&&!t.allValue?"'"+e+"'":e:"number"==typeof e?e:(0,M.map)(e,(t=>"number"==typeof e?e:"'"+t+"'")).join(",")}var Q,$,W;function U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){U(e,t,r[t])}))}return e}function B(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}!function(e){e.AzureMonitor="Azure Monitor",e.AzureResourceGraph="Azure Resource Graph",e.AzureTraces="Azure Traces",e.GrafanaTemplateVariableFn="Grafana Template Variable Function",e.LocationsQuery="Azure Regions",e.LogAnalytics="Azure Log Analytics",e.MetricNamesQuery="Azure Metric Names",e.NamespacesQuery="Azure Namespaces",e.ResourceGroupsQuery="Azure Resource Groups",e.ResourceNamesQuery="Azure Resource Names",e.SubscriptionsQuery="Azure Subscriptions",e.WorkspacesQuery="Azure Workspaces"}(Q||(Q={})),function(e){e.Logs="logs",e.Table="table",e.TimeSeries="time_series",e.Trace="trace"}($||($={})),function(e){e.Public="AzureCloud",e.China="AzureChinaCloud",e.USGovernment="AzureUSGovernment",e.None=""}(W||(W={}));const H=Symbol("Concealed client secret");function K(e){return e.jsonData.azureAuthType?e.jsonData.azureAuthType:e.jsonData.tenantId&&e.jsonData.clientId?"clientsecret":t.config.azure.managedIdentityEnabled?"msi":"clientsecret"}function J(){switch(t.config.azure.cloud){case W.Public:case W.None:case void 0:return"azuremonitor";case W.China:return"chinaazuremonitor";case W.USGovernment:return"govazuremonitor";default:throw new Error(`The cloud '${t.config.azure.cloud}' not supported.`)}}function Z(e){switch(e){case"azuremonitor":return"https://portal.azure.com";case"chinaazuremonitor":return"https://portal.azure.cn";case"govazuremonitor":return"https://portal.azure.us";default:throw new Error("The cloud not supported.")}}function Y(e){switch(K(e)){case"msi":case"workloadidentity":return J();case"clientsecret":return e.jsonData.cloudName||J()}}function ee(e){if(e.secureJsonFields.clientSecret)return H;{var t;const r=null===(t=e.secureJsonData)||void 0===t?void 0:t.clientSecret;return"string"==typeof r&&r.length>0?r:void 0}}const te={authType:{select:"data-testid auth-type"},azureCloud:{input:"data-testid azure-cloud"},tenantID:{input:"data-testid tenant-id"},clientID:{input:"data-testid client-id"},clientSecret:{input:"data-testid client-secret"},loadSubscriptions:{button:"data-testid load-subscriptions"},defaultSubscription:{input:"data-testid default-subscription"}},re={header:{select:"data-testid azure-monitor-experimental-header"},resourcePicker:{select:{button:"data-testid resource-picker-select"},search:{input:"data-testid resource-picker-search"},apply:{button:"data-testid resource-picker-apply"},cancel:{button:"data-testid resource-picker-cancel"},advanced:{collapse:"data-testid resource-picker-advanced",subscription:{input:"data-testid resource-picker-subscription"},resourceGroup:{input:"data-testid resource-picker-resource-group"},namespace:{input:"data-testid resource-picker-namespace"},region:{input:"data-testid resource-picker-region"},resource:{input:"data-testid resource-picker-resource"}}},metricsQueryEditor:{container:{input:"data-testid azure-monitor-metrics-query-editor-with-experimental-ui"},metricName:{input:"data-testid metric-name"}},logsQueryEditor:{container:{input:"data-testid azure-monitor-logs-query-editor-with-experimental-ui"},formatSelection:{input:"data-testid format-selection"}},argsQueryEditor:{container:{input:"data-testid azure-monitor-arg-query-editor"},subscriptions:{input:"data-testid azure-monitor-args-subscription"}},tracesQueryEditor:{container:{input:"data-testid azure-monitor-traces-query-editor-with-experimental-ui"},traceTypes:{select:"data-testid azure-monitor-traces-query-editor-trace-types"}}},oe={queryType:{input:"data-testid query-type"},subscription:{input:"data-testid subscription"},resourceGroup:{input:"data-testid resource-group"},namespace:{input:"data-testid namespace"},resource:{input:"data-testid resource"},region:{input:"data-testid region"}};function se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){se(e,t,r[t])}))}return e}function ae(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ie=e=>{const{credentials:t,azureCloudOptions:s,onCredentialsChange:a,disabled:i,managedIdentityEnabled:c,workloadIdentityEnabled:u}=e,l=(0,r.useMemo)((()=>{let e=[{value:"clientsecret",label:"App Registration"}];return c&&e.push({value:"msi",label:"Managed Identity"}),u&&e.push({value:"workloadidentity",label:"Workload Identity"}),e}),[c,u]);return o().createElement(D,{title:"Authentication"},l.length>1&&o().createElement(n.Field,{label:"Authentication",description:"Choose the type of authentication to Azure services","data-testid":te.authType.select,htmlFor:"authentication-type"},o().createElement(n.Select,{className:"width-15",value:l.find((e=>e.value===t.authType)),options:l,onChange:e=>{const r=c?"msi":u?"workloadidentity":"clientsecret",o=ae(ne({},t),{authType:e.value||r});a(o)},disabled:i})),"clientsecret"===t.authType&&o().createElement(o().Fragment,null,s&&o().createElement(n.Field,{label:"Azure Cloud","data-testid":te.azureCloud.input,htmlFor:"azure-cloud-type",disabled:i},o().createElement(n.Select,{inputId:"azure-cloud-type","aria-label":"Azure Cloud",className:"width-15",value:s.find((e=>e.value===t.azureCloud)),options:s,onChange:e=>{if("clientsecret"===t.authType){const r=ae(ne({},t),{azureCloud:e.value});a(r)}}})),o().createElement(n.Field,{label:"Directory (tenant) ID",required:!0,"data-testid":te.tenantID.input,htmlFor:"tenant-id",invalid:!t.tenantId,error:"Tenant ID is required"},o().createElement(n.Input,{"aria-label":"Tenant ID",className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:t.tenantId||"",onChange:e=>{if("clientsecret"===t.authType){const r=ae(ne({},t),{tenantId:e.target.value});a(r)}},disabled:i})),o().createElement(n.Field,{label:"Application (client) ID",required:!0,"data-testid":te.clientID.input,htmlFor:"client-id",invalid:!t.clientId,error:"Client ID is required"},o().createElement(n.Input,{className:"width-30","aria-label":"Client ID",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:t.clientId||"",onChange:e=>{if("clientsecret"===t.authType){const r=ae(ne({},t),{clientId:e.target.value});a(r)}},disabled:i})),!i&&("symbol"==typeof t.clientSecret?o().createElement(n.Field,{label:"Client Secret",htmlFor:"client-secret",required:!0},o().createElement("div",{className:"width-30",style:{display:"flex",gap:"4px"}},o().createElement(n.Input,{"aria-label":"Client Secret",placeholder:"configured",disabled:!0,"data-testid":"client-secret"}),o().createElement(n.Button,{variant:"secondary",type:"button",onClick:()=>{if("clientsecret"===t.authType){const e=ae(ne({},t),{clientSecret:""});a(e)}},disabled:i},"Reset"))):o().createElement(n.Field,{label:"Client Secret","data-testid":te.clientSecret.input,required:!0,htmlFor:"client-secret",invalid:!t.clientSecret,error:"Client secret is required"},o().createElement(n.Input,{className:"width-30","aria-label":"Client Secret",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:t.clientSecret||"",onChange:e=>{if("clientsecret"===t.authType){const r=ae(ne({},t),{clientSecret:e.target.value});a(r)}},id:"client-secret",disabled:i})))),e.children)},ce=e=>{const{credentials:t,disabled:s,options:a,subscriptions:i,getSubscriptions:c,onSubscriptionChange:u,onSubscriptionsChange:l}=e,p=function(e){switch(e.authType){case"msi":case"workloadidentity":return!0;case"clientsecret":return!!(e.azureCloud&&e.tenantId&&e.clientId&&e.clientSecret)}}(t),[m,d]=(0,r.useReducer)((e=>e+1),0);(0,r.useEffect)((()=>{if(!c||!p)return void f([]);let e=!1;return c().then((t=>{e||f(t,m)})),()=>{e=!0}}),[m]);const f=(e,t=!1)=>{l(e),c&&(t&&!a.subscriptionId&&e.length>0?b(e[0]):a.subscriptionId&&(e.find((e=>e.value===a.subscriptionId))||b(void 0)))},b=e=>u(null==e?void 0:e.value);return o().createElement(o().Fragment,null,o().createElement(n.Field,{label:"Default Subscription","data-testid":te.defaultSubscription.input,htmlFor:"default-subscription"},o().createElement("div",{className:"width-30",style:{display:"flex",gap:"4px"}},o().createElement(n.Select,{inputId:"default-subscription","aria-label":"Default Subscription",value:a.subscriptionId?i.find((e=>e.value===a.subscriptionId)):void 0,options:i,onChange:b,disabled:s}),o().createElement(n.Button,{variant:"secondary",type:"button",onClick:d,disabled:!p||s,"data-testid":te.loadSubscriptions.button},"Load Subscriptions"))))};function ue(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){ue(e,t,r[t])}))}return e}function pe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const me=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"chinaazuremonitor",label:"Azure China"}],de=e=>{const{updateOptions:s,getSubscriptions:n,options:a}=e,[i,c]=(0,r.useState)([]),u=(0,r.useMemo)((()=>function(e){const r=K(e);switch(r){case"msi":case"workloadidentity":return"msi"===r&&t.config.azure.managedIdentityEnabled||"workloadidentity"===r&&t.config.azure.workloadIdentityEnabled?{authType:r}:{authType:"clientsecret",azureCloud:J()};case"clientsecret":return{authType:"clientsecret",azureCloud:e.jsonData.cloudName||J(),tenantId:e.jsonData.tenantId,clientId:e.jsonData.clientId,clientSecret:ee(e)}}}(e.options)),[e.options]);return o().createElement(o().Fragment,null,o().createElement(ie,{managedIdentityEnabled:t.config.azure.managedIdentityEnabled,workloadIdentityEnabled:t.config.azure.workloadIdentityEnabled,credentials:u,azureCloudOptions:me,onCredentialsChange:(e,r)=>{r||c([]),s((o=>function(e,r){switch(r.authType){case"msi":case"workloadidentity":if("msi"===r.authType&&!t.config.azure.managedIdentityEnabled)throw new Error("Managed Identity authentication is not enabled in Grafana config.");if("workloadidentity"===r.authType&&!t.config.azure.workloadIdentityEnabled)throw new Error("Workload Identity authentication is not enabled in Grafana config.");return B(X({},e),{jsonData:B(X({},e.jsonData),{azureAuthType:r.authType})});case"clientsecret":return B(X({},e),{jsonData:B(X({},e.jsonData),{azureAuthType:"clientsecret",cloudName:r.azureCloud||J(),tenantId:r.tenantId,clientId:r.clientId}),secureJsonData:B(X({},e.secureJsonData),{clientSecret:"string"==typeof r.clientSecret?r.clientSecret:void 0}),secureJsonFields:B(X({},e.secureJsonFields),{clientSecret:"symbol"==typeof r.clientSecret})})}}(pe(le({},o),{jsonData:pe(le({},o.jsonData),{subscriptionId:r})}),e)))},disabled:e.options.readOnly},o().createElement(ce,{subscriptions:i,credentials:u,getSubscriptions:n,disabled:e.options.readOnly,onSubscriptionsChange:e=>c(e),onSubscriptionChange:e=>s((t=>pe(le({},t),{jsonData:pe(le({},t.jsonData),{subscriptionId:e})}))),options:a.jsonData})))};function fe(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function be(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){fe(n,o,s,a,i,"next",e)}function i(e){fe(n,o,s,a,i,"throw",e)}a(void 0)}))}}function ye(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ve extends r.PureComponent{render(){const{options:e,onOptionsChange:r}=this.props,{error:s}=this.state;return o().createElement(o().Fragment,null,o().createElement(y,{dataSourceName:"Azure Monitor",docsLink:"https://grafana.com/docs/grafana/latest/datasources/azure-monitor/",hasRequiredFields:!0}),o().createElement(n.Divider,null),o().createElement(de,{options:e,updateOptions:this.updateOptions,getSubscriptions:this.getSubscriptions}),s&&o().createElement(n.Alert,{severity:"error",title:s.title},o().createElement("p",null,s.description),s.details&&o().createElement("details",{style:{whiteSpace:"pre-wrap"}},s.details)),t.config.secureSocksDSProxyEnabled&&o().createElement(o().Fragment,null,o().createElement(n.Divider,null),o().createElement(D,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source. This includes Secure Socks Proxy.",isCollapsible:!0,isInitiallyOpen:void 0!==e.jsonData.enableSecureSocksProxy},o().createElement(n.SecureSocksProxySettings,{options:e,onOptionsChange:r}))))}constructor(r){super(r),ye(this,"templateSrv",(0,t.getTemplateSrv)()),ye(this,"baseURL",void 0),ye(this,"updateOptions",(e=>{const t=e(this.props.options);this.props.onOptionsChange(t),this.setState({unsaved:!0})}));var o=this;ye(this,"saveOptions",be((function*(){o.state.unsaved&&(yield(0,t.getBackendSrv)().put(`/api/datasources/${o.props.options.id}`,o.props.options).then((t=>{(0,e.updateDatasourcePluginOption)(o.props,"version",t.datasource.version)})),o.setState({unsaved:!1}))})));var s=this;ye(this,"getSubscriptions",be((function*(){yield s.saveOptions();try{const e=yield(0,t.getBackendSrv)().fetch({url:s.baseURL+"?api-version=2019-03-01",method:"GET"}).toPromise();return s.setState({error:void 0}),R.parseSubscriptionsForSelect(e)}catch(r){var e;return(0,t.isFetchError)(r)&&s.setState({error:{title:"Error requesting subscriptions",description:"Could not request subscriptions from Azure. Check your credentials and try again.",details:null==r||null===(e=r.data)||void 0===e?void 0:e.message}}),Promise.resolve([])}}))),this.state={unsaved:!1},this.baseURL=`/api/datasources/${this.props.options.id}/resources/${F}/subscriptions`}}function ge(e){var t,r,o,s,n,a,i,c,u,l,p,m,d,f,b,y,v;if(!e||"object"!=typeof e)return;if("string"==typeof e.message)return e.message;if("string"==typeof(null===(r=e.data)||void 0===r||null===(t=r.error)||void 0===t?void 0:t.message))return e.data.error.message;const g=(null===(i=e.error)||void 0===i||null===(a=i.data)||void 0===a||null===(n=a.error)||void 0===n||null===(s=n.innererror)||void 0===s||null===(o=s.innererror)||void 0===o?void 0:o.message)||(null===(p=e.error)||void 0===p||null===(l=p.data)||void 0===l||null===(u=l.error)||void 0===u||null===(c=u.innererror)||void 0===c?void 0:c.message)||(null===(f=e.error)||void 0===f||null===(d=f.data)||void 0===d||null===(m=d.error)||void 0===m?void 0:m.message)||(null===(y=e.error)||void 0===y||null===(b=y.data)||void 0===b?void 0:b.message)||(null===(v=e.data)||void 0===v?void 0:v.message)||e;return"string"==typeof g?g:g&&g.toString?g.toString():void 0}function he(){const[e,t]=(0,r.useState)([]),o=(0,r.useCallback)(((e,r)=>{t((t=>{const o=[...t],s=t.findIndex((([t])=>t===e));return s>-1&&o.splice(s,1),r&&o.unshift([e,r]),o}))}),[]);return[(0,r.useMemo)((()=>{const t=e[0];return t&&(o=t[1],(0,r.isValidElement)(o)?o:ge(o));var o}),[e]),o]}var we=Object.getOwnPropertySymbols,Oe=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;const ke=e=>{var t=e,{children:s}=t,a=((e,t)=>{var r={};for(var o in e)Oe.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&we)for(var o of we(e))t.indexOf(o)<0&&Se.call(e,o)&&(r[o]=e[o]);return r})(t,["children"]);const i=(0,n.useStyles2)((0,r.useCallback)((e=>ze(e,a)),[a]));return o().createElement("div",{className:i.root},s)},ze=(e,t)=>{var r,o,n;return{root:(0,s.css)({display:"flex",flexDirection:null!=(r=t.direction)?r:"row",flexWrap:null==(o=t.wrap)||o?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!=(n=t.gap)?n:2),flexGrow:t.flexGrow})}},Ee=({children:e})=>o().createElement(ke,{gap:.5,direction:"column"},e),Pe=({children:e})=>{const t=(0,n.useStyles2)(je);return o().createElement("div",{className:t.root},o().createElement(ke,{gap:2},e))},je=e=>({root:(0,s.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)})}),Ae=({children:e})=>o().createElement(ke,{gap:1},e);function Ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Ne(e,t,r[t])}))}return e}function Ce(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Ie=({query:e,onQueryChange:t})=>{var s;const a=(0,r.useCallback)((r=>{t(Ce(Te({},e),{azureResourceGraph:Ce(Te({},e.azureResourceGraph),{query:r})}))}),[t,e]);var i;return o().createElement(n.CodeEditor,{value:null!==(i=null===(s=e.azureResourceGraph)||void 0===s?void 0:s.query)&&void 0!==i?i:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:a,onSave:a})},De=e=>{const t=(0,n.useStyles2)((0,r.useCallback)((t=>Me(t,e)),[e]));return o().createElement("span",{className:(0,s.cx)(t.wrapper)})};De.defaultProps={v:0,h:0,layout:"block"};const Me=(e,t)=>{var r,o;return{wrapper:(0,s.css)([{paddingRight:e.spacing(null!=(r=t.h)?r:0),paddingBottom:e.spacing(null!=(o=t.v)?o:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}};var _e=Object.defineProperty,Ge=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable,xe=(e,t,r)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Le=e=>{var t;const s=e,{label:a,optional:i,tooltip:c,tooltipInteractive:u,children:l,width:p}=s,m=((e,t)=>{var r={};for(var o in e)Re.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&Ge)for(var o of Ge(e))t.indexOf(o)<0&&qe.call(e,o)&&(r[o]=e[o]);return r})(s,["label","optional","tooltip","tooltipInteractive","children","width"]),d=(0,n.useStyles2)((0,r.useCallback)((e=>Fe(e,p)),[p])),f=(null==m?void 0:m.htmlFor)||(null==(t=n.ReactUtils)?void 0:t.getChildId(l)),b=o().createElement(o().Fragment,null,o().createElement("label",{className:d.label,htmlFor:f},a,i&&o().createElement("span",{className:d.optional}," - optional"),c&&o().createElement(n.Tooltip,{placement:"top",content:c,theme:"info",interactive:u},o().createElement(n.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:d.icon}))),o().createElement(De,{v:.5}));return o().createElement("div",{className:d.root},o().createElement(n.Field,((e,t)=>{for(var r in t||(t={}))Re.call(t,r)&&xe(e,r,t[r]);if(Ge)for(var r of Ge(t))qe.call(t,r)&&xe(e,r,t[r]);return e})({className:d.field,label:b},m),l))},Fe=(e,t)=>({root:(0,s.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,s.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,s.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,s.css)({marginBottom:0}),icon:(0,s.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})});function Ve(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Ve(e,t,r[t])}))}return e}const $e=e=>{const{labelWidth:t,inlineField:r}=e,s=function(e,t){if(null==e)return{};var r,o,s=function(e,t){if(null==e)return{};var r,o,s={},n=Object.keys(e);for(o=0;o<n.length;o++)r=n[o],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(o=0;o<n.length;o++)r=n[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}(e,["labelWidth","inlineField"]);return r?o().createElement(n.InlineField,Qe({labelWidth:t||18},s)):o().createElement(Le,Qe({width:t||18},s))};function We(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){We(e,t,r[t])}))}return e}function Xe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Be=({query:e,subscriptions:t,variableOptionGroup:s,onQueryChange:a})=>{const[i,c]=(0,r.useState)(!1),[u,l]=(0,r.useState)([]),p=(0,r.useMemo)((()=>[...t,s]),[t,s]);return(0,r.useEffect)((()=>{e.subscriptions&&e.subscriptions.length>0?(l(q([...t,...s.options],e.subscriptions)),c(!1)):c(!0)}),[e.subscriptions,t,s.options]),o().createElement($e,{label:"Subscriptions","data-testid":re.argsQueryEditor.subscriptions.input},o().createElement(o().Fragment,null,o().createElement(n.MultiSelect,{isClearable:!0,value:u,inputId:"azure-monitor-subscriptions-field",onChange:r=>{const o=r.filter((e=>"Select all subscriptions"===e.value));if(r&&0!==r.length)if(o.length>0){const r=t.map((e=>{var t;return null!==(t=e.value)&&void 0!==t?t:""})).filter((e=>"Select all subscriptions"!==e));a(Xe(Ue({},e),{subscriptions:r}))}else{const o=r.map((e=>{var t;return null!==(t=e.value)&&void 0!==t?t:""}));a(Xe(Ue({},e),{subscriptions:o})),l(q([...t,...s.options],o)),c(!1)}else l([]),a(Xe(Ue({},e),{subscriptions:[]})),c(!0)},options:p,width:38}),i?o().createElement(n.FieldValidationMessage,null,"At least one subscription must be chosen."):null))};function He(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ke="arg-subscriptions";function Je(e,t,r){let o=t||[];0===o.length&&r&&(o=[r]),0===o.length&&e.length&&(o=[e[0]]);const s=o.filter((e=>e.includes("$"))),n=(0,M.intersection)(o,e).concat(s);return e.length&&o.length>n.length&&(o=n.length>0?n:[e[0]]),o}const Ze=({query:e,datasource:t,subscriptionId:s,variableOptionGroup:n,onChange:a,setError:i})=>{const[c,u]=(0,r.useState)([]);return(0,r.useMemo)((()=>{t.getSubscriptions().then((t=>{const r=t.map((e=>({label:e.text,value:e.value,description:e.value})));var o,s;u([{label:"Select all subscriptions",value:"Select all subscriptions",description:"Select all"}].concat(r)),i(Ke,void 0),a((o=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){He(e,t,r[t])}))}return e}({},e),s=null!=(s={subscriptions:Je(r.map((e=>e.value)),e.subscriptions,e.subscription)})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(s)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(s)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(s,e))})),o))})).catch((e=>i(Ke,e)))}),[t]),o().createElement("span",{"data-testid":re.argsQueryEditor.container.input},o().createElement(Ee,null,o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(Be,{subscriptions:c,query:e,datasource:t,subscriptionId:s,variableOptionGroup:n,onQueryChange:a,setError:i})))),o().createElement(Ie,{query:e,datasource:t,subscriptionId:s,variableOptionGroup:n,onQueryChange:a,setError:i}))},Ye=function(e){(0,r.useEffect)(e,[])},et=({query:e,variableOptionGroup:t,onQueryChange:s,inputId:a,options:i,defaultValue:c,setFormatAs:u,resultFormat:l})=>{const p=(0,r.useMemo)((()=>[...i,t]),[t,i]),m=(0,r.useCallback)((t=>{const{value:r}=t;if(!r)return;const o=u(e,r);s(o)}),[s,e,u]);return Ye((()=>{l&&i.find((e=>e.value===l))||m({value:c})})),o().createElement($e,{label:"Format as","data-testid":re.logsQueryEditor.formatSelection.input},o().createElement(n.Select,{inputId:`${a}-format-as-field`,value:null!=l?l:c,onChange:m,options:p,width:38}))},tt=({resources:e,onChange:t,renderAdvanced:s})=>{const[a,i]=(0,r.useState)(!!e.length&&JSON.stringify(e).includes("$"));return o().createElement("div",{"data-testid":re.resourcePicker.advanced.collapse},o().createElement(n.Collapse,{collapsible:!0,label:"Advanced",isOpen:a,onToggle:()=>i(!a)},s(e,t),o().createElement(n.Space,{v:2})))};var rt;!function(e){e.Subscription="Subscription",e.ResourceGroup="ResourceGroup",e.Resource="Resource",e.VariableGroup="TemplateVariableGroup",e.Variable="TemplateVariable"}(rt||(rt={}));const ot=({isOpen:e,entry:{type:t}})=>{switch(t){case rt.Subscription:return o().createElement(n.Icon,{name:"layer-group"});case rt.ResourceGroup:return o().createElement(n.Icon,{name:e?"folder-open":"folder"});case rt.Resource:return o().createElement(n.Icon,{name:"cube"});case rt.VariableGroup:case rt.Variable:return o().createElement(n.Icon,{name:"x"});default:return null}},st=e=>({table:(0,s.css)({width:"100%",tableLayout:"fixed",overflow:"scroll"}),scrollableTable:(0,s.css)({overflow:"auto"}),tableScroller:(0,s.css)({maxHeight:"16vh"}),selectedTableScroller:(0,s.css)({maxHeight:"13vh"}),header:(0,s.css)({background:e.colors.background.secondary}),row:(0,s.css)({borderBottom:`1px solid ${e.colors.border.weak}`,"&:last-of-type":{borderBottomColor:e.colors.border.medium}}),disabledRow:(0,s.css)({opacity:.5}),cell:(0,s.css)({padding:e.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:e.spacing(1,1,1,2)}}),collapseButton:(0,s.css)({margin:0}),loadingCell:(0,s.css)({textAlign:"center"}),spinner:(0,s.css)({marginBottom:0}),nestedEntry:(0,s.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,s.css)({margin:e.spacing(0,1,0,0)}),truncated:(0,s.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),resourceField:(0,s.css)({maxWidth:e.spacing(36),overflow:"hidden"}),resourceFieldButton:(0,s.css)({padding:"7px",textAlign:"left"}),nestedRowCheckbox:(0,s.css)({zIndex:0}),selectionFooter:(0,s.css)({background:e.colors.background.primary,paddingTop:e.spacing(2)}),loadingWrapper:(0,s.css)({textAlign:"center",paddingTop:e.spacing(2),paddingBottom:e.spacing(2),color:e.colors.text.secondary}),resultLimit:(0,s.css)({margin:"4px 0",fontStyle:"italic"}),modal:(0,s.css)({width:e.breakpoints.values.lg})}),nt=({entry:e,isSelected:t,isDisabled:a,isOpen:i,isSelectable:c,level:u,scrollIntoView:l,onToggleCollapse:p,onSelectedChange:m})=>{const d=(0,n.useTheme2)(),f=(0,n.useStyles2)(st),b=!!e.children,y=(0,r.useCallback)((()=>{p(e)}),[p,e]),v=(0,r.useCallback)((t=>{const r=t.target.checked;m(e,r)}),[e,m]),g=`${l?"table":"summary"}_checkbox_${e.uri}`;return(0,r.useEffect)((()=>{var e;t&&l&&(null===(e=document.getElementById(g))||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"}))}),[]),o().createElement("div",{className:f.nestedEntry,style:{marginLeft:u*(3*d.spacing.gridSize)}},b?o().createElement(n.IconButton,{className:f.collapseButton,name:i?"angle-down":"angle-right","aria-label":i?`Collapse ${e.name}`:`Expand ${e.name}`,onClick:y,id:e.id}):o().createElement(n.Space,{layout:"inline",h:2}),o().createElement(n.Space,{layout:"inline",h:2}),c&&o().createElement(o().Fragment,null,o().createElement(n.Checkbox,{id:g,onChange:v,disabled:a,value:t,className:f.nestedRowCheckbox}),o().createElement(n.Space,{layout:"inline",h:2})),o().createElement(ot,{entry:e,isOpen:i}),o().createElement(n.Space,{layout:"inline",h:1}),o().createElement("label",{htmlFor:g,className:(0,s.cx)(f.entryContentItem,f.truncated)},e.name))};var at=Symbol.for("immer-nothing"),it=Symbol.for("immer-draftable"),ct=Symbol.for("immer-state");function ut(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var lt=Object.getPrototypeOf;function pt(e){return!!e&&!!e[ct]}function mt(e){return!!e&&(ft(e)||Array.isArray(e)||!!e[it]||!!e.constructor?.[it]||ht(e)||wt(e))}var dt=Object.prototype.constructor.toString();function ft(e){if(!e||"object"!=typeof e)return!1;const t=lt(e);if(null===t)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===dt}function bt(e,t){0===yt(e)?Object.entries(e).forEach((([r,o])=>{t(r,o,e)})):e.forEach(((r,o)=>t(o,r,e)))}function yt(e){const t=e[ct];return t?t.type_:Array.isArray(e)?1:ht(e)?2:wt(e)?3:0}function vt(e,t){return 2===yt(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function gt(e,t,r){const o=yt(e);2===o?e.set(t,r):3===o?e.add(r):e[t]=r}function ht(e){return e instanceof Map}function wt(e){return e instanceof Set}function Ot(e){return e.copy_||e.base_}function St(e,t){if(ht(e))return new Map(e);if(wt(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&ft(e)){if(!lt(e)){const t=Object.create(null);return Object.assign(t,e)}return{...e}}const r=Object.getOwnPropertyDescriptors(e);delete r[ct];let o=Reflect.ownKeys(r);for(let t=0;t<o.length;t++){const s=o[t],n=r[s];!1===n.writable&&(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(r[s]={configurable:!0,writable:!0,enumerable:n.enumerable,value:e[s]})}return Object.create(lt(e),r)}function kt(e,t=!1){return Et(e)||pt(e)||!mt(e)||(yt(e)>1&&(e.set=e.add=e.clear=e.delete=zt),Object.freeze(e),t&&bt(e,((e,t)=>kt(t,!0)))),e}function zt(){ut(2)}function Et(e){return Object.isFrozen(e)}var Pt,jt={};function At(e){const t=jt[e];return t||ut(0),t}function Nt(){return Pt}function Tt(e,t){t&&(At("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Ct(e){It(e),e.drafts_.forEach(Mt),e.drafts_=null}function It(e){e===Pt&&(Pt=e.parent_)}function Dt(e){return Pt={drafts_:[],parent_:Pt,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Mt(e){const t=e[ct];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function _t(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return void 0!==e&&e!==r?(r[ct].modified_&&(Ct(t),ut(4)),mt(e)&&(e=Gt(t,e),t.parent_||qt(t,e)),t.patches_&&At("Patches").generateReplacementPatches_(r[ct].base_,e,t.patches_,t.inversePatches_)):e=Gt(t,r,[]),Ct(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==at?e:void 0}function Gt(e,t,r){if(Et(t))return t;const o=t[ct];if(!o)return bt(t,((s,n)=>Rt(e,o,t,s,n,r))),t;if(o.scope_!==e)return t;if(!o.modified_)return qt(e,o.base_,!0),o.base_;if(!o.finalized_){o.finalized_=!0,o.scope_.unfinalizedDrafts_--;const t=o.copy_;let s=t,n=!1;3===o.type_&&(s=new Set(t),t.clear(),n=!0),bt(s,((s,a)=>Rt(e,o,t,s,a,r,n))),qt(e,t,!1),r&&e.patches_&&At("Patches").generatePatches_(o,r,e.patches_,e.inversePatches_)}return o.copy_}function Rt(e,t,r,o,s,n,a){if(pt(s)){const a=Gt(e,s,n&&t&&3!==t.type_&&!vt(t.assigned_,o)?n.concat(o):void 0);if(gt(r,o,a),!pt(a))return;e.canAutoFreeze_=!1}else a&&r.add(s);if(mt(s)&&!Et(s)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Gt(e,s),t&&t.scope_.parent_||qt(e,s)}}function qt(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&kt(t,r)}var xt={get(e,t){if(t===ct)return e;const r=Ot(e);if(!vt(r,t))return function(e,t,r){const o=Vt(t,r);return o?"value"in o?o.value:o.get?.call(e.draft_):void 0}(e,r,t);const o=r[t];return e.finalized_||!mt(o)?o:o===Ft(e.base_,t)?($t(e),e.copy_[t]=Wt(o,e)):o},has:(e,t)=>t in Ot(e),ownKeys:e=>Reflect.ownKeys(Ot(e)),set(e,t,r){const o=Vt(Ot(e),t);if(o?.set)return o.set.call(e.draft_,r),!0;if(!e.modified_){const o=Ft(Ot(e),t),a=o?.[ct];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(((s=r)===(n=o)?0!==s||1/s==1/n:s!=s&&n!=n)&&(void 0!==r||vt(e.base_,t)))return!0;$t(e),Qt(e)}var s,n;return e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==Ft(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,$t(e),Qt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const r=Ot(e),o=Reflect.getOwnPropertyDescriptor(r,t);return o?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:o.enumerable,value:r[t]}:o},defineProperty(){ut(11)},getPrototypeOf:e=>lt(e.base_),setPrototypeOf(){ut(12)}},Lt={};function Ft(e,t){const r=e[ct];return(r?Ot(r):e)[t]}function Vt(e,t){if(!(t in e))return;let r=lt(e);for(;r;){const e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=lt(r)}}function Qt(e){e.modified_||(e.modified_=!0,e.parent_&&Qt(e.parent_))}function $t(e){e.copy_||(e.copy_=St(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function Wt(e,t){const r=ht(e)?At("MapSet").proxyMap_(e,t):wt(e)?At("MapSet").proxySet_(e,t):function(e,t){const r=Array.isArray(e),o={type_:r?1:0,scope_:t?t.scope_:Nt(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=o,n=xt;r&&(s=[o],n=Lt);const{revoke:a,proxy:i}=Proxy.revocable(s,n);return o.draft_=i,o.revoke_=a,i}(e,t);return(t?t.scope_:Nt()).drafts_.push(r),r}function Ut(e){if(!mt(e)||Et(e))return e;const t=e[ct];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=St(e,t.scope_.immer_.useStrictShallowCopy_)}else r=St(e,!0);return bt(r,((e,t)=>{gt(r,e,Ut(t))})),t&&(t.finalized_=!1),r}bt(xt,((e,t)=>{Lt[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Lt.deleteProperty=function(e,t){return Lt.set.call(this,e,t,void 0)},Lt.set=function(e,t,r){return xt.set.call(this,e[0],t,r,e[0])};var Xt=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if("function"==typeof e&&"function"!=typeof t){const r=t;t=e;const o=this;return function(e=r,...s){return o.produce(e,(e=>t.call(this,e,...s)))}}let o;if("function"!=typeof t&&ut(6),void 0!==r&&"function"!=typeof r&&ut(7),mt(e)){const s=Dt(this),n=Wt(e,void 0);let a=!0;try{o=t(n),a=!1}finally{a?Ct(s):It(s)}return Tt(s,r),_t(o,s)}if(!e||"object"!=typeof e){if(o=t(e),void 0===o&&(o=e),o===at&&(o=void 0),this.autoFreeze_&&kt(o,!0),r){const t=[],s=[];At("Patches").generateReplacementPatches_(e,o,t,s),r(t,s)}return o}ut(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...r)=>this.produceWithPatches(t,(t=>e(t,...r)));let r,o;return[this.produce(e,t,((e,t)=>{r=e,o=t})),r,o]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){var t;mt(e)||ut(8),pt(e)&&(pt(t=e)||ut(10),e=Ut(t));const r=Dt(this),o=Wt(e,void 0);return o[ct].isManual_=!0,It(r),o}finishDraft(e,t){const r=e&&e[ct];r&&r.isManual_||ut(9);const{scope_:o}=r;return Tt(o,t),_t(void 0,o)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const o=t[r];if(0===o.path.length&&"replace"===o.op){e=o.value;break}}r>-1&&(t=t.slice(r+1));const o=At("Patches").applyPatches_;return pt(e)?o(e,t):this.produce(e,(e=>o(e,t)))}},Bt=Xt.produce;Xt.produceWithPatches.bind(Xt),Xt.setAutoFreeze.bind(Xt),Xt.setUseStrictShallowCopy.bind(Xt),Xt.applyPatches.bind(Xt),Xt.createDraft.bind(Xt),Xt.finishDraft.bind(Xt);class Ht{static buildResourceUri(e,t,r){const o=[],{subscription:s,resourceGroup:n,metricNamespace:a,resourceName:i}=t;if(s&&(o.push("/subscriptions",s),n&&!r&&(o.push("resourceGroups",n),a&&i))){const t=e.replace(a),r=a.split("/"),s=e.replace(i),n=i.split("/"),c=r.shift();if(c&&o.push("providers",c),t.toLowerCase().startsWith("microsoft.storage/storageaccounts/")&&!s.endsWith("default")&&n.push("default"),n.length>r.length){const e=n.shift();e&&o.push(e)}for(const e in r)o.push(r[e]),o.push(n[e])}return o.join("/")}static buildAzureMonitorGetMetricNamespacesUrl(e,t,r,o,s){let n;if("resourceUri"in r)n=r.resourceUri;else{const{subscription:e,resourceGroup:t,metricNamespace:o,resourceName:a}=r;n=Ht.buildResourceUri(s,{subscription:e,resourceGroup:t,metricNamespace:o,resourceName:a})}return`${e}${n}/providers/microsoft.insights/metricNamespaces?api-version=${t}${o?"&region=global":""}`}static buildAzureMonitorGetMetricNamesUrl(e,t,r,o,s,n){let a;const{customNamespace:i,metricNamespace:c}=r;if("resourceUri"in r)a=r.resourceUri;else{const{subscription:e,resourceGroup:t,metricNamespace:n,resourceName:i}=r;a=Ht.buildResourceUri(o,{subscription:e,resourceGroup:t,metricNamespace:n,resourceName:i},s)}let u=`${e}${a}/providers/microsoft.insights/metricdefinitions?api-version=${t}`;return i&&(u+=`&metricnamespace=${encodeURIComponent(i)}`),s&&!i&&c&&(u+=`&metricnamespace=${encodeURIComponent(c)}`),n&&s&&(u+=`&region=${n}`),u}}function Kt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Kt(e,t,r[t])}))}return e}function Zt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Yt=RegExp("\\/subscriptions\\/(?<subscription>[^/]+)(?:\\/resourceGroups\\/(?<resourceGroup>[^/]+)(?:\\/providers\\/(?<metricNamespaceAndResource>.+))?)?");function er(e){const t=Yt.exec(e);var r;const o=null!==(r=null==t?void 0:t.groups)&&void 0!==r?r:{},{subscription:s,resourceGroup:n,metricNamespaceAndResource:a}=o,{metricNamespace:i,resourceName:c}=function(e){if(!e)return{};const t=e.split("/"),r=t.splice(0,2),o=t.splice(0,1);for(;t.length;){const e=t.shift();t.length%2==0?o.push(e):r.push(e)}return{metricNamespace:r.join("/"),resourceName:o.join("/")}}(a);return{subscription:s,resourceGroup:n,metricNamespace:i,resourceName:c}}function tr(e,t){return e.map((e=>rr(e,t)))}function rr(e,t){if("string"==typeof e){const r=er(e);return t&&(r.region=t),r}return e}function or(e){return e.map((e=>sr(e)))}function sr(e){return e?"string"==typeof e?e:Ht.buildResourceUri((0,t.getTemplateSrv)(),e):""}function nr(e){return!!e.match(/^[A-Z0-9]+/i)}function ar(e,t){var r,o,s,n;const a=rr(t),i=rr(e);return(null==i?void 0:i.subscription)===(null==a?void 0:a.subscription)&&(null==i||null===(r=i.resourceGroup)||void 0===r?void 0:r.toLowerCase())===(null==a||null===(o=a.resourceGroup)||void 0===o?void 0:o.toLowerCase())&&(c=null==i||null===(s=i.metricNamespace)||void 0===s?void 0:s.toLowerCase(),u=null==i?void 0:i.resourceName,l=null==a||null===(n=a.metricNamespace)||void 0===n?void 0:n.toLowerCase(),p=null==a?void 0:a.resourceName,(null==l?void 0:l.startsWith("microsoft.storage/storageaccounts"))&&(l="microsoft.storage/storageaccounts",(null==p?void 0:p.endsWith("/default"))&&(p=p.slice(0,-8))),c===l&&u===p);var c,u,l,p}function ir(e,t){for(const r of e){if(ar(r.uri,t))return r;if(r.children){const e=ir(r.children,t);if(e)return e}}}function cr(e,t,r){return Bt(e,(e=>{const o=ir(e,t);o&&(o.children=r)}))}function ur(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}const lr=({row:e,selectedRows:t,level:a,requestNestedRows:i,onRowSelectedChange:c,selectableEntryTypes:u,scrollIntoView:l,disableRow:p})=>{const m=(0,n.useStyles2)(st),[d,f]=(0,r.useState)("closed"),b=!!t.find((t=>t.uri.toLowerCase()===e.uri.toLowerCase())),y=!b&&p(e,t),v="open"===d,g=(h=function*(){"open"!==d?(f("loading"),i(e).then((()=>f("open"))).catch((()=>f("closed")))):f("closed")},w=function(){var e=this,t=arguments;return new Promise((function(r,o){var s=h.apply(e,t);function n(e){ur(s,r,o,n,a,"next",e)}function a(e){ur(s,r,o,n,a,"throw",e)}n(void 0)}))},function(){return w.apply(this,arguments)});var h,w,O;return(0,r.useEffect)((()=>{const r=t[0];var o;r&&ir(null!==(o=e.children)&&void 0!==o?o:[],r.uri)&&f("open")}),[t,e]),o().createElement(o().Fragment,null,o().createElement("tr",{className:(0,s.cx)(m.row,y&&m.disabledRow),key:e.id},o().createElement("td",{className:m.cell},o().createElement(nt,{level:a,isSelected:b,isDisabled:y,isOpen:v,entry:e,onToggleCollapse:g,onSelectedChange:c,isSelectable:u.some((t=>t===e.type)),scrollIntoView:l})),o().createElement("td",{className:m.cell},e.typeLabel),o().createElement("td",{className:m.cell},null!==(O=e.location)&&void 0!==O?O:"-")),v&&e.children&&Object.keys(e.children).length>0&&e.children.map((e=>o().createElement(lr,{key:e.uri,row:e,selectedRows:t,level:a+1,requestNestedRows:i,onRowSelectedChange:c,selectableEntryTypes:u,scrollIntoView:l,disableRow:p}))),o().createElement(n.FadeTransition,{visible:"loading"===d},o().createElement("tr",null,o().createElement("td",{className:(0,s.cx)(m.cell,m.loadingCell),colSpan:3},o().createElement(n.LoadingPlaceholder,{text:"Loading...",className:m.spinner})))))},pr=lr,mr=({searchFn:e})=>{const[t,s]=(0,r.useState)(""),a=(0,r.useMemo)((()=>(0,M.debounce)(e,600)),[e]);return(0,r.useEffect)((()=>()=>{a.cancel()}),[a]),o().createElement(n.Input,{"aria-label":"resource search",prefix:o().createElement(n.Icon,{name:"search"}),value:t,onChange:e=>{const t=e.currentTarget.value;s(t),a(t)},placeholder:"search for a resource","data-testid":re.resourcePicker.search.input})};function dr(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function fr(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){dr(n,o,s,a,i,"next",e)}function i(e){dr(n,o,s,a,i,"throw",e)}a(void 0)}))}}const br=({resourcePickerData:e,resources:t,onApply:a,onCancel:i,selectableEntryTypes:c,queryType:u,disableRow:l,renderAdvanced:p,selectionNotice:m})=>{const d=(0,n.useStyles2)(st),[f,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)([]),[g,h]=(0,r.useState)([]),[w,O]=(0,r.useState)(t),[S,k]=(0,r.useState)(void 0),[z,E]=(0,r.useState)(!1),P=null==m?void 0:m(g);(0,r.useEffect)((()=>{O(t)}),[t]);const j=(0,r.useCallback)(fr((function*(){if(!f){try{b(!0);const t=yield e.fetchInitialRows(u,tr(null!=w?w:{}));v(t)}catch(e){k(ge(e))}b(!1)}})),[w,f,e,u]);Ye((()=>{j()}));const A=e=>"string"==typeof e?""!==e:e.subscription&&e.resourceGroup&&e.resourceName&&e.metricNamespace;(0,r.useEffect)((()=>{w||h([]);const t=w.filter((e=>A(e))),r=w&&function(e,t){const r=[];return t.forEach((t=>{const o=ir(e,t);o&&r.push(o)})),r}(y,or(t));return(null==t?void 0:t.length)>r.length?h(e.parseRows(t)):r&&r.length?h(r):h([])}),[w,y,e]);const N=(0,r.useCallback)((T=fr((function*(t){var r;if(k(void 0),!(null===(r=t.children)||void 0===r?void 0:r.length))try{const r=yield e.fetchAndAppendNestedRow(y,t,u);v(r)}catch(e){throw k(ge(e)),e}})),function(e){return T.apply(this,arguments)}),[e,y,u]);var T;const C=(0,r.useCallback)(((e,t)=>{if(t){const t="logs"===u?e.uri:tr([e.uri],e.location)[0],r=w?w.concat(t):[t];O(r.filter((e=>A(e))))}else{const t=null==w?void 0:w.filter((t=>!ar(sr(t),e.uri)));O(t)}}),[u,w,O]),I=(0,r.useCallback)((()=>{w&&a("logs"===u?w:tr(w))}),[u,w,a]),D=(0,r.useCallback)(function(){var t=fr((function*(t){if(k(void 0),E(!1),t){try{b(!0);const r=yield e.search(t,u);v(r),r.length>=e.resultLimit&&E(!0)}catch(e){k(ge(e))}b(!1)}else j()}));return function(e){return t.apply(this,arguments)}}(),[j,e,u]);return o().createElement(o().Fragment,null,o().createElement(mr,{searchFn:D}),z?o().createElement("p",{className:d.resultLimit},"Showing first ",e.resultLimit," results"):o().createElement(n.Space,{v:2}),o().createElement("table",{className:d.table},o().createElement("thead",null,o().createElement("tr",{className:(0,s.cx)(d.row,d.header)},o().createElement("td",{className:d.cell},"Scope"),o().createElement("td",{className:d.cell},"Type"),o().createElement("td",{className:d.cell},"Location")))),o().createElement("div",{className:(0,s.cx)(d.scrollableTable,d.tableScroller)},o().createElement("table",{className:d.table},o().createElement("tbody",null,f&&o().createElement("tr",{className:(0,s.cx)(d.row)},o().createElement("td",{className:d.cell},o().createElement(n.LoadingPlaceholder,{text:"Loading..."}))),!f&&0===y.length&&o().createElement("tr",{className:(0,s.cx)(d.row)},o().createElement("td",{className:d.cell,"aria-live":"polite"},"No resources found")),!f&&y.map((e=>o().createElement(pr,{key:e.uri,row:e,selectedRows:g,level:0,requestNestedRows:N,onRowSelectedChange:C,selectableEntryTypes:c,scrollIntoView:!0,disableRow:l})))))),o().createElement("footer",{className:d.selectionFooter},g.length>0&&o().createElement(o().Fragment,null,o().createElement("h5",null,"Selection"),o().createElement("div",{className:(0,s.cx)(d.scrollableTable,d.selectedTableScroller)},o().createElement("table",{className:d.table},o().createElement("tbody",null,g.map((e=>o().createElement(pr,{key:e.uri,row:e,selectedRows:g,level:0,requestNestedRows:N,onRowSelectedChange:C,selectableEntryTypes:c,disableRow:()=>!1})))))),o().createElement(n.Space,{v:2}),(null==P?void 0:P.length)?o().createElement(n.Alert,{title:"",severity:"info"},P):null),o().createElement(tt,{resources:w,onChange:e=>O(e),renderAdvanced:p}),S&&o().createElement(o().Fragment,null,o().createElement(n.Space,{v:2}),o().createElement(n.Alert,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor"},S)),o().createElement(n.Modal.ButtonRow,null,o().createElement(n.Button,{onClick:i,variant:"secondary",fill:"outline"},"Cancel"),o().createElement(n.Button,{disabled:!!S||!w.every(A),onClick:I,"data-testid":re.resourcePicker.apply.button},"Apply"))))},yr=({resources:e,datasource:t})=>{const[s,n]=(0,r.useState)(tr(e));return(0,r.useEffect)((()=>{n(tr(e))}),[e]),e.length?o().createElement(vr,{resources:s}):o().createElement(o().Fragment,null,"Select a resource")},vr=({resources:e})=>{const t=(0,n.useStyles2)(st);let r="cube";const a=[];return e.forEach((e=>{if(!e.resourceName)return e.resourceGroup?(r="folder",void a.push(e.resourceGroup)):e.subscription?(r="layer-group",void a.push(e.subscription)):void 0;a.push(e.resourceName.split("/")[0])})),o().createElement("span",{className:(0,s.cx)(t.truncated,t.resourceField)},o().createElement(n.Icon,{name:r}),a.join(", "))},gr=({query:e,datasource:t,onQueryChange:s,selectableEntryTypes:a,queryType:i,resources:c,inlineField:u,labelWidth:l,disableRow:p,renderAdvanced:m,selectionNotice:d})=>{const f=(0,n.useStyles2)(st),[b,y]=(0,r.useState)(!1),v=(0,r.useCallback)((()=>{y(!0)}),[]),g=(0,r.useCallback)((()=>{y(!1)}),[]),h=(0,r.useCallback)((t=>{s(function(e,t,r){var o;if("logs"===t)return Zt(Jt({},e),{azureLogAnalytics:Zt(Jt({},e.azureLogAnalytics),{resources:or(r).filter((e=>""!==e))})});if("traces"===t)return Zt(Jt({},e),{azureTraces:Zt(Jt({},e.azureTraces),{resources:or(r).filter((e=>""!==e))})});const s=r.length?rr(r[0]):{};return Zt(Jt({},e),{subscription:s.subscription,azureMonitor:Zt(Jt({},e.azureMonitor),{metricNamespace:null===(o=s.metricNamespace)||void 0===o?void 0:o.toLocaleLowerCase(),region:s.region,resources:tr(r).filter((e=>""!==e.resourceName&&""!==e.metricNamespace&&""!==e.subscription&&""!==e.resourceGroup)),metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(e,i,t)),g()}),[g,s,e,i]);return o().createElement("span",{"data-testid":re.resourcePicker.select.button},o().createElement(n.Modal,{className:f.modal,title:"Select a resource",isOpen:b,onDismiss:g,trapFocus:!1},o().createElement(br,{resourcePickerData:t.resourcePickerData,resources:c,onApply:h,onCancel:g,selectableEntryTypes:a,queryType:i,disableRow:p,renderAdvanced:m,selectionNotice:d})),o().createElement($e,{label:"Resource",inlineField:u,labelWidth:l},o().createElement(n.Button,{className:f.resourceFieldButton,variant:"secondary",onClick:v,type:"button"},o().createElement(yr,{resources:c,datasource:t}))))};var hr=Object.defineProperty,wr=Object.defineProperties,Or=Object.getOwnPropertyDescriptors,Sr=Object.getOwnPropertySymbols,kr=Object.prototype.hasOwnProperty,zr=Object.prototype.propertyIsEnumerable,Er=(e,t,r)=>t in e?hr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Pr=e=>{var t=e,{className:r}=t,a=((e,t)=>{var r={};for(var o in e)kr.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&Sr)for(var o of Sr(e))t.indexOf(o)<0&&zr.call(e,o)&&(r[o]=e[o]);return r})(t,["className"]);const i=(0,n.useStyles2)(jr);return o().createElement(n.Button,(c=((e,t)=>{for(var r in t||(t={}))kr.call(t,r)&&Er(e,r,t[r]);if(Sr)for(var r of Sr(t))zr.call(t,r)&&Er(e,r,t[r]);return e})({},a),u={className:(0,s.cx)(r,i.button)},wr(c,Or(u))));var c,u},jr=e=>({button:(0,s.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})}),Ar=e=>({resourceList:(0,s.css)({width:"100%",display:"flex",marginBlock:e.spacing(1)})}),Nr=({resources:e,onChange:t})=>{const s=(0,n.useStyles2)(Ar);return(0,r.useEffect)((()=>{0===e.length&&t([""])}),[e,t]),o().createElement(o().Fragment,null,o().createElement(n.Label,null,o().createElement("h6",null,"Resource URI(s)"," ",o().createElement(n.Tooltip,{content:o().createElement(o().Fragment,null,"Manually edit the"," ",o().createElement("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank"},"resource uri"),". Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"),placement:"right",interactive:!0},o().createElement(n.Icon,{name:"info-circle"})))),e.map(((r,a)=>o().createElement("div",{key:`resource-${a+1}`},o().createElement("div",{className:s.resourceList},o().createElement(n.Input,{id:`input-advanced-resource-picker-${a+1}`,value:r,onChange:r=>((r,o)=>{const s=[...e];s[r]=o,t(s)})(a,r.currentTarget.value),placeholder:"ex: /subscriptions/$subId","data-testid":`input-advanced-resource-picker-${a+1}`}),o().createElement(Pr,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>(r=>{const o=[...e];o.splice(r,1),t(o)})(a),"data-testid":"remove-resource",hidden:1===e.length}))))),o().createElement(n.Button,{"aria-label":"Add",icon:"plus",variant:"secondary",onClick:()=>{t(e.concat(""))},type:"button"},"Add resource URI"))};function Tr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Cr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Tr(e,t,r[t])}))}return e}function Ir(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Dr(e,t){return Ir(Cr({},e),{azureLogAnalytics:Ir(Cr({},e.azureLogAnalytics),{query:t})})}function Mr(e,t){return Ir(Cr({},e),{azureLogAnalytics:Ir(Cr({},e.azureLogAnalytics),{resultFormat:t})})}function _r(e,t){return Ir(Cr({},e),{azureLogAnalytics:Ir(Cr({},e.azureLogAnalytics),{timeColumn:t})})}function Gr(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}const Rr=({query:e,onQueryChange:t,schema:s})=>{var a;const[i,c]=(0,r.useState)();(0,r.useEffect)((()=>{if(!s||!i)return;const e=(t=function*({monaco:e,editor:t},r){try{const o=e.languages,s=t.getModel();if(s){const e=yield o.kusto.getKustoWorker(),t=yield e(null==s?void 0:s.uri);yield t.setSchema(r)}}catch(e){console.error(e)}},r=function(){var e=this,r=arguments;return new Promise((function(o,s){var n=t.apply(e,r);function a(e){Gr(n,o,s,a,i,"next",e)}function i(e){Gr(n,o,s,a,i,"throw",e)}a(void 0)}))},function(e,t){return r.apply(this,arguments)});var t,r;e(i,s).catch((e=>console.error(e)))}),[s,i]);const u=(0,r.useCallback)(((e,t)=>{c({monaco:t,editor:e})}),[]),l=(0,r.useCallback)((r=>{t(Dr(e,r))}),[t,e]);var p;return o().createElement(n.CodeEditor,{value:null!==(p=null===(a=e.azureLogAnalytics)||void 0===a?void 0:a.query)&&void 0!==p?p:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:l,onSave:l,onEditorDidMount:u})};function qr({query:e,onQueryChange:t,schema:s}){var a,i,c,u,l,p;const[m,d]=(0,r.useState)(),[f,b]=(0,r.useState)(),y=(0,r.useCallback)((r=>t(_r(e,r))),[e,t]);(0,r.useEffect)((()=>{var t;if(s&&(null===(t=e.azureLogAnalytics)||void 0===t?void 0:t.dashboardTime)){const t=[],r=new Set,o=new Map,n=s.database;if(n)for(const e of n.tables){const s=e.columns.reduce(((t,o,s)=>("datetime"===o.type&&(e.timespanColumn&&e.timespanColumn===o.name||(t.push({value:o.name,label:`${e.name} > ${o.name}`}),r.add(o.name))),t)),[]);t.push(...s),e.timespanColumn&&!o.has(e.timespanColumn)&&o.set(e.timespanColumn,{value:e.timespanColumn,label:e.timespanColumn})}b(t);const a=Array.from(o.values());if(d(a),!e.azureLogAnalytics.timeColumn||e.azureLogAnalytics.timeColumn&&!r.has(e.azureLogAnalytics.timeColumn)&&!o.has(e.azureLogAnalytics.timeColumn))return a&&a.length?(y(a[0].value),void y(a[0].value)):t&&t.length?void y(t[0].value):void y("TimeGenerated")}}),[s,null===(a=e.azureLogAnalytics)||void 0===a?void 0:a.dashboardTime,null===(i=e.azureLogAnalytics)||void 0===i?void 0:i.timeColumn,y]);const v=(0,r.useCallback)((r=>{if(!r.value)return;const o=_r(e,r.value);t(o)}),[t,e]);var g;return o().createElement(o().Fragment,null,o().createElement(n.InlineField,{label:"Time-range",tooltip:o().createElement("span",null,"Specifies the time-range used to query. The ",o().createElement("code",null,"Query")," option will only use time-ranges specified in the query. ",o().createElement("code",null,"Dashboard")," will only use the Grafana time-range.")},o().createElement(n.RadioButtonGroup,{options:[{label:"Query",value:!1},{label:"Dashboard",value:!0}],value:null!==(g=null===(c=e.azureLogAnalytics)||void 0===c?void 0:c.dashboardTime)&&void 0!==g&&g,size:"md",onChange:r=>t(function(e,t){return Ir(Cr({},e),{azureLogAnalytics:Ir(Cr({},e.azureLogAnalytics),{dashboardTime:t})})}(e,r))})),(null===(u=e.azureLogAnalytics)||void 0===u?void 0:u.dashboardTime)&&o().createElement(n.InlineField,{label:"Time Column",tooltip:o().createElement("span",null,"Specifies the time column used for filtering. Defaults to the first tables ",o().createElement("code",null,"timeSpan")," column, the first ",o().createElement("code",null,"datetime")," column found or ",o().createElement("code",null,"TimeGenerated"),".")},o().createElement(n.Select,{options:[{label:"Default time columns",options:null!=m?m:[{value:"TimeGenerated",label:"TimeGenerated"}]},{label:"Other time columns",options:null!=f?f:[]}],onChange:v,value:(null===(l=e.azureLogAnalytics)||void 0===l?void 0:l.timeColumn)?null===(p=e.azureLogAnalytics)||void 0===p?void 0:p.timeColumn:m?m[0]:f?f[0]:{value:"TimeGenerated",label:"TimeGenerated"},allowCustomValue:!0})))}function xr(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function Lr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Lr(e,t,r[t])}))}return e}function Vr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Qr(){var e;return e=function*(e,t,r){var o;if(void 0!==(null===(o=t.azureLogAnalytics)||void 0===o?void 0:o.workspace)&&!t.azureLogAnalytics.resources){let o;o=nr(t.azureLogAnalytics.workspace)?yield e.resourcePickerData.getResourceURIFromWorkspace(t.azureLogAnalytics.workspace):t.azureLogAnalytics.workspace;const s=Vr(Fr({},t),{azureLogAnalytics:Vr(Fr({},t.azureLogAnalytics),{resource:o,workspace:void 0})});delete s.azureLogAnalytics.workspace,r(s)}},Qr=function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){xr(n,o,s,a,i,"next",e)}function i(e){xr(n,o,s,a,i,"throw",e)}a(void 0)}))},Qr.apply(this,arguments)}const $r=({query:e,datasource:t,subscriptionId:s,variableOptionGroup:a,onChange:i,setError:c,hideFormatAs:u,timeRange:l,data:p})=>{var m,d,f;const b=function(e,t,o){const[s,n]=(0,r.useState)();return(0,r.useEffect)((()=>{(function(e,t,r){return Qr.apply(this,arguments)})(e,t,o).catch((e=>n({title:"Unable to migrate workspace as a resource",message:e.message})))}),[e,t,o]),s}(t,e,i),[y,v]=(0,r.useState)();(0,r.useEffect)((()=>{var r;(null===(r=e.azureLogAnalytics)||void 0===r?void 0:r.resources)&&e.azureLogAnalytics.resources.length&&t.azureLogAnalyticsDatasource.getKustoSchema(e.azureLogAnalytics.resources[0]).then((e=>{v(e)}))}),[null===(m=e.azureLogAnalytics)||void 0===m?void 0:m.resources,t.azureLogAnalyticsDatasource]);let g=null;if(null==p?void 0:p.series){var h,w;const t=p.series.find((t=>t.refId===e.refId));var O,S;t&&(null===(w=t.meta)||void 0===w||null===(h=w.custom)||void 0===h?void 0:h.azurePortalLink)&&(g=o().createElement(o().Fragment,null,o().createElement(n.LinkButton,{size:"md",target:"_blank",style:{marginTop:"22px"},href:null===(S=t.meta)||void 0===S||null===(O=S.custom)||void 0===O?void 0:O.azurePortalLink},"View query in Azure Portal")))}var k;return o().createElement("span",{"data-testid":re.logsQueryEditor.container.input},o().createElement(Ee,null,o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(gr,{query:e,datasource:t,inlineField:!0,labelWidth:10,subscriptionId:s,variableOptionGroup:a,onQueryChange:i,setError:c,selectableEntryTypes:[rt.Subscription,rt.ResourceGroup,rt.Resource,rt.Variable],resources:null!==(k=null===(d=e.azureLogAnalytics)||void 0===d?void 0:d.resources)&&void 0!==k?k:[],queryType:"logs",disableRow:(e,t)=>{var r,o;return 0!==t.length&&(null===(r=rr(e.uri,e.location).metricNamespace)||void 0===r?void 0:r.toLowerCase())!==(null===(o=rr(t[0].uri,t[0].location).metricNamespace)||void 0===o?void 0:o.toLowerCase())},renderAdvanced:(e,t)=>o().createElement(Nr,{resources:e,onChange:t}),selectionNotice:()=>"You may only choose items of the same resource type."}),o().createElement(qr,{query:e,datasource:t,variableOptionGroup:a,onQueryChange:i,setError:c,schema:y}))),o().createElement(Rr,{query:e,datasource:t,subscriptionId:s,variableOptionGroup:a,onQueryChange:i,setError:c,schema:y}),o().createElement(Pe,null,o().createElement(Ae,null,!u&&o().createElement(et,{query:e,datasource:t,subscriptionId:s,variableOptionGroup:a,onQueryChange:i,setError:c,inputId:"azure-monitor-logs",options:[{label:"Log",value:$.Logs},{label:"Time series",value:$.TimeSeries},{label:"Table",value:$.Table}],defaultValue:$.Logs,setFormatAs:Mr,resultFormat:null===(f=e.azureLogAnalytics)||void 0===f?void 0:f.resultFormat}),g,b&&o().createElement(n.Alert,{title:b.title},b.message)))))};var Wr=l(146),Ur=l.n(Wr);l(874);let Xr=null;function Br({query:t,lang:n,className:a}){const i=(0,r.useContext)(Xr||e.ThemeContext),c=Hr(i),u=Ur().highlight(t,n.grammar,n.name);return o().createElement("div",{className:(0,s.cx)(c.editorField,"prism-syntax-highlight",a),"aria-label":"selector",dangerouslySetInnerHTML:{__html:u}})}new WeakMap;const Hr=e=>({editorField:(0,s.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})}),Kr=[{label:"abs",detail:"abs(a)",documentation:"Absolute value."},{label:"ceil",detail:"ceil(a)",documentation:"Round to ceiling (the smallest integer that is greater than the value of a)."},{label:"floor",detail:"floor(a)",documentation:"Round to floor (the largest integer that is smaller than the value of a)."},{label:"greatest",detail:"greatest(a,b, ... z)",documentation:"Returns the largest value."},{label:"least",detail:"least(a, b, ... z)",documentation:"Returns the smallest value."},{label:"log",detail:"log(a)",documentation:"Natural logarithm."},{label:"sqrt",detail:"sqrt(a)",documentation:"Square root."},{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"coalesce",detail:"coalesce(fieldname1, fieldname2, ... fieldnamex)",documentation:"Returns the first non-null value from the list."},{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"concat",detail:"concat(string1, string2, ... stringz)",documentation:"Concatenates the strings."},{label:"ltrim",detail:"ltrim(string) or ltrim(string1, string2)",documentation:"Remove white space from the left of the string. If the function has a second string argument, it removes the characters of string2 from the left of string1."},{label:"rtrim",detail:"rtrim(string) or rtrim(string1, string2)",documentation:"Remove white space from the right of the string. If the function has a second string argument, it removes the characters of string2 from the right of string1."},{label:"trim",detail:"trim(string) or trim(string1, string2)",documentation:"Remove white space from both ends of the string. If the function has a second string argument, it removes the characters of string2 from both sides of string1."},{label:"strlen",detail:"strlen(string)",documentation:"Returns the length of the string in Unicode code points."},{label:"toupper",detail:"toupper(string)",documentation:"Converts the string to uppercase."},{label:"tolower",detail:"tolower(string)",documentation:"Converts the string to lowercase."},{label:"substr",detail:"substr(string1, x), or substr(string1, x, y)",documentation:"Returns a substring from the index specified by the number argument to the end of the string. If the function has a second number argument, it contains the length of the substring to be retrieved."},{label:"replace",detail:"replace(string1, string2, string3)",documentation:"Replaces all instances of string2 in string1 with string3."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."},{label:"bin",detail:"bin(period)",documentation:"Rounds the value of @timestamp to the given period and then truncates."},{label:"datefloor",detail:"datefloor(a, period)",documentation:"Truncates the timestamp to the given period."},{label:"dateceil",detail:"dateceil(a, period)",documentation:"Rounds up the timestamp to the given period and then truncates."},{label:"fromMillis",detail:"fromMillis(fieldname)",documentation:"Interprets the input field as the number of milliseconds since the Unix epoch and converts it to a timestamp."},{label:"toMillis",detail:"toMillis(fieldname)",documentation:"Converts the timestamp found in the named field into a number representing the milliseconds since the Unix epoch."},{label:"isValidIp",detail:"isValidIp(fieldname)",documentation:"Returns true if the field is a valid v4 or v6 IP address."},{label:"isValidIpV4",detail:"isValidIpV4(fieldname)",documentation:"Returns true if the field is a valid v4 IP address."},{label:"isValidIpV6",detail:"isValidIpV6(fieldname)",documentation:"Returns true if the field is a valid v6 IP address."},{label:"isIpInSubnet",detail:"isIpInSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 or v6 IP address within the specified v4 or v6 subnet."},{label:"isIpv4InSubnet",detail:"isIpv4InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 IP address within the specified v4 subnet."},{label:"isIpv6InSubnet",detail:"isIpv6InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v6 IP address within the specified v6 subnet."},{label:"avg",detail:"avg(NumericFieldname)",documentation:"The average of the values in the specified field."},{label:"count",detail:"count(fieldname) or count(*)",documentation:"Counts the log records."},{label:"count_distinct",detail:"count_distinct(fieldname)",documentation:"Returns the number of unique values for the field."},{label:"max",detail:"max(fieldname)",documentation:"The maximum of the values for this log field in the queried logs."},{label:"min",detail:"min(fieldname)",documentation:"The minimum of the values for this log field in the queried logs."},{label:"pct",detail:"pct(fieldname, value)",documentation:"A percentile indicates the relative standing of a value in a datas."},{label:"stddev",detail:"stddev(NumericFieldname)",documentation:"The standard deviation of the values in the specified field."},{label:"sum",detail:"sum(NumericFieldname)",documentation:"The sum of the values in the specified field."},{label:"earliest",detail:"earliest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the earliest time stamp in the queried logs."},{label:"latest",detail:"latest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the latest time stamp in the queried logs."},{label:"sortsFirst",detail:"sortsFirst(fieldname)",documentation:"Returns the value of fieldName that sorts first in the queried logs."},{label:"sortsLast",detail:"sortsLast(fieldname)",documentation:"Returns the value of fieldName that sorts last in the queried logs."}],Jr={comment:{pattern:/^#.*/,greedy:!0},backticks:{pattern:/`.*?`/,alias:"string",greedy:!0},quote:{pattern:/".*?"/,alias:"string",greedy:!0},regex:{pattern:/\/.*?\/(?=\||\s*$|,)/,greedy:!0},"query-command":{pattern:new RegExp(`\\b(?:${[{label:"fields",documentation:"Retrieves the specified fields from log events"},{label:"display",documentation:"Specifies which fields to display in the query results"},{label:"filter",documentation:"Filters the results of a query based on one or more conditions"},{label:"stats",documentation:"Calculates aggregate statistics based on the values of log fields"},{label:"sort",documentation:"Sorts the retrieved log events"},{label:"limit",documentation:"Specifies the number of log events returned by the query"},{label:"parse",documentation:"Extracts data from a log field, creating one or more ephemeral fields that you can process further in the query"}].map((e=>e.label)).join("|")})\\b`,"i"),alias:"function"},function:{pattern:new RegExp(`\\b(?:${Kr.map((e=>e.label)).join("|")})\\b`,"i")},keyword:{pattern:new RegExp(`(\\s+)(${["as","like","by","in","desc","asc"].join("|")})(?=\\s+)`,"i"),lookbehind:!0},"log-group-name":{pattern:/[\.\-_/#A-Za-z0-9]+/},"field-name":{pattern:/(@?[_a-zA-Z]+[_.0-9a-zA-Z]*)|(`((\\`)|([^`]))*?`)/,greedy:!0},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,"command-separator":{pattern:/\|/,alias:"punctuation"},"comparison-operator":{pattern:/([<>]=?)|(!?=)/},punctuation:/[{}()`,.]/,whitespace:/\s+/};function Zr(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function Yr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Yr(e,t,r[t])}))}return e}function to(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ro=e=>{const[s,a]=(0,r.useState)(null),[i,c]=(0,r.useState)({}),[u,l]=(0,r.useState)(null),[p,m]=(0,r.useState)(!0),[d,f]=(0,r.useState)(""),b=(0,n.useStyles2)(oo),y={grammar:Jr,name:"kql"},v=(0,r.useMemo)((()=>s?Object.keys(s).map((e=>({label:e,value:e}))):[]),[s]),g=(h=function*(){yield e.datasource.getAzureLogAnalyticsCheatsheetQueries().then((e=>{e.categories.sort(((e,t)=>e.displayName.toLowerCase()===t.displayName.toLowerCase()?0:e.displayName.toLowerCase()<t.displayName.toLowerCase()?-1:1));const t=e.categories.reduce(((t,r)=>{const o=r.related.queries.map((t=>e.queries.find((e=>e.id===t))));return t[r.displayName]=o,c(to(eo({},i),{[r.id]:!1})),t}),{});return a(t),l(t),m(!1),t}))},w=function(){var e=this,t=arguments;return new Promise((function(r,o){var s=h.apply(e,t);function n(e){Zr(s,r,o,n,a,"next",e)}function a(e){Zr(s,r,o,n,a,"throw",e)}n(void 0)}))},function(){return w.apply(this,arguments)});var h,w;return(0,r.useEffect)((()=>{s||g()})),o().createElement("div",null,!p&&u?o().createElement("div",null,o().createElement("div",{className:b.filterAlignment},o().createElement(n.Input,{value:d,onChange:e=>{f(e.currentTarget.value);const t=(e=>{const t=Object.keys(u);if(e.length>0&&s){const r=Object.keys(s).reduce(((r,o)=>{const n=s[o].filter((t=>t.displayName.toLowerCase().includes(e.toLowerCase())));return t.includes(o)&&(r[o]=n),r}),{});return l(r),r}return Object.keys(u).length!==Object.keys(s).length?(l(u),u):(l(s),s)})(e.currentTarget.value);l(t)},placeholder:"Search Logs queries",width:40}),o().createElement(n.Field,{label:"Categories",className:b.categoryDropdown},o().createElement(n.Select,{options:v,value:"",onChange:e=>(e=>{if(e.length>0){const t=e.map((e=>e.label)).reduce(((e,t)=>(e[t]=s[t],e)),{});l(t)}else l(s)})(e),allowCustomValue:!1,backspaceRemovesValue:!0,placeholder:"All categories",isClearable:!0,noOptionsMessage:"Unable to list all categories",formatCreateLabel:e=>`Category: ${e}`,isSearchable:!0,isMulti:!0,width:40}))),o().createElement("div",{className:b.spacing},"Query results:"," ",Object.keys(u).reduce(((e,t)=>u[t].length+e),0)),o().createElement(n.CustomScrollbar,{showScrollIndicators:!0,autoHeightMax:"350px"},Object.keys(u).map((r=>{if(u[r].length)return o().createElement(n.Collapse,{label:r+" "+`(${u[r].length})`,collapsible:!0,isOpen:i[r],onToggle:e=>c(to(eo({},i),{[r]:e})),key:r},u[r].map((r=>o().createElement(n.Card,{className:b.card,key:r.id},o().createElement(n.Card.Heading,null,r.displayName),o().createElement(n.CustomScrollbar,{showScrollIndicators:!0,autoHeightMax:"100px"},o().createElement(Br,{"aria-label":`${r.displayName} raw query`,query:r.body,lang:y,className:b.rawQuery})),o().createElement(n.Card.Actions,null,o().createElement(n.Button,{size:"sm","aria-label":"use this query button",onClick:()=>{e.onChange({refId:"A",queryType:Q.LogAnalytics,azureLogAnalytics:{query:r.body},datasource:e.datasource}),(0,t.reportInteraction)("grafana_azure_cheatsheet_logs_query_selected",{id:r.id,queryName:r.displayName,query:r.body,queryCategories:r.related.categories})}},"Use this query"))))))})))):o().createElement(n.LoadingPlaceholder,{text:"Loading..."}))},oo=e=>({card:(0,s.css)({width:"90%",display:"flex",flexDirection:"column"}),rawQuery:(0,s.css)({backgroundColor:`${e.colors.background.primary}`,padding:`${e.spacing(1)}`,marginTop:`${e.spacing(1)}`}),spacing:(0,s.css)({marginBottom:`${e.spacing(1)}`}),filterAlignment:(0,s.css)({display:"flex"}),categoryDropdown:(0,s.css)({margin:"0 0 10px 10px",display:"flex",flexDirection:"row",alignItems:"center"})}),so=e=>{const{isOpen:t,onClose:r,datasource:s,onChange:a}=e;return o().createElement(n.Modal,{"aria-label":"Kick start your query modal",isOpen:t,title:"Kick start your query",onDismiss:r},o().createElement(ro,{onChange:e=>{a(e),r()},query:{refId:"A"},datasource:s}))},no={"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems":"Backup Items","microsoft.resources/subscriptions":"Subscriptions","microsoft.resources/subscriptions/resourcegroups":"Resource groups","citrix.services/xenappessentials":"Citrix Virtual Apps Essentials","citrix.services/xendesktopessentials":"Citrix Virtual Desktops Essentials","dynatrace.observability/monitors":"Dynatrace","github.enterprise/accounts":"GitHub AE","microsoft.aad/domainservices":"Azure AD Domain Services","microsoft.aadiam/privatelinkforazuread":"Private Link for Azure AD","microsoft.agfoodplatform/farmbeats":"Azure FarmBeats","microsoft.analysisservices/servers":"Analysis Services","microsoft.anybuild/clusters":"AnyBuild clusters","microsoft.apimanagement/service":"API Management services","microsoft.appconfiguration/configurationstores":"App Configuration","microsoft.appplatform/spring":"Azure Spring Cloud","microsoft.attestation/attestationproviders":"Attestation providers","microsoft.authorization/resourcemanagementprivatelinks":"Resource management private links","microsoft.automation/automationaccounts":"Automation Accounts","microsoft.automation/automationaccounts/runbooks":"Runbook","microsoft.autonomoussystems/workspaces":"Bonsai","microsoft.avs/privateclouds":"AVS Private clouds","microsoft.azureactivedirectory/b2cdirectories":"B2C Tenants","microsoft.azureactivedirectory/guestusages":"Guest Usages","microsoft.azurearcdata/datacontrollers":"Azure Arc data controllers","microsoft.azurearcdata/postgresinstances":"Azure Arc-enabled PostgreSQL Hyperscale server groups","microsoft.azurearcdata/sqlmanagedinstances":"SQL managed instances - Azure Arc","microsoft.azurearcdata/sqlserverinstances":"SQL Server - Azure Arc","microsoft.azuredata/sqlserverregistrations":"SQL Server registries","microsoft.azurepercept/accounts":"Azure Percept accounts","microsoft.azurestackhci/clusters":"Azure Stack HCI","microsoft.azurestackhci/virtualmachines":"Azure Stack HCI virtual machine - Azure Arc","microsoft.baremetal/crayservers":"Cray Servers","microsoft.baremetal/monitoringservers":"Monitoring Servers","microsoft.baremetalinfrastructure/baremetalinstances":"BareMetal Instances","microsoft.batch/batchaccounts":"Batch accounts","microsoft.bing/accounts":"Bing Resources","microsoft.botservice/botservices":"Bot Services","microsoft.cache/redis":"Azure Cache for Redis","microsoft.cache/redisenterprise":"Redis Enterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies":"Content Delivery Network WAF policies","microsoft.cdn/profiles (front doors standard/premium":"Preview)","microsoft.cdn/profiles/afdendpoints":"Endpoints","microsoft.cdn/profiles/endpoints":"Endpoints","microsoft.certificateregistration/certificateorders":"App Service Certificates","microsoft.chaos/chaosexperiments":"Chaos Experiments (Classic)","microsoft.chaos/experiments":"Chaos Experiments","microsoft.classiccompute/domainnames":"Cloud services (classic)","microsoft.classiccompute/virtualmachines":"Virtual machines (classic)","microsoft.classicnetwork/networksecuritygroups":"Network security groups (classic)","microsoft.classicnetwork/reservedips":"Reserved IP addresses (classic)","microsoft.classicnetwork/virtualnetworks":"Virtual networks (classic)","microsoft.classicstorage/storageaccounts":"Storage accounts (classic)","microsoft.cloudtest/accounts":"CloudTest Accounts","microsoft.cloudtest/hostedpools":"1ES Hosted Pools","microsoft.cloudtest/images":"CloudTest Images","microsoft.cloudtest/pools":"CloudTest Pools","microsoft.clusterstor/nodes":"ClusterStors","microsoft.cognitiveservices/accounts":"Cognitive Services","microsoft.compute/availabilitysets":"Availability sets","microsoft.compute/capacityreservationgroups":"Capacity Reservation Groups","microsoft.compute/cloudservices":"Cloud services (extended support)","microsoft.compute/diskaccesses":"Disk Accesses","microsoft.compute/diskencryptionsets":"Disk Encryption Sets","microsoft.compute/disks":"Disks","microsoft.compute/galleries":"Azure compute galleries","microsoft.compute/galleries/applications":"VM application definitions","microsoft.compute/galleries/applications/versions":"VM application versions","microsoft.compute/galleries/images":"VM image definitions","microsoft.compute/galleries/images/versions":"VM image versions","microsoft.compute/hostgroups":"Host groups","microsoft.compute/hostgroups/hosts":"Hosts","microsoft.compute/images":"Images","microsoft.compute/proximityplacementgroups":"Proximity placement groups","microsoft.compute/restorepointcollections":"Restore Point Collections","microsoft.compute/snapshots":"Snapshots","microsoft.compute/sshpublickeys":"SSH keys","microsoft.compute/virtualmachines":"Virtual machines","microsoft.compute/virtualmachinescalesets":"Virtual machine scale sets","microsoft.confidentialledger/ledgers":"Confidential Ledgers","microsoft.confluent/organizations":"Confluent organizations","microsoft.connectedcache/cachenodes":"Connected Cache Resources","microsoft.connectedcache/enterprisecustomers":"Connected Cache Resources","microsoft.connectedvehicle/platformaccounts":"Connected Vehicle Platforms","microsoft.connectedvmwarevsphere/vcenters":"VMware vCenters","microsoft.connectedvmwarevsphere/virtualmachines":"VMware + AVS virtual machines","microsoft.containerinstance/containergroups":"Container instances","microsoft.containerregistry/registries":"Container registries","microsoft.containerregistry/registries/replications":"Container registry replications","microsoft.containerregistry/registries/webhooks":"Container registry webhooks","microsoft.containerservice/managedclusters":"Kubernetes services","microsoft.dashboard/grafana":"Grafana Workspaces","microsoft.databox/jobs":"Azure Data Box","microsoft.databoxedge/databoxedgedevices":"Azure Stack Edge / Data Box Gateway","microsoft.databricks/workspaces":"Azure Databricks Services","microsoft.datacatalog/catalogs":"Data Catalog","microsoft.datacollaboration/workspaces":"Project CI","microsoft.datadog/monitors":"Datadog","microsoft.datafactory/datafactories":"Data factories","microsoft.datafactory/factories":"Data factories (V2)","microsoft.datalakeanalytics/accounts":"Data Lake Analytics","microsoft.datalakestore/accounts":"Data Lake Storage Gen1","microsoft.datamigration/services":"Azure Database Migration Services","microsoft.datamigration/services/projects":"Azure Database Migration Projects","microsoft.datamigration/sqlmigrationservices":"Azure Database Migration Services","microsoft.dataprotection/backupvaults":"Backup vaults","microsoft.dataprotection/resourceguards":"Resource Guards (Preview)","microsoft.datareplication/replicationvaults":"Site Recovery Vaults","microsoft.datashare/accounts":"Data Shares","microsoft.dbformariadb/servers":"Azure Database for MariaDB servers","microsoft.dbformysql/flexibleservers":"Azure Database for MySQL flexible servers","microsoft.dbformysql/servers":"Azure Database for MySQL servers","microsoft.dbforpostgresql/flexibleservers":"Azure Database for PostgreSQL flexible servers","microsoft.dbforpostgresql/servergroups":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servergroupsv2":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servers":"Azure Database for PostgreSQL servers","microsoft.dbforpostgresql/serversv2":"Azure Database for PostgreSQL servers v2","microsoft.deploymentmanager/rollouts":"Rollouts","microsoft.desktopvirtualization/applicationgroups":"Application groups","microsoft.desktopvirtualization/hostpools":"Host pools","microsoft.desktopvirtualization/scalingplans":"Scaling plans","microsoft.desktopvirtualization/workspaces":"Workspaces","microsoft.devices/iothubs":"IoT Hub","microsoft.devices/provisioningservices":"Device Provisioning Services","microsoft.deviceupdate/accounts":"Device Update for IoT Hubs","microsoft.devops/pipelines":"DevOps Starter","microsoft.devtestlab/labs":"DevTest Labs","microsoft.devtestlab/labs/virtualmachines":"Virtual machines","microsoft.digitaltwins/digitaltwinsinstances":"Azure Digital Twins","microsoft.documentdb/cassandraclusters":"Azure Managed Instance for Apache Cassandra","microsoft.documentdb/databaseaccounts":"Azure Cosmos DB accounts","microsoft.domainregistration/domains":"App Service Domains","microsoft.edgeorder/addresses":"Azure Edge Hardware Center Address","microsoft.edgeorder/orderitems":"Azure Edge Hardware Center","microsoft.elastic/monitors":"Elasticsearch (Elastic Cloud)","microsoft.eventgrid/domains":"Event Grid Domains","microsoft.eventgrid/partnernamespaces":"Event Grid Partner Namespaces","microsoft.eventgrid/partnerregistrations":"Event Grid Partner Registrations","microsoft.eventgrid/partnertopics":"Event Grid Partner Topics","microsoft.eventgrid/systemtopics":"Event Grid System Topics","microsoft.eventgrid/topics":"Event Grid Topics","microsoft.eventhub/clusters":"Event Hubs Clusters","microsoft.eventhub/namespaces":"Event Hubs Namespaces","microsoft.experimentation/experimentworkspaces":"Experiment Workspaces","microsoft.extendedlocation/customlocations":"Custom locations","microsoft.fidalgo/devcenters":"Fidalgo DevCenters","microsoft.fidalgo/networksettings":"Network Configurations","microsoft.fidalgo/projects":"Fidalgo Projects","microsoft.fidalgo/projects/environments":"Fidalgo Environments","microsoft.fluidrelay/fluidrelayservers":"Fluid Relay","microsoft.genomics/accounts":"Genomics accounts","microsoft.hanaonazure/hanainstances":"SAP HANA on Azure","microsoft.hanaonazure/sapmonitors":"Azure Monitors for SAP Solutions","microsoft.hdinsight/clusterpools":"HDInsight cluster pools","microsoft.hdinsight/clusterpools/clusters":"HDInsight gen2 clusters","microsoft.hdinsight/clusterpools/clusters/sessionclusters":"HDInsight session clusters","microsoft.hdinsight/clusters":"HDInsight clusters","microsoft.healthbot/healthbots":"Azure Health Bot","microsoft.healthcareapis/services":"Azure API for FHIR","microsoft.healthcareapis/workspaces":"Healthcare APIs Workspaces","microsoft.healthcareapis/workspaces/dicomservices":"DICOM services","microsoft.healthcareapis/workspaces/fhirservices":"FHIR services","microsoft.healthcareapis/workspaces/iotconnectors":"IoT connectors","microsoft.hpcworkbench/instances":"HPC Workbenches (preview)","microsoft.hpcworkbench/instances/chambers":"Chambers (preview)","microsoft.hpcworkbench/instances/chambers/accessprofiles":"Chamber Profiles (preview)","microsoft.hpcworkbench/instances/chambers/workloads":"Chamber VMs (preview)","microsoft.hpcworkbench/instances/consortiums":"Consortiums (preview)","microsoft.hybridcompute/machines":"Servers - Azure Arc","microsoft.hybridcompute/privatelinkscopes":"Azure Arc Private Link Scopes","microsoft.hybridcontainerservice/provisionedclusters":"Provisioned clusters","microsoft.hybriddata/datamanagers":"StorSimple Data Managers","microsoft.hybridnetwork/devices":"Azure Network Function Manager – Devices","microsoft.hybridnetwork/networkfunctions":"Azure Network Function Manager – Network Functions","microsoft.importexport/jobs":"Import/export jobs","microsoft.insights/components":"Application Insights","microsoft.insights/datacollectionendpoints":"Data collection endpoints","microsoft.insights/datacollectionrules":"Data collection rules","microsoft.insights/privatelinkscopes":"Azure Monitor Private Link Scopes","microsoft.insights/webtests":"Availability tests","microsoft.insights/workbooks":"Azure Workbooks","microsoft.insights/workbooktemplates":"Azure Workbook Templates","microsoft.iotcentral/iotapps":"IoT Central Applications","microsoft.keyvault/vaults":"Key vaults","microsoft.kubernetes/connectedclusters":"Kubernetes - Azure Arc","microsoft.kusto/clusters":"Azure Data Explorer Clusters","microsoft.kusto/clusters/databases":"Azure Data Explorer Databases","microsoft.labservices/labaccounts":"Lab accounts","microsoft.labservices/labplans":"Lab plans","microsoft.labservices/labs":"Labs","microsoft.loadtestservice/loadtests":"Azure Load Testing","microsoft.logic/integrationaccounts":"Integration accounts","microsoft.logic/integrationserviceenvironments":"Integration Service Environments","microsoft.logic/integrationserviceenvironments/managedapis":"Managed Connector","microsoft.logic/workflows":"Logic apps","microsoft.logz/monitors":"Logz main account","microsoft.logz/monitors/accounts":"Logz sub account","microsoft.logz/monitors/metricssource":"Logz metrics data source","microsoft.machinelearning/commitmentplans":"Machine Learning Studio (classic) web service plans","microsoft.machinelearning/webservices":"Machine Learning Studio (classic) web services","microsoft.machinelearning/workspaces":"Machine Learning Studio (classic) workspaces","microsoft.machinelearningservices/workspaces":"Machine learning","microsoft.machinelearningservices/workspaces/onlineendpoints":"Machine learning online endpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments":"Machine learning online deployments","microsoft.maintenance/maintenanceconfigurations":"Maintenance Configurations","microsoft.managedidentity/userassignedidentities":"Managed Identities","microsoft.maps/accounts":"Azure Maps Accounts","microsoft.maps/accounts/creators":"Azure Maps Creator Resources","microsoft.media/mediaservices":"Media Services","microsoft.media/mediaservices/liveevents":"Live events","microsoft.media/mediaservices/streamingendpoints":"Streaming Endpoints","microsoft.media/videoanalyzers":"Video Analyzers","microsoft.migrate/projects":"Migration projects","microsoft.mixedreality/objectanchorsaccounts":"Object Anchors Accounts","microsoft.mixedreality/objectunderstandingaccounts":"Object Understanding Accounts","microsoft.mixedreality/remoterenderingaccounts":"Remote Rendering Accounts","microsoft.mixedreality/spatialanchorsaccounts":"Spatial Anchors Accounts","microsoft.mobilenetwork/mobilenetworks":"Mobile Networks","microsoft.mobilenetwork/mobilenetworks/datanetworks":"Data Networks","microsoft.mobilenetwork/mobilenetworks/services":"Services","microsoft.mobilenetwork/mobilenetworks/simpolicies":"Sim Policies","microsoft.mobilenetwork/mobilenetworks/sites":"Mobile Network Sites","microsoft.mobilenetwork/mobilenetworks/slices":"Slices","microsoft.mobilenetwork/packetcorecontrolplanes":"Packet Core Control Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes":"Packet Core Data Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks":"Attached Data Networks","microsoft.mobilenetwork/sims":"Sims","microsoft.netapp/netappaccounts":"NetApp accounts","microsoft.netapp/netappaccounts/capacitypools":"Capacity pools","microsoft.netapp/netappaccounts/capacitypools/volumes":"Volumes","microsoft.netapp/netappaccounts/capacitypools/volumes/snapshots":"Snapshots","microsoft.netapp/netappaccounts/snapshotpolicies":"Snapshot policies","microsoft.network/applicationgateways":"Application gateways","microsoft.network/applicationgatewaywebapplicationfirewallpolicies":"Application Gateway WAF policies","microsoft.network/applicationsecuritygroups":"Application security groups","microsoft.network/azurefirewalls":"Firewalls","microsoft.network/bastionhosts":"Bastions","microsoft.network/connections":"Connections","microsoft.network/customipprefixes":"Custom IP Prefixes","microsoft.network/ddosprotectionplans":"DDoS protection plans","microsoft.network/dnsforwardingrulesets":"Dns Forwarding Rulesets","microsoft.network/dnsresolvers":"DNS Private Resolvers","microsoft.network/dnszones":"DNS zones","microsoft.network/expressroutecircuits":"ExpressRoute circuits","microsoft.network/expressrouteports":"ExpressRoute Direct","microsoft.network/firewallpolicies":"Firewall Policies","microsoft.network/frontdoors":"Front Doors","microsoft.network/frontdoorwebapplicationfirewallpolicies":"Web Application Firewall policies (WAF)","microsoft.network/ipgroups":"IP Groups","microsoft.network/loadbalancers":"Load balancers","microsoft.network/localnetworkgateways":"Local network gateways","microsoft.network/natgateways":"NAT gateways","microsoft.network/networkexperimentprofiles":"Internet Analyzer profiles","microsoft.network/networkinterfaces":"Network interfaces","microsoft.network/networkmanagers":"Network Managers","microsoft.network/networksecuritygroups":"Network security groups","microsoft.network/networkwatchers":"Network Watchers","microsoft.network/networkwatchers/connectionmonitors":"Connection Monitors","microsoft.network/networkwatchers/flowlogs":"NSG Flow Logs","microsoft.network/privatednszones":"Private DNS zones","microsoft.network/privateendpoints":"Private endpoints","microsoft.network/privatelinkservices":"Private link services","microsoft.network/publicipaddresses":"Public IP addresses","microsoft.network/publicipprefixes":"Public IP Prefixes","microsoft.network/routefilters":"Route filters","microsoft.network/routetables":"Route tables","microsoft.network/serviceendpointpolicies":"Service endpoint policies","microsoft.network/trafficmanagerprofiles":"Traffic Manager profiles","microsoft.network/virtualnetworkgateways":"Virtual network gateways","microsoft.network/virtualnetworks":"Virtual networks","microsoft.network/virtualwans":"Virtual WANs","microsoft.notificationhubs/namespaces":"Notification Hub Namespaces","microsoft.notificationhubs/namespaces/notificationhubs":"Notification Hubs","microsoft.openenergyplatform/energyservices":"Project Oak Forest","microsoft.openlogisticsplatform/workspaces":"Open Supply Chain Platform","microsoft.operationalinsights/querypacks":"Log Analytics query packs","microsoft.operationalinsights/workspaces":"Log Analytics workspaces","microsoft.operationsmanagement/solutions":"Solutions","microsoft.orbital/contactprofiles":"Contact Profiles","microsoft.orbital/edgesites":"Edge Sites","microsoft.orbital/groundstations":"Ground Stations","microsoft.orbital/l2connections":"L2 Connections","microsoft.orbital/spacecrafts":"Spacecrafts","microsoft.peering/peerings":"Peerings","microsoft.peering/peeringservices":"Peering Services","microsoft.playfab/playeraccountpools":"PlayFab player account pools","microsoft.playfab/titles":"PlayFab titles","microsoft.portal/dashboards":"Shared dashboards","microsoft.powerbidedicated/capacities":"Power BI Embedded","microsoft.purview/accounts":"Microsoft Purview accounts","microsoft.quantum/workspaces":"Quantum Workspaces","microsoft.recommendationsservice/accounts":"Intelligent Recommendations Accounts","microsoft.recommendationsservice/accounts/modeling":"Modeling","microsoft.recommendationsservice/accounts/serviceendpoints":"Service Endpoints","microsoft.recoveryservices/vaults":"Recovery Services vaults","microsoft.redhatopenshift/openshiftclusters":"Azure Red Hat OpenShift","microsoft.relay/namespaces":"Relays","microsoft.resourceconnector/appliances":"Resource bridges","microsoft.resourcegraph/queries":"Resource Graph queries","microsoft.resources/deploymentscripts":"Deployment Scripts","microsoft.resources/templatespecs":"Template specs","microsoft.saas/applications":"Software as a Service (classic)","microsoft.saas/resources":"SaaS","microsoft.scom/managedinstances":"Aquila Instances","microsoft.scvmm/virtualmachines":"SCVMM virtual machine - Azure Arc","microsoft.scvmm/vmmservers":"SCVMM management servers","microsoft.search/searchservices":"Search services","microsoft.securitydetonation/chambers":"Security Detonation Chambers","microsoft.servicebus/namespaces":"Service Bus Namespaces","microsoft.servicefabric/clusters":"Service Fabric clusters","microsoft.servicefabric/managedclusters":"Service Fabric managed clusters","microsoft.serviceshub/connectors":"Services Hub Connectors","microsoft.signalrservice/signalr":"SignalR","microsoft.signalrservice/webpubsub":"Web PubSub Service","microsoft.solutions/applicationdefinitions":"Service catalog managed application definitions","microsoft.solutions/applications":"Managed applications","microsoft.sql/instancepools":"Instance pools","microsoft.sql/managedinstances":"SQL managed instances","microsoft.sql/managedinstances/databases":"Managed databases","microsoft.sql/servers":"SQL servers","microsoft.sql/servers/databases":"SQL databases","microsoft.sql/servers/elasticpools":"SQL elastic pools","microsoft.sql/servers/jobagents":"Elastic Job agents","microsoft.sql/virtualclusters":"Virtual clusters","microsoft.sqlvirtualmachine/sqlvirtualmachines":"SQL virtual machines","microsoft.storage/storageaccounts":"Storage accounts","microsoft.storagecache/amlfilesystems":"Lustre File Systems","microsoft.storagecache/caches":"HPC caches","microsoft.storagepool/diskpools":"Disk Pools","microsoft.storagesync/storagesyncservices":"Storage Sync Services","microsoft.storagesyncdev/storagesyncservices":"Storage Sync Services","microsoft.storagesyncint/storagesyncservices":"Storage Sync Services","microsoft.storsimple/managers":"StorSimple Device Managers","microsoft.streamanalytics/clusters":"Stream Analytics clusters","microsoft.streamanalytics/streamingjobs":"Stream Analytics jobs","microsoft.synapse/privatelinkhubs":"Azure Synapse Analytics (private link hubs)","microsoft.synapse/workspaces":"Azure Synapse Analytics","microsoft.synapse/workspaces/bigdatapools":"Apache Spark pools","microsoft.synapse/workspaces/kustopools":"Data Explorer pools (preview)","microsoft.synapse/workspaces/sqlpools":"Dedicated SQL pools","microsoft.testbase/testbaseaccounts":"Test Base Accounts","microsoft.testbase/testbaseaccounts/packages":"Test Base Packages","microsoft.timeseriesinsights/environments":"Time Series Insights environments","microsoft.timeseriesinsights/environments/eventsources":"Time Series Insights event sources","microsoft.timeseriesinsights/environments/referencedatasets":"Time Series Insights reference data sets","microsoft.videoindexer/accounts":"Video Analyzer for Media","microsoft.virtualmachineimages/imagetemplates":"Image Templates","microsoft.visualstudio/account":"Azure DevOps organizations","microsoft.visualstudio/account/project":"DevOps Starter","microsoft.vmwarecloudsimple/dedicatedcloudnodes":"CloudSimple Nodes","microsoft.vmwarecloudsimple/dedicatedcloudservices":"CloudSimple Services","microsoft.vmwarecloudsimple/virtualmachines":"CloudSimple Virtual Machines","microsoft.vsonline/plans":"Visual Studio Online Plans","microsoft.web/connectiongateways":"On-premises data gateways","microsoft.web/connections":"API Connections","microsoft.web/containerapps":"Container Apps","microsoft.web/customapis":"Logic Apps Custom Connector","microsoft.web/hostingenvironments":"App Service Environments","microsoft.web/kubeenvironments":"App Service Kubernetes Environments","microsoft.web/serverfarms":"App Service plans","microsoft.web/sites":"App Services","microsoft.web/sites/slots":"App Service (Slots)","microsoft.web/staticsites":"Static Web Apps","microsoft.windowsesu/multipleactivationkeys":"Windows Multiple Activation Keys","microsoft.windowsiot/deviceservices":"Windows 10 IoT Core Services","microsoft.workloads/monitors":"Azure Monitors for SAP Solutions (v2)","microsoft.workloads/phpworkloads":"Scalable WordPress on Linux","microsoft.workloads/sapvirtualinstances":"SAP Virtual Instances","microsoft.workloads/sapvirtualinstances/applicationinstances":"SAP app server instances","microsoft.workloads/sapvirtualinstances/centralinstances":"SAP central server instances","microsoft.workloads/sapvirtualinstances/databaseinstances":"SAP database server instances","nginx.nginxplus/nginxdeployments":"NGINX Deployment","providers.test/statefulibizaengines":"VLCentral Help","wandisco.fusion/fusiongroups":"LiveData Planes","wandisco.fusion/fusiongroups/azurezones":"Azure Zones","wandisco.fusion/fusiongroups/azurezones/plugins":"Plugins","wandisco.fusion/fusiongroups/hivereplicationrules":"Hive Replication Rules","wandisco.fusion/fusiongroups/managedonpremzones":"On-premises Zones","wandisco.fusion/fusiongroups/replicationrules":"Replication Rules","wandisco.fusion/migrators":"LiveData Migrators","wandisco.fusion/migrators/exclusiontemplates":"Exclusions","wandisco.fusion/migrators/livedatamigrations":"Migrations","wandisco.fusion/migrators/metadatamigrations":"Metadata Migrations","wandisco.fusion/migrators/metadatatargets":"Metadata Targets","wandisco.fusion/migrators/pathmappings":"Path Mappings","wandisco.fusion/migrators/targets":"Targets","microsoft.security/insights/classification":"Data Sensitivity Security Insights (Preview)","microsoft.security/locations/alerts":"Security Alerts"},ao={"microsoft.cache/redis":!0,"microsoft.dbforpostgresql/flexibleservers":!0,"microsoft.storagecache/amlfilesystems":!0,"microsoft.databoxedge/databoxedgedevices":!0,"microsoft.dataprotection/backupvaults":!0,"microsoft.netapp/netappaccounts/capacitypools":!0,"microsoft.network/networkwatchers/connectionmonitors":!0,"microsoft.keyvault/vaults":!0,"microsoft.recoveryservices/vaults":!0,"microsoft.sql/servers/databases":!0,"microsoft.sql/servers/elasticpools":!0,"microsoft.compute/virtualmachinescalesets":!0,"microsoft.compute/virtualmachines":!0,"microsoft.signalrservice/webpubsub":!0},io=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.app/containerapps","microsoft.app/managedenvironments","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.automation/automationaccounts","microsoft.avs/privateclouds","microsoft.azuresphere/catalogs","microsoft.azurestackhci/clusters","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.bing/accounts","microsoft.botservice/botservices","microsoft.botservice/botservices/channels","microsoft.botservice/botservices/connections","microsoft.botservice/checknameavailability","microsoft.botservice/hostsettings","microsoft.botservice/listauthserviceproviders","microsoft.botservice/listqnamakerendpointkeys","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.classiccompute/domainnames","microsoft.classiccompute/domainnames/slots/roles","microsoft.classiccompute/virtualmachines","microsoft.classicstorage/storageaccounts","microsoft.classicstorage/storageaccounts/blobservices","microsoft.classicstorage/storageaccounts/fileservices","microsoft.classicstorage/storageaccounts/queueservices","microsoft.classicstorage/storageaccounts/tableservices","microsoft.cloudtest/hostedpools","microsoft.cloudtest/pools","microsoft.clusterstor/nodes","microsoft.codesigning/codesigningaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/cloudservices","microsoft.compute/cloudservices/roles","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.compute/virtualmachinescalesets/virtualmachines","microsoft.connectedcache/cachenodes","microsoft.connectedcache/enterprisemcccustomers","microsoft.connectedcache/ispcustomers","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerinstance/containerscalesets","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.dataprotection/backupvaults","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.documentdb/mongoclusters","microsoft.edgezones/edgezones","microsoft.enterpriseknowledgegraph/services","microsoft.eventgrid/domains","microsoft.eventgrid/eventsubscriptions","microsoft.eventgrid/extensiontopics","microsoft.eventgrid/namespaces","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.healthcareapis/workspaces/iotconnectors","microsoft.healthmodel/healthmodels","microsoft.hybridcontainerservice/provisionedclusters","microsoft.hybridnetwork/networkfunctions","microsoft.hybridnetwork/virtualnetworkfunctions","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.iotcentral/iotapps","microsoft.iotspaces/graph","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kubernetesconfiguration/extensions","microsoft.kusto/clusters","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.machinelearningservices/workspaces/onlineendpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments","microsoft.managednetworkfabric/internetgateways","microsoft.managednetworkfabric/l3isolationdomains","microsoft.managednetworkfabric/networkdevices","microsoft.maps/accounts","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.mixedreality/remoterenderingaccounts","microsoft.mixedreality/spatialanchorsaccounts","microsoft.mobilenetwork/packetcorecontrolplanes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes","microsoft.monitor/accounts","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnsforwardingrulesets","microsoft.network/dnsresolvers","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutecircuits/peerings","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networkmanagers/ipampools","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privatednszones","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/publicipprefixes","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualhubs","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/virtualrouters","microsoft.network/vpngateways","microsoft.networkanalytics/dataconnectors","microsoft.networkcloud/baremetalmachines","microsoft.networkcloud/clusters","microsoft.networkcloud/storageappliances","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.orbital/contactprofiles","microsoft.orbital/l2connections","microsoft.orbital/spacecrafts","microsoft.orbital/terminals","microsoft.peering/peerings","microsoft.peering/peeringservices","microsoft.playfab/titles","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.search/searchservices","microsoft.securitydetonation/chambers","microsoft.securitydetonation/securitydetonationchambers","microsoft.servicebus/namespaces","microsoft.servicefabricmesh/applications","microsoft.servicenetworking/trafficcontrollers","microsoft.signalrservice/signalr","microsoft.signalrservice/signalr/replicas","microsoft.signalrservice/webpubsub","microsoft.signalrservice/webpubsub/replicas","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.sql/servers/jobagents","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/objectreplicationpolicies","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/storagetasks","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storagetasks","microsoft.storagecache/amlfilesystems","microsoft.storagecache/caches","microsoft.storagemover/storagemovers","microsoft.storagesync/storagesyncservices","microsoft.storagetasks/storagetasks","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.vmwarecloudsimple/virtualmachines","microsoft.voiceservices/communicationsgateways","microsoft.web/containerapps","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/multirolepools","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots","microsoft.web/staticsites","nginx.nginxplus/nginxdeployments","wandisco.fusion/migrators","wandisco.fusion/migrators/datatransferagents","wandisco.fusion/migrators/livedatamigrations","wandisco.fusion/migrators/metadatamigrations"];function co(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){co(e,t,r[t])}))}return e}function lo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const po=e=>({resourceList:(0,s.css)({display:"flex",columnGap:e.spacing(1),flexWrap:"wrap",marginBottom:e.spacing(1)}),resource:(0,s.css)({flex:"0 0 auto"}),resourceLabel:(0,s.css)({padding:e.spacing(1)}),resourceGroupAndName:(0,s.css)({display:"flex",columnGap:e.spacing(.5)})}),mo=({resources:e,onChange:t})=>{var s,a,i;const c=(0,n.useStyles2)(po);(0,r.useEffect)((()=>{0===e.length&&t([{}])}),[e,t]);const u=(r,o)=>{const s=[...e];s[r]=o,t(s)},l=r=>{t(e.map((e=>uo({},e,r))))};var p,m,d;return o().createElement(o().Fragment,null,o().createElement(n.InlineField,{label:"Subscription",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-subscription",labelWidth:15,"data-testid":re.resourcePicker.advanced.subscription.input},o().createElement(n.Input,{id:"input-advanced-resource-picker-subscription",value:null!==(p=null===(s=e[0])||void 0===s?void 0:s.subscription)&&void 0!==p?p:"",onChange:e=>l({subscription:e.currentTarget.value}),placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeee"})),o().createElement(n.InlineField,{label:"Namespace",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-metricNamespace",labelWidth:15,"data-testid":re.resourcePicker.advanced.namespace.input},o().createElement(n.Input,{id:"input-advanced-resource-picker-metricNamespace",value:null!==(m=null===(a=e[0])||void 0===a?void 0:a.metricNamespace)&&void 0!==m?m:"",onChange:e=>l({metricNamespace:e.currentTarget.value}),placeholder:"Microsoft.Insights/metricNamespaces"})),o().createElement(n.InlineField,{label:"Region",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-region",labelWidth:15,"data-testid":re.resourcePicker.advanced.region.input,tooltip:"The code region of the resource. Optional for one resource but mandatory when selecting multiple ones."},o().createElement(n.Input,{id:"input-advanced-resource-picker-region",value:null!==(d=null===(i=e[0])||void 0===i?void 0:i.region)&&void 0!==d?d:"",onChange:e=>l({region:e.currentTarget.value}),placeholder:"northeurope"})),o().createElement("div",{className:c.resourceList},e.map(((r,s)=>{var a,i;return o().createElement("div",{key:`resource-${s+1}`,className:c.resource},1!==e.length&&o().createElement(n.Label,{className:c.resourceLabel},"Resource ",s+1),o().createElement(n.InlineField,{label:"Resource Group",transparent:!0,htmlFor:`input-advanced-resource-picker-resourceGroup-${s+1}`,labelWidth:15,"data-testid":re.resourcePicker.advanced.resourceGroup.input},o().createElement("div",{className:c.resourceGroupAndName},o().createElement(n.Input,{id:`input-advanced-resource-picker-resourceGroup-${s+1}`,value:null!==(a=null==r?void 0:r.resourceGroup)&&void 0!==a?a:"",onChange:e=>u(s,lo(uo({},r),{resourceGroup:e.currentTarget.value})),placeholder:"resource-group"}),o().createElement(Pr,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>(r=>{const o=[...e];o.splice(r,1),t(o)})(s),hidden:1===e.length,"data-testid":"remove-resource"}))),o().createElement(n.InlineField,{label:"Resource Name",transparent:!0,htmlFor:`input-advanced-resource-picker-resourceName-${s+1}`,labelWidth:15,"data-testid":re.resourcePicker.advanced.resource.input},o().createElement(n.Input,{id:`input-advanced-resource-picker-resourceName-${s+1}`,value:null!==(i=null==r?void 0:r.resourceName)&&void 0!==i?i:"",onChange:e=>u(s,lo(uo({},r),{resourceName:e.currentTarget.value})),placeholder:"name"})))}))),o().createElement(n.Button,{"aria-label":"Add",icon:"plus",variant:"secondary",onClick:()=>{var r,o;t(e.concat({subscription:null===(r=e[0])||void 0===r?void 0:r.subscription,metricNamespace:null===(o=e[0])||void 0===o?void 0:o.metricNamespace,resourceGroup:"",resourceName:""}))},type:"button"},"Add resource"))};function fo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){fo(e,t,r[t])}))}return e}function yo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function vo(e,t){var r;return(null===(r=e.azureMonitor)||void 0===r?void 0:r.customNamespace)===t?e:(null==t?void 0:t.toLowerCase().startsWith("microsoft.storage/storageaccounts/"))?yo(bo({},e),{azureMonitor:yo(bo({},e.azureMonitor),{metricNamespace:t,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})}):yo(bo({},e),{azureMonitor:yo(bo({},e.azureMonitor),{customNamespace:t,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function go(e,t){var r;return(null===(r=e.azureMonitor)||void 0===r?void 0:r.timeGrain)===t?e:yo(bo({},e),{azureMonitor:yo(bo({},e.azureMonitor),{timeGrain:t})})}function ho(e,t){var r;return(null===(r=e.azureMonitor)||void 0===r?void 0:r.dimensionFilters)===t?e:yo(bo({},e),{azureMonitor:yo(bo({},e.azureMonitor),{dimensionFilters:t})})}const wo=({query:e,variableOptionGroup:t,onQueryChange:s,aggregationOptions:a,isLoading:i})=>{var c,u;const l=(0,r.useCallback)((t=>{if(!t.value)return;const r=function(e,t){var r;return(null===(r=e.azureMonitor)||void 0===r?void 0:r.aggregation)===t?e:yo(bo({},e),{azureMonitor:yo(bo({},e.azureMonitor),{aggregation:t})})}(e,t.value);s(r)}),[s,e]),p=L(a,t,null===(c=e.azureMonitor)||void 0===c?void 0:c.aggregation);return o().createElement($e,{label:"Aggregation"},o().createElement(n.Select,{inputId:"azure-monitor-metrics-aggregation-field",value:(null===(u=e.azureMonitor)||void 0===u?void 0:u.aggregation)||null,onChange:l,options:p,isLoading:i}))},Oo=o().forwardRef((function({items:e,renderItem:t,onChange:r},s){return o().createElement(ke,null,e.map(((s,n)=>o().createElement("div",{key:n},t(s,(t=>((t,o)=>{const s=[...e];s[t]=o,r(s)})(n,t)),(()=>(t=>{const o=[...e];o.splice(t,1),r(o)})(n)))))),o().createElement(n.Button,{ref:s,onClick:()=>{const t=[...e,{}];r(t)},variant:"secondary",size:"md",icon:"plus","aria-label":"Add",type:"button"}))})),So=({data:e,query:t,dimensionOptions:s,onQueryChange:a})=>{var i;const c=(0,r.useMemo)((()=>{var e,r;return null!==(r=null===(e=t.azureMonitor)||void 0===e?void 0:e.dimensionFilters)&&void 0!==r?r:[]}),[null===(i=t.azureMonitor)||void 0===i?void 0:i.dimensionFilters]),u=((e,t)=>{const[o,s]=(0,r.useState)({});return(0,r.useEffect)((()=>{var r;let o={};if(null==e||null===(r=e.series)||void 0===r?void 0:r.length){const r=e.series.flat().filter((e=>e.refId===t.refId)).flatMap((e=>e.fields)).map((e=>e.labels)).flat().filter((e=>null!=e));for(const e of r)for(const[t,r]of Object.entries(e)){const e=t.toLowerCase();o[e]?o[e].add(r):o[e]=new Set([r])}}s((e=>{const t={},r=Object.keys(o);if(0===r.length)return e;for(const s of r)e[s]&&o[s].size<e[s].size?t[s]=e[s]:t[s]=o[s];return t}))}),[null==e?void 0:e.series,t.refId]),o})(e,t),l=[{label:"==",value:"eq"},{label:"!=",value:"ne"},{label:"starts with",value:"sw"}],p=(0,r.useMemo)((()=>{let e=s;return c.length&&(e=s.filter((e=>!c.some((t=>t.dimension===e.value))))),e}),[c,s]),m=(e,t,r,o)=>{t[e]=r,o(t)},d=(e,t)=>{var r;const o=Array.from(null!==(r=u[t.toLowerCase()])&&void 0!==r?r:[]);return o.find((t=>t===e))?o.map((e=>({value:e,label:e}))):[...o,...e&&"*"!==e?[e]:[]].map((e=>({value:e,label:e})))},f=(e,t)=>{const r=d(void 0,t);if(e)for(const t of e)r.find((e=>e.value===t))||r.push({value:t,label:t});return r};return o().createElement($e,{label:"Dimensions"},o().createElement(Oo,{items:c,onChange:e=>{const r=e.map((e=>{var t,r,o;return{dimension:null!==(t=e.dimension)&&void 0!==t?t:"",operator:null!==(r=e.operator)&&void 0!==r?r:"eq",filters:null!==(o=e.filters)&&void 0!==o?o:[]}}));a(ho(t,r))},renderItem:(e,t,r)=>{var a,i,c,u;return o().createElement(n.HorizontalGroup,{spacing:"none"},o().createElement(n.Select,{menuShouldPortal:!0,placeholder:"Field",value:e.dimension,options:(u=e.dimension||"",p.concat(s.filter((e=>e.value===u)))),onChange:r=>{var o;return m("dimension",e,null!==(o=r.value)&&void 0!==o?o:"",t)}}),o().createElement(n.Select,{menuShouldPortal:!0,placeholder:"Operation",value:e.operator,options:(c=e.operator||"eq",l.find((e=>e.value===c))?l:[...l,...c?[{label:c,value:c}]:[]]),onChange:r=>{var o;return m("operator",e,null!==(o=r.value)&&void 0!==o?o:"",t)},allowCustomValue:!0}),"eq"===e.operator||"ne"===e.operator?o().createElement(n.MultiSelect,{menuShouldPortal:!0,placeholder:"Select value(s)",value:e.filters,options:f(e.filters,null!==(a=e.dimension)&&void 0!==a?a:""),onChange:r=>m("filters",e,r.map((e=>{var t;return null!==(t=e.value)&&void 0!==t?t:""})),t),"aria-label":"dimension-labels-select",allowCustomValue:!0}):o().createElement(n.Select,{menuShouldPortal:!0,placeholder:"Select value",value:e.filters?e.filters[0]:"",allowCustomValue:!0,options:d(e.filters?e.filters[0]:"",null!==(i=e.dimension)&&void 0!==i?i:""),onChange:r=>{var o;return m("filters",e,[null!==(o=null==r?void 0:r.value)&&void 0!==o?o:""],t)},isClearable:!0}),o().createElement(Pr,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:r,type:"button"}))}}))},ko=({onQueryChange:e,query:t})=>{var s,a;const[i,c]=(0,r.useState)(null!==(a=null===(s=t.azureMonitor)||void 0===s?void 0:s.alias)&&void 0!==a?a:""),u=(0,r.useCallback)((e=>{e.target instanceof HTMLInputElement&&c(e.target.value)}),[]),l=(0,r.useCallback)((()=>{const r=function(e,t){var r;return(null===(r=e.azureMonitor)||void 0===r?void 0:r.alias)===t?e:yo(bo({},e),{azureMonitor:yo(bo({},e.azureMonitor),{alias:t})})}(t,i);e(r)}),[e,t,i]);return o().createElement($e,{label:"Legend format"},o().createElement(n.Input,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:i,onChange:u,onBlur:l,width:38}))},zo=({metricNames:e,query:t,variableOptionGroup:s,onQueryChange:a})=>{var i,c;const u=(0,r.useCallback)((e=>{if(!e.value)return;const r=function(e,t){var r;return(null===(r=e.azureMonitor)||void 0===r?void 0:r.metricName)===t?e:yo(bo({},e),{azureMonitor:yo(bo({},e.azureMonitor),{metricName:t,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(t,e.value);a(r)}),[a,t]),l=L(e,s,null===(i=t.azureMonitor)||void 0===i?void 0:i.metricName);var p;return o().createElement($e,{label:"Metric","data-testid":re.metricsQueryEditor.metricName.input},o().createElement(n.Select,{inputId:"azure-monitor-metrics-metric-field",value:null!==(p=null===(c=t.azureMonitor)||void 0===c?void 0:c.metricName)&&void 0!==p?p:null,onChange:u,options:l,allowCustomValue:!0}))},Eo=({metricNamespaces:e,query:t,variableOptionGroup:s,onQueryChange:a})=>{var i,c;const u=(0,r.useCallback)((e=>{if(!e.value)return;const r=vo(t,e.value);a(r)}),[a,t]),l=(null===(i=t.azureMonitor)||void 0===i?void 0:i.customNamespace)||(null===(c=t.azureMonitor)||void 0===c?void 0:c.metricNamespace),p=L(e,s,l);return o().createElement($e,{label:"Metric namespace"},o().createElement(n.Select,{inputId:"azure-monitor-metrics-metric-namespace-field",value:l||null,onChange:u,options:p,allowCustomValue:!0}))};function Po(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const jo=({query:e,timeGrainOptions:t,variableOptionGroup:s,onQueryChange:a})=>{var i,c;const u=(0,r.useCallback)((t=>{if(!t.value)return;const r=go(e,t.value);a(r)}),[a,e]),l=(0,r.useMemo)((()=>{var r;const o=G.findClosestTimeGrain("1m",t.map((e=>G.createKbnUnitFromISO8601Duration(e.value)))||["1m","5m","15m","30m","1h","6h","12h","1d"]),n=t.map((e=>{return"auto"===e.value?(t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Po(e,t,r[t])}))}return e}({},e),r=null!=(r={description:o})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t):e;var t,r}));return L(n,s,null===(r=e.azureMonitor)||void 0===r?void 0:r.timeGrain)}),[t,s,null===(i=e.azureMonitor)||void 0===i?void 0:i.timeGrain]);return o().createElement($e,{label:"Time grain"},o().createElement(n.Select,{inputId:"azure-monitor-metrics-time-grain-field",value:null===(c=e.azureMonitor)||void 0===c?void 0:c.timeGrain,onChange:u,options:l}))},Ao=({onQueryChange:e,query:t})=>{var s,a;const[i,c]=(0,r.useState)(null!==(a=null===(s=t.azureMonitor)||void 0===s?void 0:s.top)&&void 0!==a?a:""),u=(0,r.useCallback)((e=>{e.target instanceof HTMLInputElement&&c(e.target.value)}),[]),l=(0,r.useCallback)((()=>{const r=function(e,t){var r;return(null===(r=e.azureMonitor)||void 0===r?void 0:r.top)===t?e:yo(bo({},e),{azureMonitor:yo(bo({},e.azureMonitor),{top:t})})}(t,i);e(r)}),[e,t,i]);return o().createElement($e,{label:"Top"},o().createElement(n.Input,{id:"azure-monitor-metrics-top-field",value:i,onChange:u,onBlur:l,width:16}))};function No(e,t,o){const[s]=(0,r.useState)((()=>Math.random())),[n,a]=(0,r.useState)(),i=(0,r.useMemo)((()=>null!=n?n:[]),[n]);return(0,r.useEffect)((()=>{e().then((e=>{a(e),t(s,void 0)})).catch((e=>{t(s,e)}))}),o),i}function To(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function Co(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){To(n,o,s,a,i,"next",e)}function i(e){To(n,o,s,a,i,"throw",e)}a(void 0)}))}}function Io(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Do(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Io(e,t,r[t])}))}return e}function Mo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const _o=e=>{return e&&e.length?{resourceGroup:null!==(t=e[0].resourceGroup)&&void 0!==t?t:"",resourceName:null!==(r=e[0].resourceName)&&void 0!==r?r:""}:{resourceGroup:"",resourceName:""};var t,r},Go={aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0};function Ro(e,t){const r=e.map(x);return t&&!r.find((e=>e.value===t.toLowerCase()))&&r.push({label:t,value:t}),r}const qo=({data:t,query:s,datasource:n,variableOptionGroup:a,onChange:i,setError:c})=>{var u,l;const p=((t,o,s)=>{const[n,a]=(0,r.useState)(Go),{subscription:i}=t;var c;const{resources:u,metricNamespace:l,metricName:p,aggregation:m,timeGrain:d,customNamespace:f,region:b}=null!==(c=t.azureMonitor)&&void 0!==c?c:{},{resourceGroup:y,resourceName:v}=_o(u);var g;const h=null!==(g=u&&u.length>1)&&void 0!==g&&g;return(0,r.useEffect)((()=>{i&&y&&v&&l&&p?o.azureMonitorDatasource.getMetricMetadata({subscription:i,resourceGroup:y,resourceName:v,metricNamespace:l,metricName:p,customNamespace:f},h,b).then((e=>{const t=(e.supportedAggTypes||[e.primaryAggType]).map((e=>({label:e,value:e})));var r;a({aggOptions:t,timeGrains:e.supportedTimeGrains,dimensions:e.dimensions,isLoading:!1,supportedAggTypes:null!==(r=e.supportedAggTypes)&&void 0!==r?r:[],primaryAggType:e.primaryAggType})})):a(Go)}),[b,o,i,y,v,l,p,f,h]),(0,r.useEffect)((()=>{const r=m||n.primaryAggType,o=d||"auto";r===m&&o===d||s(Mo(Do({},t),{azureMonitor:Mo(Do({},t.azureMonitor),{aggregation:r,timeGrain:o,allowedTimeGrainsMs:n.timeGrains.filter((e=>"auto"!==e.value)).map((t=>e.rangeUtil.intervalToMs(G.createKbnUnitFromISO8601Duration(t.value))))})}))}),[s,n,m,d,t]),n})(s,n,i),m=((e,t,r,o)=>{const{subscription:s}=e;var n;const{metricNamespace:a,resources:i}=null!==(n=e.azureMonitor)&&void 0!==n?n:{},{resourceGroup:c,resourceName:u}=_o(i);return No(Co((function*(){if(!s||!c||!u)return;const o=Ro(yield t.azureMonitorDatasource.getMetricNamespaces({subscription:s,metricNamespace:a,resourceGroup:c,resourceName:u},!1),a);return!a&&o.length&&r(vo(e,o[0].value)),o})),o,[s,a,c,u])})(s,n,i,c),d=((e,t,r,o)=>{var s;const{subscription:n}=e;var a;const{metricNamespace:i,metricName:c,resources:u,customNamespace:l}=null!==(a=e.azureMonitor)&&void 0!==a?a:{},{resourceGroup:p,resourceName:m}=_o(u);var d;const f=null!==(d=u&&u.length>1)&&void 0!==d&&d;var b;const y=null!==(b=null===(s=e.azureMonitor)||void 0===s?void 0:s.region)&&void 0!==b?b:"";return No(Co((function*(){if(n&&i&&p&&m)return Ro(yield t.azureMonitorDatasource.getMetricNames({subscription:n,resourceGroup:p,resourceName:m,metricNamespace:i,customNamespace:l},f,y),c)})),o,[n,p,m,i,l,f])})(s,n,0,c);var f;const b=null!==(f=null===(l=s.azureMonitor)||void 0===l||null===(u=l.resources)||void 0===u?void 0:u.map((e=>{var t,r;return{subscription:s.subscription,resourceGroup:e.resourceGroup,metricNamespace:null===(t=s.azureMonitor)||void 0===t?void 0:t.metricNamespace,resourceName:e.resourceName,region:null===(r=s.azureMonitor)||void 0===r?void 0:r.region}})))&&void 0!==f?f:[],y=e=>{var t,r;return null!==(r=ao[null!==(t=null==e?void 0:e.toLocaleLowerCase())&&void 0!==t?t:""])&&void 0!==r&&r};var v,g,h;return o().createElement("span",{"data-testid":re.metricsQueryEditor.container.input},o().createElement(Ee,null,o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(gr,{query:s,datasource:n,variableOptionGroup:a,onQueryChange:i,setError:c,selectableEntryTypes:[rt.Resource],resources:null!=b?b:[],queryType:"metrics",disableRow:(e,t)=>{var r,o;if(0===t.length)return!1;const s=rr(e.uri,e.location),n=rr(t[0].uri,t[0].location);return s.subscription!==n.subscription||s.region!==n.region||(null===(r=s.metricNamespace)||void 0===r?void 0:r.toLocaleLowerCase())!==(null===(o=n.metricNamespace)||void 0===o?void 0:o.toLocaleLowerCase())||!y(s.metricNamespace)},renderAdvanced:(e,t)=>o().createElement(mo,{resources:e,onChange:t}),selectionNotice:e=>{if(0===e.length)return"";const t=rr(e[0].uri,e[0].location);return y(t.metricNamespace)?"You can select items of the same resource type and location. To select resources of a different resource type or location, please first uncheck your current selection.":""}}),o().createElement(Eo,{metricNamespaces:m,query:s,datasource:n,variableOptionGroup:a,onQueryChange:i,setError:c}),o().createElement(zo,{metricNames:d,query:s,datasource:n,variableOptionGroup:a,onQueryChange:i,setError:c}),o().createElement(wo,{query:s,datasource:n,variableOptionGroup:a,onQueryChange:i,setError:c,aggregationOptions:null!==(v=null==p?void 0:p.aggOptions)&&void 0!==v?v:[],isLoading:p.isLoading}),o().createElement(jo,{query:s,datasource:n,variableOptionGroup:a,onQueryChange:i,setError:c,timeGrainOptions:null!==(g=null==p?void 0:p.timeGrains)&&void 0!==g?g:[]}))),o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(So,{data:t,query:s,datasource:n,variableOptionGroup:a,onQueryChange:i,setError:c,dimensionOptions:null!==(h=null==p?void 0:p.dimensions)&&void 0!==h?h:[]}))),o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(Ao,{query:s,datasource:n,variableOptionGroup:a,onQueryChange:i,setError:c}),o().createElement(ko,{query:s,datasource:n,variableOptionGroup:a,onQueryChange:i,setError:c})))))},xo=({children:e})=>{const t=(0,n.useStyles2)(Lo);return o().createElement("div",{className:t.root},e)},Lo=e=>({root:(0,s.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:e.spacing(3),minHeight:e.spacing(4)})});var Fo=Object.defineProperty,Vo=Object.defineProperties,Qo=Object.getOwnPropertyDescriptors,$o=Object.getOwnPropertySymbols,Wo=Object.prototype.hasOwnProperty,Uo=Object.prototype.propertyIsEnumerable,Xo=(e,t,r)=>t in e?Fo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Bo=(e,t)=>{for(var r in t||(t={}))Wo.call(t,r)&&Xo(e,r,t[r]);if($o)for(var r of $o(t))Uo.call(t,r)&&Xo(e,r,t[r]);return e},Ho=(e,t)=>Vo(e,Qo(t));function Ko(e){var t=e,{label:s}=t,a=((e,t)=>{var r={};for(var o in e)Wo.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&$o)for(var o of $o(e))t.indexOf(o)<0&&Uo.call(e,o)&&(r[o]=e[o]);return r})(t,["label"]);const i=(0,n.useStyles2)(Yo),[c]=(0,r.useState)((()=>Math.random().toString(16).slice(2))),u={SelectContainer:Jo,ValueContainer:Zo,SingleValue:Zo};return o().createElement("div",{className:i.root},s&&o().createElement("label",{className:i.label,htmlFor:c},s,":"," "),o().createElement(n.Select,Ho(Bo({openMenuOnFocus:!0,inputId:c},a),{components:u})))}const Jo=e=>{const{children:t}=e,r=(0,n.useStyles2)(Yo);return o().createElement(n.SelectContainer,Ho(Bo({},e),{className:(0,s.cx)(e.className,r.container)}),t)},Zo=e=>{const{className:t,children:r}=e,a=(0,n.useStyles2)(Yo);return o().createElement("div",{className:(0,s.cx)(t,a.valueContainer)},r)},Yo=e=>({root:(0,s.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,s.css)({color:e.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,s.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,s.css)({display:"flex",alignItems:"center",flex:"initial",color:e.colors.text.secondary,fontSize:12})}),es=({query:e,onQueryChange:t})=>{const s=[{value:Q.AzureMonitor,label:"Metrics"},{value:Q.LogAnalytics,label:"Logs"},{value:Q.AzureTraces,label:"Traces"},{value:Q.AzureResourceGraph,label:"Azure Resource Graph"}],n=(0,r.useCallback)((r=>{r.value&&r.value!==e.queryType&&t({refId:e.refId,datasource:e.datasource,queryType:r.value})}),[t,e]);return o().createElement("span",{"data-testid":re.header.select},o().createElement(xo,null,o().createElement(Ko,{label:"Service",value:e.queryType,placeholder:"Service...",allowCustomValue:!0,options:s,onChange:n})))};var ts=l(269);function rs(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function os(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){rs(n,o,s,a,i,"next",e)}function i(e){rs(n,o,s,a,i,"throw",e)}a(void 0)}))}}function ss(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ns(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){ss(e,t,r[t])}))}return e}function as(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const is=(e,t,r,o)=>{"filters"===e?t[e]=r.map((e=>e.value)):(t[e]=r.value,"property"===e&&(t.filters=[])),o(t)},cs=(us=os((function*(t,r,o,s,n,a,i){const{azureTraces:c}=t;if(!c)return[];const{resources:u}=c;if(!u||!a)return[];const l=a.property;if(!l)return[];const p=`let ${l} = toscalar(union isfuzzy=true ${o.join(",")}\n  | where $__timeFilter(timestamp)\n  | summarize count=count() by ${l}\n  | summarize make_list(pack_all()));\n  print properties = bag_pack("${l}", ${l});`,m=yield(0,ts.lastValueFrom)(r.azureLogAnalyticsDatasource.query({requestId:"azure-traces-properties-req",interval:"",intervalMs:0,scopedVars:{},timezone:"",startTime:0,app:e.CoreApp.Unknown,targets:[as(ns({},t),{azureLogAnalytics:{resources:u,query:p},queryType:Q.LogAnalytics})],range:i||(0,e.getDefaultTimeRange)()}));if(m.data.length>0){const e=m.data[0];if(e.fields.length>0){const t=JSON.parse(e.fields[0].values.toArray()[0])[l].map((e=>{let t=e[l];return""===e[l]&&(t="<Empty>"),{label:t.toString(),value:e[l].toString(),count:e.count}}));return s.set(l,t),n(s),t}}return[]})),function(e,t,r,o,s,n,a){return us.apply(this,arguments)});var us;const ls=e=>{const{data:t,innerProps:r,innerRef:a,isFocused:i,isSelected:c}=e,u=(0,n.useTheme2)(),l=(0,n.getSelectStyles)(u),p=r=>{e.selectOption(ns({},t)),r.stopPropagation(),r.preventDefault()};return o().createElement("div",as(ns({ref:a,className:(0,s.cx)(l.option,i&&l.optionFocused,c&&l.optionSelected,t.isDisabled&&l.optionDisabled)},r),{"aria-label":"Select option",title:t.title,onClick:p,onKeyDown:p,role:"checkbox","aria-checked":c,tabIndex:0}),o().createElement("div",{className:l.optionBody},o().createElement(n.Checkbox,{value:c,label:t.label?`${t.label} - (${t.count})`:""})))},ps=e=>{const{query:t,datasource:s,propertyMap:a,setPropertyMap:i,queryTraceTypes:c,properties:u,item:l,onChange:p,onDelete:m,variableOptionGroup:d,range:f}=e,[b,y]=(0,r.useState)(!1);var v,g;const[h,w]=(0,r.useState)(L(null!==(g=a.get(null!==(v=l.property)&&void 0!==v?v:""))&&void 0!==g?g:[],d)),[O,S]=(0,r.useState)(l.filters?l.filters.map((e=>({value:e,label:""===e?"<Empty>":e}))):[]),k=function(){var e=os((function*(){if(y(!0),l.property&&""!==l.property){var e;const r=a.get(null!==(e=l.property)&&void 0!==e?e:"");if(r)return w(L(r,d)),y(!1),Promise.resolve(r);{const e=yield cs(t,s,c,a,i,l,f);return w(L(e,d)),y(!1),e}}return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}();return o().createElement(n.HorizontalGroup,{spacing:"none"},o().createElement(n.Select,{menuShouldPortal:!0,placeholder:"Property",value:l.property?{value:l.property,label:l.property}:null,options:L(u.map((e=>({label:e,value:e}))),d),onChange:e=>is("property",l,e,p),width:25}),o().createElement(n.ButtonSelect,{value:l.operation?{label:"eq"===l.operation?"=":"!=",value:l.operation}:void 0,options:[{label:"=",value:"eq"},{label:"!=",value:"ne"}],onChange:e=>is("operation",l,e,p),defaultValue:"eq"}),o().createElement(n.AsyncMultiSelect,{blurInputOnSelect:!1,menuShouldPortal:!0,placeholder:"Value",value:O,loadOptions:k,isLoading:b,onOpenMenu:k,onChange:e=>{S(e),0===e.length&&is("filters",l,O,p)},width:35,defaultOptions:h,isClearable:!0,components:{Option:ls},closeMenuOnSelect:!1,onCloseMenu:()=>is("filters",l,O,p),hideSelectedOptions:!1}),o().createElement(Pr,{"aria-label":"Remove filter",icon:"times",variant:"secondary",onClick:m,type:"button"}))};function ms(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ds(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){ms(e,t,r[t])}))}return e}function fs(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const bs={availabilityResults:{label:"Availablity Results",description:"Availability test results."},dependencies:{label:"Dependencies",description:"Calls your application makes to other services such as databases or REST APIs."},customEvents:{label:"Custom Events",description:"Calls to TrackEvent that are inserted to monitor usage."},exceptions:{label:"Exceptions",description:"Exceptions that are logged via TrackException, or uncaught exceptions."},pageViews:{label:"Page Views",description:"Web client telemetry to create page view reports."},requests:{label:"Requests",description:"HTTP requests received by the application."},traces:{label:"Traces",description:"Diagnostic logs emitted using TrackTrace and similar methods. Note: Traces are not visualised if the result format is set to Trace"}},ys=["operationId","duration","id","name","problemId","operation_ParentId","timestamp","customDimensions","operation_Name"],vs={appId:"ResourceGUID",application_Version:"AppVersion",appName:"_ResourceId",client_Browser:"ClientBrowser",client_City:"ClientCity",client_CountryOrRegion:"ClientCountryOrRegion",client_IP:"ClientIP",client_Model:"ClientModel",client_OS:"ClientOS",client_StateOrProvince:"ClientStateOrProvince",client_Type:"ClientType",cloud_RoleInstance:"AppRoleInstance",cloud_RoleName:"AppRoleName",customDimensions:"Properties",customMeasurements:"Measurements",duration:"DurationMs",id:"Id",iKey:"IKey",itemCount:"ItemCount",itemId:"_ItemId",itemType:"Type",name:"Name",operation_Id:"OperationId",operation_Name:"OperationName",operation_ParentId:"OperationParentId",operation_SyntheticSource:"OperationSyntheticSource",performanceBucket:"PerformanceBucket",sdkVersion:"SDKVersion",session_Id:"SessionId",success:"Success",timestamp:"TimeGenerated",user_AccountId:"UserAccountId",user_AuthenticatedId:"UserAuthenticatedId",user_Id:"UserId"},gs=fs(ds({},vs),{location:"Location",message:"Message",size:"Size"}),hs=fs(ds({},vs),{data:"Data",resultCode:"ResultCode",target:"Target",type:"DependencyType"}),ws=(0,M.omit)(vs,["duration","id","success","performanceBucket"]),Os=(0,M.omit)(fs(ds({},vs),{url:"Url"}),["success"]),Ss={availabilityResults:gs,dependencies:hs,customEvents:ws,exceptions:(0,M.omit)(fs(ds({},vs),{assembly:"Assembly",details:"Details",handledAt:"HandledAt",innermostAssembly:"InnermostAssembly",innermostMessage:"InnermostMessage",innermostMethod:"InnermostMethod",innermostType:"InnermostType",message:"Message",method:"Method",outerAssembly:"OuterAssembly",outerMessage:"OuterMessage",outerMethod:"OuterMethod",outerType:"OuterType",problemId:"ProblemId",severityLevel:"SeverityLevel",type:"ExceptionType"}),["duration","id","name","performanceBucket","success"]),pageViews:Os,requests:{resultCode:"ResultCode",source:"Source",url:"Url"},traces:(0,M.omit)({message:"Message",severityLevel:"SeverityLevel"},["duration","id","name","performanceBucket","success"])};function ks(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zs(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){ks(e,t,r[t])}))}return e}function Es(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Ps(e,t){return Es(zs({},e),{azureTraces:Es(zs({},e.azureTraces),{resultFormat:t})})}function js(e,t){return Es(zs({},e),{azureTraces:Es(zs({},e.azureTraces),{traceTypes:t})})}Object.entries(Ss).reduce(((e,[t,r])=>fs(ds({},e),{[t]:Object.keys((0,M.omit)(r,ys)).join(",")})),{});const As=({query:e,datasource:t,onQueryChange:s,variableOptionGroup:a,range:i})=>{var c,u,l,p;const{azureTraces:m}=e,d=(null==m?void 0:m.traceTypes)?m.traceTypes:Object.keys(Ss),f=new Set(["customDimensions","customMeasurements","details","duration","id","itemId","operation_Id","operation_ParentId","timestamp"]),b=(0,M.uniq)(d.map((e=>Object.keys(Ss[e]))).flat()).filter((e=>!f.has(e))),[y,v]=(0,r.useState)(new Map),g=(0,r.useMemo)((()=>{var t,r;return null!==(r=null===(t=e.azureTraces)||void 0===t?void 0:t.filters)&&void 0!==r?r:[]}),[null===(c=e.azureTraces)||void 0===c?void 0:c.filters]),[h,w]=(0,r.useState)(g);return(0,r.useEffect)((()=>{v(new Map)}),[null===(u=e.azureTraces)||void 0===u?void 0:u.resources,null===(l=e.azureTraces)||void 0===l?void 0:l.traceTypes,null===(p=e.azureTraces)||void 0===p?void 0:p.operationId]),o().createElement(n.Field,{label:"Filters"},o().createElement(Oo,{items:h,onChange:t=>{let r=!1;const o=t.map((e=>{var t,o,s;return r=!!(""!==e.property&&e.filters&&e.filters.length>0&&""!==e.operation),{property:null!==(t=e.property)&&void 0!==t?t:"",filters:null!==(o=e.filters)&&void 0!==o?o:[],operation:null!==(s=e.operation)&&void 0!==s?s:"eq"}}));w(o),(r||g.length>0&&0===o.length)&&s(function(e,t){return Es(zs({},e),{azureTraces:Es(zs({},e.azureTraces),{filters:t})})}(e,o))},renderItem:(O={query:e,datasource:t,propertyMap:y,setPropertyMap:v,queryTraceTypes:d,properties:b,variableOptionGroup:a,range:i},function(e,t,r){return o().createElement(ps,as(ns({},O),{item:e,onChange:t,onDelete:r}))})}));var O},Ns=({query:e,variableOptionGroup:t,onQueryChange:s})=>{var a;const i=Object.entries(bs).map((([e,t])=>({label:t.label,description:t.description,value:e}))),c=(0,r.useCallback)((t=>{const r=js(e,t.map((e=>{var t;return null!==(t=e.value)&&void 0!==t?t:""})));s(r)}),[s,e]),u=(0,r.useMemo)((()=>[...i,t]),[i,t]);var l;return o().createElement($e,{label:"Event Type"},o().createElement(n.MultiSelect,{placeholder:"Choose event types",inputId:"azure-monitor-traces-type-field",value:q([...i,...t.options],null!==(l=null===(a=e.azureTraces)||void 0===a?void 0:a.traceTypes)&&void 0!==l?l:(()=>{const t=i.map((e=>e.value)),r=js(e,t);return s(r),t})()),onChange:c,options:u,allowCustomValue:!0,isClearable:!0,"aria-label":re.tracesQueryEditor.traceTypes.select}))},Ts=({query:e,datasource:t,subscriptionId:s,variableOptionGroup:a,onChange:i,setError:c,range:u})=>{var l,p,m,d,f;const[b,y]=(0,r.useState)(null!==(f=null===(l=e.azureTraces)||void 0===l?void 0:l.operationId)&&void 0!==f?f:""),v=(g=null===(p=e.azureTraces)||void 0===p?void 0:p.operationId,h=(0,r.useRef)(),(0,r.useEffect)((function(){h.current=g})),h.current);var g,h;(0,r.useEffect)((()=>{var t;(null===(t=e.azureTraces)||void 0===t?void 0:t.operationId)&&v!==e.azureTraces.operationId&&y(e.azureTraces.operationId)}),[y,v,e,b]);const w=(0,r.useCallback)((e=>{e.target instanceof HTMLInputElement&&y(e.target.value)}),[]),O=(0,r.useCallback)((t=>{const r=function(e,t){return Es(zs({},e),{azureTraces:Es(zs({},e.azureTraces),{operationId:t})})}(e,b);i(r)}),[i,b,e]);var S;return o().createElement("span",{"data-testid":re.tracesQueryEditor.container.input},o().createElement(Ee,null,o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(gr,{query:e,datasource:t,subscriptionId:s,variableOptionGroup:a,onQueryChange:i,setError:c,selectableEntryTypes:[rt.Subscription,rt.ResourceGroup,rt.Resource,rt.Variable],resources:null!==(S=null===(m=e.azureTraces)||void 0===m?void 0:m.resources)&&void 0!==S?S:[],queryType:"traces",disableRow:(e,t)=>{var r,o;return 0!==t.length&&(null===(r=rr(e.uri,e.location).metricNamespace)||void 0===r?void 0:r.toLowerCase())!==(null===(o=rr(t[0].uri,t[0].location).metricNamespace)||void 0===o?void 0:o.toLowerCase())},renderAdvanced:(e,t)=>o().createElement(Nr,{resources:e,onChange:t}),selectionNotice:()=>"You may only choose items of the same resource type.",range:u}))),o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(Ns,{datasource:t,onQueryChange:i,query:e,setError:c,variableOptionGroup:a,range:u}),o().createElement($e,{label:"Operation ID"},o().createElement(n.Input,{id:"azure-monitor-traces-operation-id-field",value:b,onChange:w,onBlur:O,width:40})))),o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(As,{datasource:t,onQueryChange:i,query:e,setError:c,variableOptionGroup:a,range:u}))),o().createElement(Pe,null,o().createElement(Ae,null,o().createElement(et,{datasource:t,setError:c,query:e,variableOptionGroup:a,onQueryChange:i,inputId:"azure-monitor-traces",options:[{label:"Table",value:$.Table},{label:"Trace",value:$.Trace}],defaultValue:$.Table,setFormatAs:Ps,resultFormat:null===(d=e.azureTraces)||void 0===d?void 0:d.resultFormat,range:u})))))};var Cs=l(513),Is=l.n(Cs);function Ds(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ms(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Ds(e,t,r[t])}))}return e}function _s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Gs(e){var t,r,o;let s=e;var n;return s.queryType||(s=_s(Ms({},s),{queryType:Q.AzureMonitor})),s=function(e){var t,r,o,s;let n=e;return(null===(r=n.azureLogAnalytics)||void 0===r||null===(t=r.query)||void 0===t?void 0:t.match(/\$__from\s/gi))&&(n=Dr(n,n.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() "))),(null===(s=n.azureLogAnalytics)||void 0===s||null===(o=s.query)||void 0===o?void 0:o.match(/\$__to\s/gi))&&(n=Dr(n,n.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() "))),n}(s),s.queryType===Q.AzureMonitor&&s.azureMonitor&&(s=function(e){var t;let r=e;var o,s;(null===(t=r.azureMonitor)||void 0===t?void 0:t.timeGrainUnit)&&"auto"!==r.azureMonitor.timeGrain&&(r=go(r,G.createISO8601Duration(null!==(s=r.azureMonitor.timeGrain)&&void 0!==s?s:"auto",r.azureMonitor.timeGrainUnit)),null===(o=r.azureMonitor)||void 0===o||delete o.timeGrainUnit);return r}(s),s=function(e){var t,r;return!((null===(t=e.azureMonitor)||void 0===t?void 0:t.metricNamespace)&&"select"!==e.azureMonitor.metricNamespace)&&(null===(r=e.azureMonitor)||void 0===r?void 0:r.metricDefinition)?_s(Ms({},e),{azureMonitor:_s(Ms({},e.azureMonitor),{metricNamespace:e.azureMonitor.metricDefinition,metricDefinition:void 0})}):e}(s),s=function(e){var t,r,o;let s=e;const n=null===(t=s.azureMonitor)||void 0===t?void 0:t.dimension;var a;return n&&"None"!==n&&(s=function(e,t="",r="eq",o=[]){var s,n;return ho(e,[...null!==(n=null===(s=e.azureMonitor)||void 0===s?void 0:s.dimensionFilters)&&void 0!==n?n:[],{dimension:t,operator:r,filters:o}])}(s,n,"eq",[(null===(a=s.azureMonitor)||void 0===a?void 0:a.dimensionFilter)||""])),null===(r=s.azureMonitor)||void 0===r||delete r.dimension,null===(o=s.azureMonitor)||void 0===o||delete o.dimensionFilter,s}(s),s=function(e){const t=e.azureMonitor;if(!t)return e;const r=[],o=t.dimensionFilters;return o&&o.length>0&&(o.forEach((e=>{const t={dimension:e.dimension,operator:e.operator};if(!e.filters&&e.filter)r.push(_s(Ms({},t),{filters:[e.filter]}));else{let o=!1;if(e.filters&&e.filter){for(const t of e.filters)if(e.filter===t){o=!0;break}o||"*"===e.filter||e.filters.push(e.filter),r.push(_s(Ms({},t),{filters:e.filters}))}}})),r.length>0)?_s(Ms({},e),{azureMonitor:_s(Ms({},t),{dimensionFilters:r})}):e}(s),s=function(e){var t;if((null===(t=e.azureMonitor)||void 0===t?void 0:t.resourceUri)&&!e.azureMonitor.resourceUri.startsWith("$")){const t=rr(e.azureMonitor.resourceUri),r=(null==t?void 0:t.subscription)&&(null==t?void 0:t.resourceGroup)&&(null==t?void 0:t.resourceName);return _s(Ms({},e),{subscription:null==t?void 0:t.subscription,azureMonitor:_s(Ms({},e.azureMonitor),{resources:[{resourceGroup:null==t?void 0:t.resourceGroup,resourceName:null==t?void 0:t.resourceName}],metricNamespace:null==t?void 0:t.metricNamespace,resourceUri:r?void 0:e.azureMonitor.resourceUri})})}return e}(s)),((null===(t=s.azureMonitor)||void 0===t?void 0:t.resourceGroup)||(null===(r=s.azureMonitor)||void 0===r?void 0:r.resourceName))&&(s=function(e){var t,r;let o=e;var s,n;(null===(t=o.azureMonitor)||void 0===t?void 0:t.resourceGroup)&&(null===(r=o.azureMonitor)||void 0===r?void 0:r.resourceName)&&(o=_s(Ms({},o),{azureMonitor:_s(Ms({},o.azureMonitor),{resources:[{resourceGroup:o.azureMonitor.resourceGroup,resourceName:o.azureMonitor.resourceName}]})}),null===(s=o.azureMonitor)||void 0===s||delete s.resourceGroup,null===(n=o.azureMonitor)||void 0===n||delete n.resourceName);return o}(s)),(null===(o=s.azureLogAnalytics)||void 0===o?void 0:o.resource)&&(s=_s(Ms({},s),{azureLogAnalytics:_s(Ms({},s.azureLogAnalytics),{resources:[s.azureLogAnalytics.resource]})}),null===(n=s.azureLogAnalytics)||void 0===n||delete n.resource),s.azureLogAnalytics&&void 0===s.azureLogAnalytics.dashboardTime&&(s=s.azureLogAnalytics.intersectTime?_s(Ms({},s),{azureLogAnalytics:_s(Ms({},s.azureLogAnalytics),{dashboardTime:!0})}):_s(Ms({},s),{azureLogAnalytics:_s(Ms({},s.azureLogAnalytics),{dashboardTime:!1})})),s}const Rs={queryType:Q.AzureMonitor};function qs(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const xs=({data:e,subscriptionId:t,query:r,datasource:s,variableOptionGroup:a,onChange:i,setError:c,range:u})=>{switch(r.queryType){case Q.AzureMonitor:return o().createElement(qo,{data:e,query:r,datasource:s,onChange:i,variableOptionGroup:a,setError:c});case Q.LogAnalytics:return o().createElement($r,{data:e,subscriptionId:t,query:r,datasource:s,onChange:i,variableOptionGroup:a,setError:c,timeRange:u});case Q.AzureResourceGraph:return o().createElement(Ze,{subscriptionId:t,query:r,datasource:s,onChange:i,variableOptionGroup:a,setError:c});case Q.AzureTraces:return o().createElement(Ts,{subscriptionId:t,query:r,datasource:s,onChange:i,variableOptionGroup:a,setError:c,range:u});default:const l=r.queryType;return o().createElement(n.Alert,{title:"Unknown query type"},("Application Insights"===l||"Insights Analytics"===l)&&o().createElement(o().Fragment,null,l," was deprecated in Grafana 9. See the"," ",o().createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/",target:"_blank",rel:"noreferrer"},"deprecation notice")," ","to get more information about how to migrate your queries. This is the current query definition:",o().createElement(n.CodeEditor,{height:"200px",readOnly:!0,language:"json",value:JSON.stringify(r,null,4)})))}};function Ls(e){return"function"==typeof e}var Fs=function(e,t){return Fs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Fs(e,t)};function Vs(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Fs(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function Qs(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $s(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,s,n=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=n.next()).done;)a.push(o.value)}catch(e){s={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a}function Ws(e,t,r){if(r||2===arguments.length)for(var o,s=0,n=t.length;s<n;s++)!o&&s in t||(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var Us,Xs=((Us=function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}((function(e){Error.call(e),e.stack=(new Error).stack}))).prototype=Object.create(Error.prototype),Us.prototype.constructor=Us,Us);function Bs(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Hs=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,o,s;if(!this.closed){this.closed=!0;var n=this._parentage;if(n)if(this._parentage=null,Array.isArray(n))try{for(var a=Qs(n),i=a.next();!i.done;i=a.next())i.value.remove(this)}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else n.remove(this);var c=this.initialTeardown;if(Ls(c))try{c()}catch(e){s=e instanceof Xs?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=Qs(u),p=l.next();!p.done;p=l.next()){var m=p.value;try{Ks(m)}catch(e){s=null!=s?s:[],e instanceof Xs?s=Ws(Ws([],$s(s)),$s(e.errors)):s.push(e)}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}if(s)throw new Xs(s)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Ks(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Bs(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&Bs(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function Ks(e){Ls(e)?e():e.unsubscribe()}Hs.EMPTY;var Js=null,Zs=null,Ys=!1,en=!1,tn={setTimeout:function(e,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var s=tn.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,Ws([e,t],$s(r))):setTimeout.apply(void 0,Ws([e,t],$s(r)))},clearTimeout:function(e){var t=tn.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function rn(){}var on=sn("C",void 0,void 0);function sn(e,t,r){return{kind:e,value:t,error:r}}var nn=function(e){function t(t){var r,o=e.call(this)||this;return o.isStopped=!1,t?(o.destination=t,((r=t)instanceof Hs||r&&"closed"in r&&Ls(r.remove)&&Ls(r.add)&&Ls(r.unsubscribe))&&t.add(o)):o.destination=dn,o}return Vs(t,e),t.create=function(e,t,r){return new ln(e,t,r)},t.prototype.next=function(e){this.isStopped?mn(function(e){return sn("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?mn(sn("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?mn(on,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Hs),an=Function.prototype.bind;function cn(e,t){return an.call(e,t)}var un=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){pn(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){pn(e)}else pn(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){pn(e)}},e}(),ln=function(e){function t(t,r,o){var s,n,a=e.call(this)||this;return Ls(t)||!t?s={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=o?o:void 0}:a&&en?((n=Object.create(t)).unsubscribe=function(){return a.unsubscribe()},s={next:t.next&&cn(t.next,n),error:t.error&&cn(t.error,n),complete:t.complete&&cn(t.complete,n)}):s=t,a.destination=new un(s),a}return Vs(t,e),t}(nn);function pn(e){Ys||function(e){tn.setTimeout((function(){if(!Js)throw e;Js(e)}))}(e)}function mn(e,t){var r=Zs;r&&tn.setTimeout((function(){return r(e,t)}))}var dn={closed:!0,next:rn,error:function(e){throw e},complete:rn},fn=function(e){function t(t,r,o,s,n,a){var i=e.call(this,t)||this;return i.onFinalize=n,i.shouldUnsubscribe=a,i._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,i._error=s?function(e){try{s(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,i._complete=o?function(){try{o()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,i}return Vs(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(nn);function bn(e,t){return r=function(r,o){var s=0;r.subscribe(new fn(o,(function(r){o.next(e.call(t,r,s++))}),void 0,void 0,void 0))},function(e){if(function(e){return Ls(null==e?void 0:e.lift)}(e))return e.lift((function(e){try{return r(e,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")};var r}const yn=/([\w\W]+):([\w]+)(?:\s?=\s?([\w\W]+))?/;function vn(e){return e.functions?e.functions.map((e=>{const t=e.parameters&&e.parameters.split(", ").map((e=>{const t=e.match(yn);if(!t)return;const[,r,o,s]=t;return{name:r,type:o,defaultValue:s,cslDefaultValue:s}})).filter((e=>!!e));return{name:e.name,body:e.body,inputParameters:t||[]}})):[]}function gn(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function hn(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){gn(n,o,s,a,i,"next",e)}function i(e){gn(n,o,s,a,i,"throw",e)}a(void 0)}))}}function wn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function On(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){wn(e,t,r[t])}))}return e}function Sn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class kn extends t.DataSourceWithBackend{isConfigured(){return!this.validateDatasource()}filterQuery(e){var t,r,o,s;return!(!0===e.hide||(!(null===(t=e.azureLogAnalytics)||void 0===t?void 0:t.query)||!(null===(r=e.azureLogAnalytics.resources)||void 0===r?void 0:r.length)&&!e.azureLogAnalytics.workspace)&&!(null===(s=e.azureTraces)||void 0===s||null===(o=s.resources)||void 0===o?void 0:o.length))}getSubscriptions(){var e=this;return hn((function*(){if(!e.isConfigured())return[];const t=`${e.azureMonitorPath}?api-version=2019-03-01`;return yield e.getResource(t).then((e=>R.parseSubscriptions(e)))}))()}getWorkspaces(e){var t=this;return hn((function*(){const r=yield t.getWorkspaceList(e);return(0,M.map)(r.value,(e=>({text:e.name,value:e.id})))||[]}))()}getWorkspaceList(e){const t=this.templateSrv.replace(e||this.defaultSubscriptionId),r=this.azureMonitorPath+`/${t}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;return this.getResource(r)}getMetadata(e){var t=this;return hn((function*(){const r=`${t.resourcePath}/v1${e}/metadata`;return yield t.getResource(r)}))()}getKustoSchema(e){var t=this;return hn((function*(){const r=t.templateSrv.replace(e,{},V);return function(e,t,r){const o={name:t,tables:e.tables,functions:vn(e),majorVersion:0,minorVersion:0};return o.functions.push({name:"$__timeFilter",body:"{ true }",inputParameters:[{name:"timeColumn",type:"System.String",defaultValue:'""',cslDefaultValue:'""'}]},{name:"$__timeFrom",body:"{ datetime(2018-06-05T18:09:58.907Z) }",inputParameters:[]},{name:"$__timeTo",body:"{ datetime(2018-06-05T20:09:58.907Z) }",inputParameters:[]},{name:"$__escapeMulti",body:"{ @'\\grafana-vmNetwork(eth0)Total', @'\\hello!'}",inputParameters:[{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]},{name:"$__contains",body:"{ colName in ('value1','value2') }",inputParameters:[{name:"colName",type:"System.String",defaultValue:"colName",cslDefaultValue:"colName"},{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]}),{clusterType:"Engine",cluster:{connectionString:t,databases:[o]},database:o,globalScalarParameters:r.map((e=>({name:`$${e.name}`,type:"dynamic"})))}}(yield t.getMetadata(r),r,t.templateSrv.getVariables())}))()}applyTemplateVariables(e,t){let r;if(e.queryType===Q.LogAnalytics&&e.azureLogAnalytics){r=e.azureLogAnalytics;const o=this.expandResourcesForMultipleVariables(r.resources,t);let s=this.templateSrv.replace(r.workspace,t);s||o||!this.firstWorkspace||(s=this.firstWorkspace);const n=this.templateSrv.replace(r.query,t,V);return Sn(On({},e),{queryType:e.queryType||Q.LogAnalytics,azureLogAnalytics:{resultFormat:r.resultFormat,query:n,resources:o,workspace:s,dashboardTime:r.dashboardTime,timeColumn:this.templateSrv.replace(r.timeColumn,t)}})}if(e.queryType===Q.AzureTraces&&e.azureTraces){var o,s;r=e.azureTraces;const a=this.expandResourcesForMultipleVariables(r.resources,t),i=this.templateSrv.replace(r.query,t,V),c=null===(o=r.traceTypes)||void 0===o?void 0:o.map((e=>this.templateSrv.replace(e,t)));var n;const u=(null!==(n=r.filters)&&void 0!==n?n:[]).filter((e=>!!e.property)).map((e=>{var r;const o=null===(r=e.filters)||void 0===r?void 0:r.map((e=>this.templateSrv.replace(null!=e?e:"",t)));return{property:this.templateSrv.replace(e.property,t),operation:e.operation||"eq",filters:o||[]}}));return Sn(On({},e),{queryType:e.queryType||Q.AzureTraces,azureTraces:{resultFormat:r.resultFormat,query:i,resources:a,operationId:this.templateSrv.replace(null===(s=e.azureTraces)||void 0===s?void 0:s.operationId,t),filters:u,traceTypes:c}})}return e}expandResourcesForMultipleVariables(e,t){if(!e)return;const r=[];return e.forEach((e=>{this.templateSrv.replace(e,t,"raw").split(",").forEach((e=>{r.push(e)}))})),r}getDeprecatedDefaultWorkSpace(){return this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace}getDefaultOrFirstSubscription(){var e=this;return hn((function*(){var t;return e.defaultSubscriptionId?e.defaultSubscriptionId:null===(t=(yield e.getSubscriptions())[0])||void 0===t?void 0:t.value}))()}getFirstWorkspace(){var e=this;return hn((function*(){var t;if(e.firstWorkspace)return e.firstWorkspace;const r=yield e.getDefaultOrFirstSubscription();if(!r)return;const o=null===(t=(yield e.getWorkspaces(r))[0])||void 0===t?void 0:t.value;return o&&(e.firstWorkspace=o),o}))()}validateDatasource(){if("clientsecret"===K(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}getAzureLogAnalyticsCheatsheetQueries(){var e=this;return hn((function*(){return yield e.getResource(`${e.resourcePath}/v1/metadata`)}))()}constructor(e,r=(0,t.getTemplateSrv)()){super(e),wn(this,"instanceSettings",void 0),wn(this,"templateSrv",void 0),wn(this,"resourcePath",void 0),wn(this,"azurePortalUrl",void 0),wn(this,"defaultSubscriptionId",void 0),wn(this,"azureMonitorPath",void 0),wn(this,"firstWorkspace",void 0),this.instanceSettings=e,this.templateSrv=r,this.resourcePath="loganalytics",this.azureMonitorPath=`${F}/subscriptions`;const o=Y(e);this.azurePortalUrl=Z(o),this.defaultSubscriptionId=this.instanceSettings.jsonData.subscriptionId||""}}function zn(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function En(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){zn(n,o,s,a,i,"next",e)}function i(e){zn(n,o,s,a,i,"throw",e)}a(void 0)}))}}function Pn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Pn(e,t,r[t])}))}return e}function An(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Nn(e){return!(!e||"select"===e)}class Tn extends t.DataSourceWithBackend{isConfigured(){return!this.validateDatasource()}filterQuery(e){var t,r,o,s,n,a;const i=(null==e||null===(t=e.azureMonitor)||void 0===t?void 0:t.resources)&&e.azureMonitor.resources.length>0&&e.azureMonitor.resources.every((e=>Nn(e.resourceGroup)&&Nn(e.resourceName)))&&Nn((null==e||null===(r=e.azureMonitor)||void 0===r?void 0:r.metricDefinition)||(null==e||null===(o=e.azureMonitor)||void 0===o?void 0:o.metricNamespace)),c=Nn(null===(s=e.azureMonitor)||void 0===s?void 0:s.resourceUri);return!(!0===e.hide||!i&&!c||!Nn(null==e||null===(n=e.azureMonitor)||void 0===n?void 0:n.metricName)||!Nn(null==e||null===(a=e.azureMonitor)||void 0===a?void 0:a.aggregation))}applyTemplateVariables(e,t){var r;const o=e.azureMonitor;if(!o)throw new Error("Query is not a valid Azure Monitor Metrics query");o.resourceUri&&(o.resourceUri=this.templateSrv.replace(o.resourceUri,t)),o.metricDefinition&&(o.metricDefinition=this.templateSrv.replace(o.metricDefinition,t)),o.timeGrain&&o.timeGrainUnit&&"auto"!==o.timeGrain&&(o.timeGrain=G.createISO8601Duration(o.timeGrain,o.timeGrainUnit));const s=Gs(e),n=s.azureMonitor;if(!n)throw new Error("Query is not a valid Azure Monitor Metrics query");const a=this.templateSrv.replace(s.subscription||this.defaultSubscriptionId,t),i=null===(r=n.resources)||void 0===r?void 0:r.map((e=>this.replaceTemplateVariables(e,t))).flat(),c=this.templateSrv.replace(n.metricNamespace,t),u=this.templateSrv.replace(n.customNamespace,t),l=this.templateSrv.replace((n.timeGrain||"").toString(),t),p=this.templateSrv.replace(n.aggregation,t),m=this.templateSrv.replace(n.top||"",t);var d;const f=(null!==(d=n.dimensionFilters)&&void 0!==d?d:[]).filter((e=>e.dimension&&"None"!==e.dimension)).map((e=>{var r;const o=null===(r=e.filters)||void 0===r?void 0:r.map((e=>this.templateSrv.replace(null!=e?e:"",t)));return{dimension:this.templateSrv.replace(e.dimension,t),operator:e.operator||"eq",filters:o||[]}})),b=An(jn({},n),{resources:i,metricNamespace:c,customNamespace:u,timeGrain:l,allowedTimeGrainsMs:n.allowedTimeGrainsMs,metricName:this.templateSrv.replace(n.metricName,t),region:this.templateSrv.replace(n.region,t),aggregation:p,dimensionFilters:f,top:m||"10",alias:n.alias});return An(jn({},e),{subscription:a,queryType:Q.AzureMonitor,azureMonitor:b})}getSubscriptions(){var e=this;return En((function*(){return e.isConfigured()?e.getResource(`${e.resourcePath}/subscriptions?api-version=2019-03-01`).then((e=>R.parseSubscriptions(e))):[]}))()}getResourceGroups(e){return this.getResource(`${this.resourcePath}/subscriptions/${e}/resourceGroups?api-version=${this.listByResourceGroupApiVersion}`).then((e=>R.parseResponseValues(e,"name","name")))}getResourceNames(e,t){var r=this;return En((function*(){const o=r.replaceTemplateVariables(e).map((({metricNamespace:e,subscriptionId:o,resourceGroup:s,region:n})=>{const a=(0,M.startsWith)(null==e?void 0:e.toLowerCase(),"microsoft.storage/storageaccounts/")?"microsoft.storage/storageaccounts":e;let i=`${r.resourcePath}/subscriptions/${o}`;s&&(i+=`/resourceGroups/${s}`),i+=`/resources?api-version=${r.listByResourceGroupApiVersion}`;const c=[];return a&&c.push(`resourceType eq '${a}'`),n&&c.push(`location eq '${n}'`),c.length>0&&(i+=`&$filter=${c.join(" and ")}`),t&&(i+=`&$skiptoken=${t}`),r.getResource(i).then(function(){var t=En((function*(t){let n=[];if((0,M.startsWith)(null==e?void 0:e.toLowerCase(),"microsoft.storage/storageaccounts/")){n=R.parseResourceNames(t,"microsoft.storage/storageaccounts");for(let e=0;e<n.length;e++)n[e].text+="/default",n[e].value+="/default"}else n=R.parseResourceNames(t,e);if(t.nextLink){const a=new URL(t.nextLink).searchParams.get("$skiptoken");if(!a)throw Error("unable to request the next page of resources");const i=yield r.getResourceNames({metricNamespace:e,subscriptionId:o,resourceGroup:s},a);n=n.concat(i)}return n}));return function(e){return t.apply(this,arguments)}}())}));return(yield Promise.all(o)).flat()}))()}getMetricNamespaces(e,t){const r=Ht.buildAzureMonitorGetMetricNamespacesUrl(this.resourcePath,this.apiPreviewVersion,this.replaceSingleTemplateVariables(e),t,this.templateSrv);return this.getResource(r).then((e=>R.parseResponseValues(e,"properties.metricNamespaceName","properties.metricNamespaceName"))).then((e=>{if(r.toLowerCase().includes("microsoft.storage/storageaccounts")){const t=["microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storageaccounts/queueservices"];for(const r of t)(0,M.find)(e,["value",r.toLowerCase()])||e.push({value:r,text:r})}return e}))}getMetricNames(e,t,r){const o=t?this.apiPreviewVersion:this.apiVersion,s=Ht.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,o,this.replaceSingleTemplateVariables(e),this.templateSrv,t,r);return this.getResource(s).then((e=>R.parseResponseValues(e,"name.localizedValue","name.value")))}getMetricMetadata(e,t,r){const{metricName:o}=e,s=t?this.apiPreviewVersion:this.apiVersion,n=Ht.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,s,this.replaceSingleTemplateVariables(e),this.templateSrv,t,r);return this.getResource(n).then((e=>R.parseMetadata(e,this.templateSrv.replace(o))))}validateDatasource(){if("clientsecret"===K(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}replaceSingleTemplateVariables(e,t){return this.replaceTemplateVariables(e,t)[0]}replaceTemplateVariables(e,t){const r=[jn({},e)];return Object.keys(e).forEach((e=>{const o=this.templateSrv.replace(r[0][e],t,"raw");if(o.includes(",")){const t=o.split(","),s=[...r];t.forEach(((t,o)=>{s.forEach((s=>{0===o?s[e]=t:r.push(An(jn({},s),{[e]:t}))}))}))}else r.forEach((t=>{t[e]=o}))})),r}getProvider(e){var t=this;return En((function*(){return yield t.getResource(`${F}/providers/${e}?api-version=${t.providerApiVersion}`)}))()}getLocations(e){var t=this;return En((function*(){const r=new Map;for(const o of e){const e=R.parseLocations(yield t.getResource(`${F}/subscriptions/${t.templateSrv.replace(o)}/locations?api-version=${t.locationsApiVersion}`));for(const t of e)r.set(t.name,t)}return r}))()}constructor(e,r=(0,t.getTemplateSrv)()){super(e),Pn(this,"instanceSettings",void 0),Pn(this,"templateSrv",void 0),Pn(this,"apiVersion",void 0),Pn(this,"apiPreviewVersion",void 0),Pn(this,"listByResourceGroupApiVersion",void 0),Pn(this,"providerApiVersion",void 0),Pn(this,"locationsApiVersion",void 0),Pn(this,"defaultSubscriptionId",void 0),Pn(this,"resourcePath",void 0),Pn(this,"azurePortalUrl",void 0),this.instanceSettings=e,this.templateSrv=r,this.apiVersion="2018-01-01",this.apiPreviewVersion="2017-12-01-preview",this.listByResourceGroupApiVersion="2021-04-01",this.providerApiVersion="2021-04-01",this.locationsApiVersion="2020-01-01",this.defaultSubscriptionId=e.jsonData.subscriptionId;const o=Y(e);this.resourcePath=F,this.azurePortalUrl=Z(o)}}function Cn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class In extends t.DataSourceWithBackend{filterQuery(e){var t;return!!(null===(t=e.azureResourceGraph)||void 0===t?void 0:t.query)&&!!e.subscriptions&&e.subscriptions.length>0}applyTemplateVariables(e,r){const o=(0,t.getTemplateSrv)(),s=e.azureResourceGraph;if(!s)return e;const n=o.getVariables().map((e=>`$${e.name}`)),a=_().find(e.subscriptions,(e=>_().includes(n,e))),i=[...o.replace(a,r,(e=>e)).split(",").filter((e=>e.length>0)),..._().filter(e.subscriptions,(e=>!_().includes(n,e)))],c=o.replace(s.query,r,V);return function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Cn(e,t,r[t])}))}return e}({},e),{queryType:Q.AzureResourceGraph,subscriptions:i,azureResourceGraph:{resultFormat:"table",query:c}})}}function Dn(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return Dn=function(e){this.s=e,this.n=e.next},Dn.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new Dn(e)}function Mn(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function _n(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){Mn(n,o,s,a,i,"next",e)}function i(e){Mn(n,o,s,a,i,"throw",e)}a(void 0)}))}}function Gn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Rn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Gn(e,t,r[t])}))}return e}const qn=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.aadiam/tenants","microsoft.agfoodplatform/farmbeats","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.attestation/attestationproviders","microsoft.automation/automationaccounts","microsoft.autonomousdevelopmentplatform/accounts","microsoft.autonomousdevelopmentplatform/datapools","microsoft.autonomousdevelopmentplatform/workspaces","microsoft.avs/privateclouds","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.blockchain/blockchainmembers","microsoft.blockchain/cordamembers","microsoft.botservice/botservices","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.cdn/profiles/endpoints","microsoft.classiccompute/domainnames","microsoft.classiccompute/virtualmachines","microsoft.classicnetwork/networksecuritygroups","microsoft.classicstorage/storageaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.connectedcache/cachenodes","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.d365customerinsights/instances","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.databricks/workspaces","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.desktopvirtualization/applicationgroups","microsoft.desktopvirtualization/hostpools","microsoft.desktopvirtualization/scalingplans","microsoft.desktopvirtualization/workspaces","microsoft.devices/elasticpools/iothubtenants","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.eventgrid/domains","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.experimentation/experimentworkspaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.insights/qos","microsoft.iotcentral/iotapps","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kusto/clusters","microsoft.loadtestservice/loadtests","microsoft.logic/integrationaccounts","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networksecuritygroups","microsoft.network/networksecurityperimeters","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/vpngateways","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.openlogisticsplatform/workspaces","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.peering/peeringservices","microsoft.powerbi/tenants","microsoft.powerbi/tenants/workspaces","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.resources/subscriptions/resourcegroups","microsoft.search/searchservices","microsoft.security/antimalwaresettings","microsoft.securityinsights/settings","microsoft.servicebus/namespaces","microsoft.signalrservice/signalr","microsoft.signalrservice/webpubsub","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/managedinstances/databases","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/tableservices","microsoft.storagecache/caches","microsoft.storagesync/storagesyncservices","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.videoindexer/accounts","microsoft.vmwarecloudsimple/virtualmachines","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots"].map((e=>`"${e}"`)).join(",");class xn extends t.DataSourceWithBackend{fetchInitialRows(e,t){var r=this;return _n((function*(){const o=yield r.getSubscriptions();if(!t)return o;let s=o;const n=t.map((t=>_n((function*(){if(t.subscription){const o=`/subscriptions/${t.subscription}/resourceGroups/${t.resourceGroup}`;if(t.resourceGroup&&!ir(s,o)){const o=yield r.getResourceGroupsBySubscriptionId(t.subscription,e);s=cr(s,`/subscriptions/${t.subscription}`,o)}const n=sr(t);if(t.resourceName&&!ir(s,n)){const t=yield r.getResourcesForResourceGroup(o,e);s=cr(s,o,t)}}}))));for(const e of n)yield e();return s}))()}fetchAndAppendNestedRow(e,t,r){var o=this;return _n((function*(){const s=t.type===rt.Subscription?yield o.getResourceGroupsBySubscriptionId(t.id,r):yield o.getResourcesForResourceGroup(t.id,r);return cr(e,t.uri,s)}))()}getSubscriptions(){var e=this;return _n((function*(){let t,r=[],o=!1;for(;!o;){let s={};t&&(s={$skipToken:t});const n=yield e.makeResourceGraphRequest("\n    resources\n    | join kind=inner (\n              ResourceContainers\n                | where type == 'microsoft.resources/subscriptions'\n                | project subscriptionName=name, subscriptionURI=id, subscriptionId\n              ) on subscriptionId\n    | summarize count() by subscriptionName, subscriptionURI, subscriptionId\n    | order by subscriptionName desc\n  ",1,s);if(!n.data.length)throw new Error("No subscriptions were found");r=r.concat(n.data),t=n.$skipToken,o=!t}return r.map((e=>({name:e.subscriptionName,id:e.subscriptionId,uri:`/subscriptions/${e.subscriptionId}`,typeLabel:"Subscription",type:rt.Subscription,children:[]})))}))()}getResourceGroupsBySubscriptionId(e,t){var r=this;return _n((function*(){const o=`\n    resources\n     | join kind=inner (\n       ResourceContainers\n       | where type == 'microsoft.resources/subscriptions/resourcegroups'\n       | project resourceGroupURI=id, resourceGroupName=name, resourceGroup, subscriptionId\n     ) on resourceGroup, subscriptionId\n\n     ${yield r.filterByType(t)}\n     | where subscriptionId == '${e}'\n     | summarize count() by resourceGroupName, resourceGroupURI\n     | order by resourceGroupURI asc`;let s,n=[],a=!1;for(;!a;){let e={};s&&(e={$skipToken:s});const t=yield r.makeResourceGraphRequest(o,1,e);n=n.concat(t.data),s=t.$skipToken,a=!s}return n.map((e=>{const t=er(e.resourceGroupURI);if(!t||!t.resourceGroup)throw new Error("unable to fetch resource groups");return{name:e.resourceGroupName,uri:e.resourceGroupURI,id:t.resourceGroup,type:rt.ResourceGroup,typeLabel:"Resource Group",children:[]}}))}))()}getResourcesForResourceGroup(e,t){var r=this;return _n((function*(){const{data:o}=yield r.makeResourceGraphRequest(`\n      resources\n      | where id hasprefix "${e}"\n      ${yield r.filterByType(t)}\n    `);return o.map((e=>{const t=er(e.id);if(!t||!t.resourceName)throw new Error("unable to fetch resource details");return{name:e.name,id:t.resourceName,uri:e.id,resourceGroupName:e.resourceGroup,type:rt.Resource,typeLabel:no[e.type]||e.type,locationDisplayName:e.location,location:e.location}}))}))()}getResourceURIDisplayProperties(e){var t=this;return _n((function*(){var r;const{subscription:o,resourceGroup:s,resourceName:n}=null!==(r=rr(e))&&void 0!==r?r:{};if(!o)throw new Error("Invalid resource URI passed");const a=`/subscriptions/${o}`,i=`\n    resourcecontainers\n    | where type == "microsoft.resources/subscriptions"\n    | where id =~ "${a}"\n    | project subscriptionName=name, subscriptionId\n\n    | join kind=leftouter (\n      resourcecontainers            \n            | where type == "microsoft.resources/subscriptions/resourcegroups"\n            | where id =~ "${a}/resourceGroups/${s}"\n            | project resourceGroupName=name, resourceGroup, subscriptionId\n        ) on subscriptionId\n\n        | join kind=leftouter (\n          resources\n            | where id =~ "${e}"\n            | project resourceName=name, subscriptionId\n        ) on subscriptionId\n\n        | project subscriptionName, resourceGroupName, resourceName\n    `,{data:c}=yield t.makeResourceGraphRequest(i);if(!c.length)throw new Error("unable to fetch resource details");const{subscriptionName:u,resourceGroupName:l,resourceName:p}=c[0];return{subscription:u||o,resourceGroup:l||s,resourceName:p||n}}))()}getResourceURIFromWorkspace(e){var t=this;return _n((function*(){const{data:r}=yield t.makeResourceGraphRequest(`\n      resources\n      | where properties['customerId'] == "${e}"\n      | project id\n    `);if(!r.length)throw new Error("unable to find resource for workspace "+e);return r[0].id}))()}makeResourceGraphRequest(e,t=1,r){var o=this;return _n((function*(){try{return yield o.postResource(o.resourcePath+"/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",{query:e,options:Rn({resultFormat:"objectArray"},r)})}catch(r){if(t>0)return o.makeResourceGraphRequest(e,t-1);throw r}}))()}fetchAllNamespaces(){var e=this;return _n((function*(){const r=yield e.getSubscriptions();(0,t.reportInteraction)("grafana_ds_azuremonitor_subscriptions_loaded",{subscriptions:r.length});let o=[];var s,n=!1,a=!1;try{for(var i,c=function(e){var t,r,o,s=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,o=Symbol.iterator);s--;){if(r&&null!=(t=e[r]))return t.call(e);if(o&&null!=(t=e[o]))return new Dn(t.call(e));r="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}(r);n=!(i=yield c.next()).done;n=!1){const t=i.value,r=yield e.azureMonitorDatasource.getMetricNamespaces({resourceUri:`/subscriptions/${t.id}`},!0);if(r){const e=r.map((e=>`"${e.value.toLocaleLowerCase()}"`));o=o.concat(e)}}}catch(e){a=!0,s=e}finally{try{n&&null!=c.return&&(yield c.return())}finally{if(a)throw s}}if(0===o.length)throw new Error("Unable to resolve a list of valid metric namespaces. Validate the datasource configuration is correct and required permissions have been granted for all subscriptions. Grafana requires at least the Reader role to be assigned.");e.supportedMetricNamespaces=(0,M.uniq)(o.concat(io.map((e=>`"${e}"`)))).join(",")}))()}parseRows(e){const t=tr(e),r=[];return t.forEach(((e,t)=>{var o;let s=e.resourceName,n=e.resourceName,a=rt.Resource;var i,c,u;s||(s=e.resourceGroup,n=e.resourceGroup,a=rt.ResourceGroup,s||(s=e.subscription,n=e.subscription,a=rt.Subscription)),r.push({id:null!=s?s:"",name:null!=n?n:"",type:a,uri:sr(e),typeLabel:null!==(u=null!==(c=no[null!==(i=null===(o=e.metricNamespace)||void 0===o?void 0:o.toLowerCase())&&void 0!==i?i:""])&&void 0!==c?c:e.metricNamespace)&&void 0!==u?u:"",location:e.region})})),r}constructor(e,t){super(e),Gn(this,"resourcePath",void 0),Gn(this,"resultLimit",200),Gn(this,"azureMonitorDatasource",void 0),Gn(this,"supportedMetricNamespaces","");var r=this;Gn(this,"search",function(){var e=_n((function*(e,t){let o="resources";"logs"===t&&(o+="\n      | union resourcecontainers"),o+=`\n        | where id contains "${e}"\n        ${yield r.filterByType(t)}\n        | order by tolower(name) asc\n        | limit ${r.resultLimit}\n      `;const{data:s}=yield r.makeResourceGraphRequest(o);return s.map((e=>{const t=er(e.id);if(!t||!(t.resourceName||t.resourceGroup||t.subscription))throw new Error("unable to fetch resource details");var r;let o=null!==(r=t.subscription)&&void 0!==r?r:"",s=rt.Subscription;return t.resourceName?(o=t.resourceName,s=rt.Resource):t.resourceGroup&&(o=t.resourceGroup,s=rt.ResourceGroup),{name:e.name,id:o,uri:e.id,resourceGroupName:e.resourceGroup,type:s,typeLabel:no[e.type]||e.type,location:e.location}}))}));return function(t,r){return e.apply(this,arguments)}}());var o=this;Gn(this,"filterByType",function(){var e=_n((function*(e){return""===o.supportedMetricNamespaces&&"logs"!==e&&(yield o.fetchAllNamespaces()),"logs"===e?`| where type in (${qn})`:`| where type in (${o.supportedMetricNamespaces})`}));return function(t){return e.apply(this,arguments)}}()),this.resourcePath="resourcegraph",this.azureMonitorDatasource=t}}function Ln(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Ln(e,t,r[t])}))}return e}function Vn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Qn(e){var t,r,o;const s="string"==typeof e.rawQuery?e.rawQuery:null,n="string"==typeof e.workspace?e.workspace:null;if(!s||!n||(null===(r=e.target)||void 0===r||null===(t=r.azureLogAnalytics)||void 0===t?void 0:t.query))return e;var a,i;const c=Vn(Fn({},null!==(a=e.target)&&void 0!==a?a:{}),{refId:null!==(i=null===(o=e.target)||void 0===o?void 0:o.refId)&&void 0!==i?i:"Anno",queryType:Q.LogAnalytics,azureLogAnalytics:{query:s,resources:[n]}});return Vn(Fn({},e),{rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:c})}function $n(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function Wn(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var n=e.apply(t,r);function a(e){$n(n,o,s,a,i,"next",e)}function i(e){$n(n,o,s,a,i,"throw",e)}a(void 0)}))}}function Un(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Xn=e=>({subscriptions:e.match(/^Subscriptions\(\)/i),resourceGroups:e.match(/^ResourceGroups\(\)/i),resourceGroupsWithSub:e.match(/^ResourceGroups\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespaces:e.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespacesWithSub:e.match(/^Namespaces\(([^,]+?),\s?([^,]+?)\)/i),resourceNames:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i),resourceNamesWithSub:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),metricNamespace:e.match(/^MetricNamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamespaceWithSub:e.match(/^metricnamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNames:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamesWithSub:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),appInsightsMetricNameQuery:e.match(/^AppInsightsMetricNames\(\)/i),appInsightsGroupByQuery:e.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i),workspacesQuery:e.match(/^workspaces\(\)/i),workspacesQueryWithSub:e.match(/^workspaces\(["']?([^\)]+?)["']?\)/i)}),Bn=function(){var e=Wn((function*(e,t){const r=t.azureMonitorDatasource.defaultSubscriptionId;let o="";if(e){const e=t.azureLogAnalyticsDatasource.getDeprecatedDefaultWorkSpace();o=e?nr(e)?yield t.resourcePickerData.getResourceURIFromWorkspace(e):e:(yield t.azureLogAnalyticsDatasource.getFirstWorkspace())||""}return{refId:"A",queryType:Q.LogAnalytics,azureLogAnalytics:{query:e,resources:o?[o]:[]},subscription:r}}));return function(t,r){return e.apply(this,arguments)}}(),Hn=function(){var e=Wn((function*(e,t){return"string"!=typeof e?e:(e=>{const t=Xn(e);return Object.keys(t).some((e=>!!t[e]))})(e)?((e,t)=>{const r=Xn(e),o=t.azureMonitorDatasource.defaultSubscriptionId;return{refId:"A",queryType:Q.GrafanaTemplateVariableFn,grafanaTemplateVariableFn:r.appInsightsMetricNameQuery?{rawQuery:e,kind:"AppInsightsMetricNameQuery"}:r.appInsightsGroupByQuery?{kind:"AppInsightsGroupByQuery",rawQuery:e,metricName:r.appInsightsGroupByQuery[1]}:r.subscriptions?{kind:"SubscriptionsQuery",rawQuery:e}:r.resourceGroupsWithSub?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:r.resourceGroupsWithSub[1]}:r.resourceGroups&&o?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:o}:r.namespacesWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:r.namespacesWithSub[1],resourceGroup:r.namespacesWithSub[2]}:r.namespaces&&o?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:o,resourceGroup:r.namespaces[1]}:r.resourceNamesWithSub?{kind:"ResourceNamesQuery",rawQuery:e,subscription:r.resourceNamesWithSub[1],resourceGroup:r.resourceNamesWithSub[2],metricNamespace:r.resourceNamesWithSub[3]}:r.resourceNames&&o?{kind:"ResourceNamesQuery",rawQuery:e,subscription:o,resourceGroup:r.resourceNames[1],metricNamespace:r.resourceNames[2]}:r.metricNamespaceWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:r.metricNamespaceWithSub[1],resourceGroup:r.metricNamespaceWithSub[2],metricNamespace:r.metricNamespaceWithSub[3],resourceName:r.metricNamespaceWithSub[4]}:r.metricNamespace&&o?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:o,resourceGroup:r.metricNamespace[1],metricNamespace:r.metricNamespace[2],resourceName:r.metricNamespace[3]}:r.metricNames&&o&&-1===r.metricNames[3].indexOf(",")?{kind:"MetricNamesQuery",rawQuery:e,subscription:o,resourceGroup:r.metricNames[1],metricNamespace:r.metricNames[2],resourceName:r.metricNames[3]}:r.metricNamesWithSub?{kind:"MetricNamesQuery",rawQuery:e,subscription:r.metricNamesWithSub[1],resourceGroup:r.metricNamesWithSub[2],metricNamespace:r.metricNamesWithSub[3],resourceName:r.metricNamesWithSub[4]}:r.workspacesQueryWithSub?{kind:"WorkspacesQuery",rawQuery:e,subscription:(r.workspacesQueryWithSub[1]||"").trim()}:r.workspacesQuery&&o?{kind:"WorkspacesQuery",rawQuery:e,subscription:o}:{kind:"SubscriptionsQuery",rawQuery:e},subscription:o}})(e,t.datasource):Bn(e,t.datasource)}));return function(t,r){return e.apply(this,arguments)}}(),Kn=function(){var e=Wn((function*(e,t){let r=yield Hn(e,t);return r.queryType===Q.GrafanaTemplateVariableFn&&(r=(e=>{const{queryType:t,grafanaTemplateVariableFn:r}=e;if(t!==Q.GrafanaTemplateVariableFn||!r)return e;const o=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Un(e,t,r[t])}))}return e}({},e);switch("subscription"in r&&(o.subscription=r.subscription),"resourceGroup"in r&&(o.resourceGroup=r.resourceGroup),"metricNamespace"in r&&(o.namespace=r.metricNamespace),"resourceName"in r&&(o.resource=r.resourceName),r.kind){case"SubscriptionsQuery":o.queryType=Q.SubscriptionsQuery;break;case"ResourceGroupsQuery":o.queryType=Q.ResourceGroupsQuery;break;case"ResourceNamesQuery":o.queryType=Q.ResourceNamesQuery;break;case"MetricNamespaceQuery":case"MetricDefinitionsQuery":o.queryType=Q.NamespacesQuery;break;case"MetricNamesQuery":o.queryType=Q.MetricNamesQuery;break;case"WorkspacesQuery":o.queryType=Q.WorkspacesQuery}return o})(r)),r}));return function(t,r){return e.apply(this,arguments)}}();function Jn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Zn=({query:e,updateQuery:t,datasource:s})=>{var a;const[i,c]=(0,r.useState)("");(0,r.useEffect)((()=>{var t;c((null===(t=e.grafanaTemplateVariableFn)||void 0===t?void 0:t.rawQuery)||"")}),[null===(a=e.grafanaTemplateVariableFn)||void 0===a?void 0:a.rawQuery]);const u=(0,r.useCallback)((r=>{Hn(r,{datasource:s}).then((o=>{var s,n;o.queryType===Q.GrafanaTemplateVariableFn?t(o):t((s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Jn(e,t,r[t])}))}return e}({},e),n=null!=(n={grafanaTemplateVariableFn:{kind:"UnknownQuery",rawQuery:r}})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(n)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(n,e))})),s))}))}),[s,e,t]);return o().createElement(n.InlineField,{label:"Grafana template variable function"},o().createElement(n.Input,{placeholder:"type a grafana template variable function, ex: Subscriptions()",value:i,onChange:e=>{c(e.target.value)},onBlur:()=>u(i)}))};function Yn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ea(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){Yn(e,t,r[t])}))}return e}function ta(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ra={label:"-",value:""},oa=e=>{const{query:t,onChange:s,datasource:a}=e,i=[{label:"Subscriptions",value:Q.SubscriptionsQuery},{label:"Resource Groups",value:Q.ResourceGroupsQuery},{label:"Namespaces",value:Q.NamespacesQuery},{label:"Regions",value:Q.LocationsQuery},{label:"Resource Names",value:Q.ResourceNamesQuery},{label:"Metric Names",value:Q.MetricNamesQuery},{label:"Workspaces",value:Q.WorkspacesQuery},{label:"Resource Graph",value:Q.AzureResourceGraph},{label:"Logs",value:Q.LogAnalytics}];"object"==typeof e.query&&e.query.queryType===Q.GrafanaTemplateVariableFn&&i.push({label:"Grafana Query Function",value:Q.GrafanaTemplateVariableFn});const[c,u]=(0,r.useState)({label:"Template Variables",options:[]}),[l,p]=(0,r.useState)(!1),[m,d]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),[w,O]=(0,r.useState)(!1),[S,k]=(0,r.useState)(!1),[z,E]=(0,r.useState)([]),[P,j]=(0,r.useState)([]),[A,N]=(0,r.useState)([]),[T,C]=(0,r.useState)([]),[I,D]=(0,r.useState)([]),[_,G]=he(),R="string"==typeof t?"":t.queryType;(0,r.useEffect)((()=>{Kn(t,{datasource:a}).then((e=>{(0,M.isEqual)(t,e)||s(e)}))}),[t,a,s]),(0,r.useEffect)((()=>{switch(p(!1),d(!1),b(!1),h(!1),O(!1),k(!1),R){case Q.ResourceGroupsQuery:case Q.WorkspacesQuery:p(!0);break;case Q.NamespacesQuery:p(!0),d(!0);break;case Q.ResourceNamesQuery:p(!0),d(!0),b(!0),v(!0);break;case Q.MetricNamesQuery:p(!0),h(!0),O(!0),k(!0);break;case Q.LocationsQuery:p(!0)}}),[R]),(0,r.useEffect)((()=>{const e=[];a.getVariablesRaw().forEach((t=>{(0,M.get)(t,"query.queryType")!==R&&e.push({label:t.label||t.name,value:`$${t.name}`})})),u({label:"Template Variables",options:e})}),[a,R]),Ye((()=>{a.getSubscriptions().then((e=>{E(e.map((e=>({label:e.text,value:e.value}))))}))}));const q="object"==typeof t&&t.subscription;(0,r.useEffect)((()=>{q&&a.getResourceGroups(q).then((e=>{j(e.map((e=>({label:e.text,value:e.value}))))}))}),[a,q]);const x="object"==typeof t&&t.resourceGroup||"";(0,r.useEffect)((()=>{q&&a.getMetricNamespaces(q,x).then((e=>{N(e.map((e=>({label:e.text,value:e.value}))))}))}),[a,q,x]),(0,r.useEffect)((()=>{q&&a.azureMonitorDatasource.getLocations([q]).then((e=>{const t=[];e.forEach((e=>t.push({label:e.displayName,value:e.name}))),D(t)}))}),[a,q,x]);const L="object"==typeof t&&t.namespace||"";if((0,r.useEffect)((()=>{q&&a.getResourceNames(q,x,L).then((e=>{C(e.map((e=>({label:e.text,value:e.value}))))}))}),[a,q,x,L]),"string"==typeof t)return null;const F=e=>{s(e)};return o().createElement(o().Fragment,null,o().createElement(n.Field,{label:"Query Type","data-testid":oe.queryType.input},o().createElement(n.Select,{"aria-label":"select query type",onChange:e=>{e.value&&s(ta(ea({},t),{queryType:e.value,subscription:void 0,resourceGroup:void 0,namespace:void 0,resource:void 0}))},options:i,width:25,value:R})),t.queryType===Q.LogAnalytics&&o().createElement(o().Fragment,null,o().createElement($r,{subscriptionId:t.subscription,query:t,datasource:a,onChange:F,variableOptionGroup:c,setError:G,hideFormatAs:!0}),_&&o().createElement(o().Fragment,null,o().createElement(n.Space,{v:2}),o().createElement(n.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},_ instanceof Error?_.message:_))),t.queryType===Q.GrafanaTemplateVariableFn&&o().createElement(Zn,{query:t,updateQuery:e.onChange,datasource:a}),l&&o().createElement(n.Field,{label:"Subscription","data-testid":oe.subscription.input},o().createElement(n.Select,{"aria-label":"select subscription",onChange:e=>{e.value&&s(ta(ea({},t),{subscription:e.value,resourceGroup:void 0,namespace:void 0,resource:void 0}))},options:z.concat(c),width:25,value:t.subscription||null})),(g||m)&&o().createElement(n.Field,{label:"Resource Group","data-testid":oe.resourceGroup.input},o().createElement(n.Select,{"aria-label":"select resource group",onChange:e=>{s(ta(ea({},t),{resourceGroup:e.value,namespace:void 0,resource:void 0}))},options:g?P.concat(c):P.concat(c,ra),width:25,value:t.resourceGroup||null,placeholder:g?void 0:"Optional"})),(w||f)&&o().createElement(n.Field,{label:"Namespace","data-testid":oe.namespace.input},o().createElement(n.Select,{"aria-label":"select namespace",onChange:e=>{s(ta(ea({},t),{namespace:e.value,resource:void 0}))},options:w?A.concat(c):A.concat(c,ra),width:25,value:t.namespace||null,placeholder:w?void 0:"Optional"})),y&&o().createElement(n.Field,{label:"Region","data-testid":oe.region.input},o().createElement(n.Select,{"aria-label":"select region",onChange:e=>{s(ta(ea({},t),{region:e.value}))},options:I.concat(c),width:25,value:t.region||null,placeholder:"Optional"})),S&&o().createElement(n.Field,{label:"Resource","data-testid":oe.resource.input},o().createElement(n.Select,{"aria-label":"select resource",onChange:e=>{s(ta(ea({},t),{resource:e.value}))},options:T.concat(c),width:25,value:t.resource||null})),t.queryType===Q.AzureResourceGraph&&o().createElement(o().Fragment,null,o().createElement(Ze,{subscriptionId:a.azureLogAnalyticsDatasource.defaultSubscriptionId,query:t,datasource:a,onChange:F,variableOptionGroup:c,setError:G}),_&&o().createElement(o().Fragment,null,o().createElement(n.Space,{v:2}),o().createElement(n.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},_ instanceof Error?_.message:_))))};function sa(e,t,r,o,s,n,a){try{var i=e[n](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(o,s)}function na(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class aa extends e.CustomVariableSupport{hasValue(...e){return e.every((e=>!!this.templateSrv.replace(e)))}query(t){var r=this;const o=function(){var o,s=(o=function*(){const o=yield Kn(t.targets[0],{datasource:r.datasource});try{switch(o.queryType){case Q.SubscriptionsQuery:const s=yield r.datasource.getSubscriptions();return{data:(null==s?void 0:s.length)?[(0,e.toDataFrame)(s)]:[]};case Q.ResourceGroupsQuery:if(o.subscription&&r.hasValue(o.subscription)){const t=yield r.datasource.getResourceGroups(o.subscription);return{data:(null==t?void 0:t.length)?[(0,e.toDataFrame)(t)]:[]}}return{data:[]};case Q.NamespacesQuery:if(o.subscription&&r.hasValue(o.subscription)){const t=yield r.datasource.getMetricNamespaces(o.subscription,o.resourceGroup);return{data:(null==t?void 0:t.length)?[(0,e.toDataFrame)(t)]:[]}}return{data:[]};case Q.ResourceNamesQuery:if(o.subscription&&r.hasValue(o.subscription)){const t=yield r.datasource.getResourceNames(o.subscription,o.resourceGroup,o.namespace,o.region);return{data:(null==t?void 0:t.length)?[(0,e.toDataFrame)(t)]:[]}}return{data:[]};case Q.MetricNamesQuery:if(o.subscription&&o.resourceGroup&&o.namespace&&o.resource&&r.hasValue(o.subscription,o.resourceGroup,o.namespace,o.resource)){const t=yield r.datasource.getMetricNames(o.subscription,o.resourceGroup,o.namespace,o.resource);return{data:(null==t?void 0:t.length)?[(0,e.toDataFrame)(t)]:[]}}return{data:[]};case Q.WorkspacesQuery:if(o.subscription&&r.hasValue(o.subscription)){const t=yield r.datasource.getAzureLogAnalyticsWorkspaces(o.subscription);return{data:(null==t?void 0:t.length)?[(0,e.toDataFrame)(t)]:[]}}return{data:[]};case Q.GrafanaTemplateVariableFn:if(o.grafanaTemplateVariableFn){const t=yield r.callGrafanaTemplateVariableFn(o.grafanaTemplateVariableFn);return{data:(null==t?void 0:t.length)?[(0,e.toDataFrame)(t)]:[]}}return{data:[]};case Q.LocationsQuery:if(o.subscription&&r.hasValue(o.subscription)){const t=yield r.datasource.azureMonitorDatasource.getLocations([o.subscription]),s=[];return t.forEach((e=>{s.push({text:e.displayName,value:e.name})})),{data:(null==s?void 0:s.length)?[(0,e.toDataFrame)(s)]:[]}}default:t.targets[0]=o;const n=yield(0,ts.lastValueFrom)(r.datasource.query(t));return{data:n.data,error:n.error?new Error(ge(n.error)):void 0}}}catch(e){return{data:[],error:new Error(ge(e))}}},function(){var e=this,t=arguments;return new Promise((function(r,s){var n=o.apply(e,t);function a(e){sa(n,r,s,a,i,"next",e)}function i(e){sa(n,r,s,a,i,"throw",e)}a(void 0)}))});return function(){return s.apply(this,arguments)}}();return(0,ts.from)(o())}callGrafanaTemplateVariableFn(e){return"SubscriptionsQuery"===e.kind?this.datasource.getSubscriptions():"ResourceGroupsQuery"===e.kind?this.datasource.getResourceGroups(this.replaceVariable(e.subscription)):"ResourceNamesQuery"===e.kind?this.datasource.getResourceNames(this.replaceVariable(e.subscription),this.replaceVariable(e.resourceGroup),this.replaceVariable(e.metricNamespace)):"MetricNamespaceQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNamespaces(e,!0):"MetricNamesQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNames(e):"WorkspacesQuery"===e.kind?this.datasource.azureLogAnalyticsDatasource.getWorkspaces(this.replaceVariable(e.subscription)):null}replaceVariable(e){return this.templateSrv.replace((e||"").trim())}constructor(e,r=(0,t.getTemplateSrv)()){super(),na(this,"datasource",void 0),na(this,"templateSrv",void 0),na(this,"editor",void 0),this.datasource=e,this.templateSrv=r,this.editor=oa,this.datasource=e}}function ia(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ca(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){ia(e,t,r[t])}))}return e}function ua(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class la extends t.DataSourceWithBackend{filterQuery(e){var t;if(!e.queryType)return!1;const r=this.pseudoDatasource[e.queryType];var o;return null===(o=null==r||null===(t=r.filterQuery)||void 0===t?void 0:t.call(r,e))||void 0===o||o}query(t){const r=new Map;for(const e of t.targets){const o=Gs(e);if(!o.queryType||o.hide||!pa(o))continue;if(!r.has(o.queryType)){const e=(0,M.cloneDeep)(t);e.requestId=`${e.requestId}-${o.refId}`,e.targets=[],r.set(o.queryType,e)}const s=r.get(o.queryType);null==s||s.targets.push(o)}const o=Array.from(r.entries()).map((([e,t])=>{const r=e===Q.AzureTraces?Q.LogAnalytics:e,o=this.pseudoDatasource[r];if(!o)throw new Error("Data source not created for query type "+e);return o.query(t)}));return 1===o.length?o[0]:o.length>1?(0,ts.forkJoin)(o).pipe(bn((t=>{const r=[];for(const e of t)for(const t of e.data)r.push(t);return{state:e.LoadingState.Done,data:r}}))):(0,ts.of)({state:e.LoadingState.Done,data:[]})}targetContainsTemplate(e){if(e.subscription&&this.templateSrv.containsTemplate(e.subscription))return!0;let t;return e.queryType===Q.AzureMonitor?t=JSON.stringify(e.azureMonitor):e.queryType===Q.LogAnalytics?t=JSON.stringify(e.azureLogAnalytics):e.queryType===Q.AzureResourceGraph&&(t=JSON.stringify([e.azureResourceGraph,e.subscriptions])),!!t&&this.templateSrv.containsTemplate(t)}getResourceGroups(e){return this.azureMonitorDatasource.getResourceGroups(this.templateSrv.replace(e))}getMetricNamespaces(e,t){let r=`/subscriptions/${e}`;return t&&(r+=`/resourceGroups/${t};`),this.azureMonitorDatasource.getMetricNamespaces({resourceUri:r},!0)}getResourceNames(e,t,r,o){return this.azureMonitorDatasource.getResourceNames({subscriptionId:e,resourceGroup:t,metricNamespace:r,region:o})}getMetricNames(e,t,r,o){return this.azureMonitorDatasource.getMetricNames({subscription:e,resourceGroup:t,metricNamespace:r,resourceName:o})}getAzureLogAnalyticsWorkspaces(e){return this.azureLogAnalyticsDatasource.getWorkspaces(e)}getSubscriptions(){return this.azureMonitorDatasource.getSubscriptions()}interpolateVariablesInQueries(e,t){return e.map((e=>{if(!e.queryType)return e;const r=e.queryType===Q.AzureTraces?Q.LogAnalytics:e.queryType,o=this.pseudoDatasource[r];var s;return ca({datasource:null==o?void 0:o.getRef()},null!==(s=null==o?void 0:o.applyTemplateVariables(e,t))&&void 0!==s?s:e)}))}getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}getVariablesRaw(){return this.templateSrv.getVariables()}modifyQuery(e,t){var r;if(!t.options)return e;let o=null===(r=e.azureLogAnalytics)||void 0===r?void 0:r.query;if(void 0===o)return e;switch(t.type){case"ADD_FILTER":o+=`\n| where ${t.options.key} == "${t.options.value}"`;break;case"ADD_FILTER_OUT":o+=`\n| where ${t.options.key} != "${t.options.value}"`}return ua(ca({},e),{azureLogAnalytics:ua(ca({},e.azureLogAnalytics),{query:o})})}constructor(e,r=(0,t.getTemplateSrv)()){super(e),ia(this,"templateSrv",void 0),ia(this,"annotations",void 0),ia(this,"azureMonitorDatasource",void 0),ia(this,"azureLogAnalyticsDatasource",void 0),ia(this,"resourcePickerData",void 0),ia(this,"azureResourceGraphDatasource",void 0),ia(this,"pseudoDatasource",void 0),this.templateSrv=r,this.annotations={prepareAnnotation:Qn},this.pseudoDatasource={},this.azureMonitorDatasource=new Tn(e),this.azureLogAnalyticsDatasource=new kn(e),this.azureResourceGraphDatasource=new In(e),this.resourcePickerData=new xn(e,this.azureMonitorDatasource),this.pseudoDatasource={[Q.AzureMonitor]:this.azureMonitorDatasource,[Q.LogAnalytics]:this.azureLogAnalyticsDatasource,[Q.AzureResourceGraph]:this.azureResourceGraphDatasource},this.variables=new aa(this)}}function pa(e){switch(e.queryType){case Q.AzureMonitor:return!!e.azureMonitor;case Q.LogAnalytics:return!!e.azureLogAnalytics;case Q.AzureResourceGraph:return!!e.azureResourceGraph;case Q.AzureTraces:return!!e.azureTraces;case Q.GrafanaTemplateVariableFn:return!!e.grafanaTemplateVariableFn;default:return!1}}const ma=JSON.parse('{"id":"grafana-azure-monitor-datasource"}');function da(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fa(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){da(e,t,r[t])}))}return e}function ba(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ya=new e.DataSourcePlugin(la).setConfigEditor(ve).setQueryEditor((({query:e,datasource:a,onChange:i,onRunQuery:c,data:u,range:l})=>{const[p,m]=he(),d=(0,r.useMemo)((()=>(0,M.debounce)(c,500)),[c]),[f,b]=(0,r.useState)(!1),y=(0,r.useCallback)((e=>{i(e),d()}),[i,d]),v=((e,t)=>{const o=(0,r.useMemo)((()=>(e=>{const t=Gs((0,M.defaults)({},e,Rs));return Is()(t,e)?e:t})(e)),[e]);return(0,r.useEffect)((()=>{o!==e&&t(o)}),[o,e,t]),o})(e,y),g=v.subscription||a.azureMonitorDatasource.defaultSubscriptionId,h={label:"Template Variables",options:a.getVariables().map((e=>({label:e,value:e})))};return o().createElement("div",{"data-testid":"azure-monitor-query-editor"},o().createElement(so,{datasource:a.azureLogAnalyticsDatasource,isOpen:f,onClose:()=>b(!1),onChange:e=>{return i((t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){qs(e,t,r[t])}))}return e}({},e),r=null!=(r={queryType:Q.LogAnalytics})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t));var t,r}}),o().createElement("div",{className:(0,s.css)({display:"flex",alignItems:"center"})},o().createElement(es,{query:v,onQueryChange:y}),v.queryType===Q.LogAnalytics&&o().createElement(n.Button,{"aria-label":"Azure logs kick start your query button",variant:"secondary",size:"sm",onClick:()=>{b((e=>!e)),(0,t.reportInteraction)("grafana_azure_logs_query_patterns_opened",{version:"v2",editorMode:v.azureLogAnalytics})}},"Kick start your query")),o().createElement(xs,{data:u,subscriptionId:g,query:v,datasource:a,onChange:y,variableOptionGroup:h,setError:m,range:l}),p&&o().createElement(o().Fragment,null,o().createElement(n.Space,{v:2}),o().createElement(n.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},p instanceof Error?p.message:p)))}));(0,t.getAppEvents)().subscribe(e.DashboardLoadedEvent,(({payload:{dashboardId:e,orgId:r,userId:o,grafanaVersion:s,queries:n}})=>{const a=n[ma.id],i={hidden:0,visible:0,multiResource:0,count:0};let c={[Q.AzureMonitor]:fa({},i),[Q.LogAnalytics]:ba(fa({},i),{grafanaTime:0,queryTime:0}),[Q.AzureResourceGraph]:fa({},i),[Q.AzureTraces]:ba(fa({},i),{table:0,trace:0,operationIdSpecified:0,eventTypesSpecified:0,filtersSpecified:0}),[Q.SubscriptionsQuery]:fa({},i),[Q.ResourceGroupsQuery]:fa({},i),[Q.NamespacesQuery]:fa({},i),[Q.ResourceNamesQuery]:fa({},i),[Q.MetricNamesQuery]:fa({},i),[Q.WorkspacesQuery]:fa({},i),[Q.GrafanaTemplateVariableFn]:fa({},i),[Q.LocationsQuery]:fa({},i),unknown:fa({},i)};var u;a.forEach((e=>{var t,r,o;switch(e.queryType===Q.AzureMonitor&&(c[Q.AzureMonitor][e.hide?"hidden":"visible"]++,(null===(t=e.azureMonitor)||void 0===t?void 0:t.resources)&&e.azureMonitor.resources.length>1&&c[Q.AzureMonitor].multiResource++),e.queryType===Q.LogAnalytics&&(c[Q.LogAnalytics][e.hide?"hidden":"visible"]++,c[Q.LogAnalytics][(null===(r=e.azureLogAnalytics)||void 0===r?void 0:r.dashboardTime)?"grafanaTime":"queryTime"]++,(null===(o=e.azureLogAnalytics)||void 0===o?void 0:o.resources)&&e.azureLogAnalytics.resources.length>1&&c[Q.LogAnalytics].multiResource++),e.queryType===Q.AzureResourceGraph&&(c[Q.AzureResourceGraph][e.hide?"hidden":"visible"]++,e.subscriptions&&e.subscriptions.length>1&&c[Q.AzureResourceGraph].multiResource++),e.queryType===Q.AzureTraces&&(c[Q.AzureTraces][e.hide?"hidden":"visible"]++,e.azureTraces&&(e.azureTraces.resultFormat&&c[Q.AzureTraces][e.azureTraces.resultFormat===$.Trace?$.Trace:$.Table]++,e.azureTraces.resources&&e.azureTraces.resources.length>1&&c[Q.AzureTraces].multiResource++,e.azureTraces.operationId&&""!==e.azureTraces.operationId&&c[Q.AzureTraces].operationIdSpecified++,e.azureTraces.traceTypes&&e.azureTraces.traceTypes.length>0&&c[Q.AzureTraces].eventTypesSpecified++,e.azureTraces.filters&&e.azureTraces.filters.length>0&&c[Q.AzureTraces].filtersSpecified++)),e.queryType){case Q.AzureMonitor:case Q.LogAnalytics:case Q.AzureResourceGraph:case Q.AzureTraces:case Q.SubscriptionsQuery:case Q.ResourceGroupsQuery:case Q.NamespacesQuery:case Q.ResourceNamesQuery:case Q.MetricNamesQuery:case Q.WorkspacesQuery:case Q.GrafanaTemplateVariableFn:case Q.LocationsQuery:c[e.queryType].count++;break;default:c.unknown.count++}})),a&&a.length>0&&(u={grafana_version:s,dashboard_id:e,org_id:r,azure_monitor_queries:c[Q.AzureMonitor].visible,azure_monitor_queries_hidden:c[Q.AzureMonitor].hidden,azure_monitor_multiple_resource:c[Q.AzureMonitor].multiResource,azure_monitor_query:c[Q.AzureMonitor].count,azure_log_analytics_queries:c[Q.LogAnalytics].visible,azure_log_analytics_queries_hidden:c[Q.LogAnalytics].hidden,azure_log_multiple_resource:c[Q.LogAnalytics].multiResource,azure_log_analytics_queries_grafana_time:c[Q.LogAnalytics].grafanaTime,azure_log_analytics_queries_query_time:c[Q.LogAnalytics].queryTime,azure_log_query:c[Q.LogAnalytics].count,azure_resource_graph_queries:c[Q.AzureResourceGraph].visible,azure_resource_graph_queries_hidden:c[Q.AzureResourceGraph].hidden,azure_resource_graph_multiple_subscription:c[Q.AzureResourceGraph].multiResource,azure_resource_graph_query:c[Q.AzureResourceGraph].count,azure_traces_queries:c[Q.AzureTraces].visible,azure_traces_queries_hidden:c[Q.AzureTraces].hidden,azure_traces_multiple_resource:c[Q.AzureTraces].multiResource,azure_traces_table:c[Q.AzureTraces].table,azure_traces_trace:c[Q.AzureTraces].trace,azure_traces_operation_id_specified:c[Q.AzureTraces].operationIdSpecified,azure_traces_event_type_specified:c[Q.AzureTraces].eventTypesSpecified,azure_traces_filters:c[Q.AzureTraces].filtersSpecified,azure_traces_query:c[Q.AzureTraces].count,azure_subscriptions_query:c[Q.SubscriptionsQuery].count,azure_resource_groups_query:c[Q.ResourceGroupsQuery].count,azure_namespaces_query:c[Q.NamespacesQuery].count,azure_resource_names_query:c[Q.ResourceNamesQuery].count,azure_metric_names_query:c[Q.MetricNamesQuery].count,azure_workspaces_query:c[Q.WorkspacesQuery].count,azure_grafana_template_variable_query:c[Q.GrafanaTemplateVariableFn].count,azure_locations_query:c[Q.LocationsQuery].count,azure_unknown_query:c.unknown.count},(0,t.reportInteraction)("grafana_ds_azuremonitor_dashboard_loaded",u))}))})(),p})()));
//# sourceMappingURL=module.js.map